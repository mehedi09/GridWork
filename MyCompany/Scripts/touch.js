/*!
 * Data Aquarium Framework - Touch UI
 * Copyright 2008-2015 Code On Time LLC; Licensed MIT; http://codeontime.com/license
 */
(function(){function ah(n){var t=n.replace(/\.\w+$/,"").replace(/\W/g,"_").toLowerCase()||"page";return t.match(/^\_/)&&(t=t.substring(1)),t}function vh(){var n=l.location.href,t=n.indexOf("#");t>=0&&(n=n.substr(0,t));l.location.reload(n)}function di(n,t){var r=n.DynamicItems?n.DynamicItems:n.Items,u,e,i=t&&t.value,f=t&&t.text;return r&&!r.length&&t&&i&&(i=t.value,f=t.text,u=typeof i=="string"?i.split($app._simpleListRegex):[i],e=u.length>1?f.split($app._simpleListRegex):[f],$(u).each(function(n){r.push([u[n],e[n]])})),r}function yh(n,t){t||(t=$("#"+n._id+"_echo"));t.length&&t.find(".app-echo-toolbar .app-echo-controls").addClass("app-stale");var i=a();setTimeout(function(){i==a()&&ct()},500)}function f(){return kt&&nh=="mouse"}function no(){return et||la?"none":"fade"}function vf(n){return n&&typeof n=="string"&&n.match(/glyphicon-/)}function ph(){return $(".ui-panel-open .ui-btn.app-animated")}function to(){return $(".ui-popup-active .ui-btn.app-animated")}function ov(){return g.width()>g.height()}function wh(n){pu($app.find(n.dataViewId))}function yt(){n.promo("search",vt.PerformAdvancedSearch);n.promo().data("icon-list",null)}function bh(){var t=n._menuButton;e(t,function(){t.trigger("vclick")})}function io(n){$(n).find(".app-signature").each(function(){$app.upload("resize",{container:this})})}function sv(){return n.contextDataView()!=n.dataView()}function ro(){r.sidebar=="Landscape"?ov()?u.removeClass("app-sidebar-undocked"):u.addClass("app-sidebar-undocked"):r.sidebar=="Never"?u.addClass("app-sidebar-undocked"):u.removeClass("app-sidebar-undocked")}function yf(n){f()?l.open(n):l.location.href=n}function kh(){switch(r.displayDensity){case"Comfortable":return 46;case"Compact":return 40}return 35}function vr(){return(new Date).getTime()}function gi(n){return parseFloat(n.replace(/[A-Za-z]/g,""))}function hv(n){return n.x!=null&&(n.x=Math.ceil(n.x)),n.y!=null&&(n.y=Math.ceil(n.y)),n}function dh(n,t,i){if(n.htmlEncode())if(n.TextMode==3){for(var r=$app.htmlEncode(t).split(/\r?\n/),f,u=0;u<r.length;u++)f=r[u],m=f.match(/^\s+/),m&&(r[u]=Array(m[0].length*2).join("&nbsp;")+f.substring(m[0].length));t=r.join("<br/>");r.length>15?(i.html('<div class="app-text-collapsible"><\/div>').children().html(t),$('<span class="ui-btn ui-btn-icon-notext ui-btn-inline ui-icon-carat-d ui-inline ui-corner-all app-btn-toggle"/>').attr("title",pe.Maximize).appendTo(i)):i.html(t)}else i.text(t);else i.html(t)}function cv(n){return String.format("{0} - {1}",vt.QuickFindText,n.get_view().Label)}function ou(n){n.refreshCallback&&(n.refreshCallback(),n.refreshCallback=null)}function gh(t,i){t.find("> .app-map, > .app-presenter-instruction").hide();i._mapPageWindow=null;n.presenter("hide",{container:t})}function nc(){return String.format("{0:"+$app.dateFormatStrings["{0:f}"]+"}",new Date)}function yr(n){var t=r.pageTransition!="none";if(arguments.length==0)return t;t||n.removeClass("ui-panel-animate")}function uo(n,i){n._hasKey()&&$('<span class="app-btn-more">&nbsp;<\/span>').appendTo(i).attr("title",t.More)}function pf(n,t){if(n=$(n),t==null&&(t=n.val().length),n.length)try{n[0].setSelectionRange(t,t)}catch(i){}}function tc(n,t){n.extension().quickFind(t);pc(n)}function pr(n){var t=[];return n&&n.viewProp("useAdvancedSearch")&&(t=n.viewProp("advancedSearchFilter")||t),t}function su(n){du(n);rc(n);$(n._allFields).each(function(){delete this._listOfValues});n._forceSync();n.refreshData();bo();pc(n)}function fo(n,t){!t&&pr(n).length&&n.viewProp("advancedSearchFilter",null);n.clearFilter();su(n)}function ic(n){var r=n._filter,t=pr(n),i;return t.length&&(n._filter=t,i=n.extension().filterStatus(!0),n._filter=r),i}function rc(n){var t=(n.get_filter()||[]).slice(0),r=[],u,i=0;for($(n.get_externalFilter()).each(function(){r.push(this.Name)});i<t.length;)u=t[i],Array.indexOf(r,u.match(/^\w+/)[0])!=-1?t.splice(i,1):i++;n.viewProp("filter",t);$(document).trigger("searching.app")}function uc(){var t=n._menuStrip;return t&&t.strip.is(":visible")}function hu(t){var r=n._menuStrip,i=r&&r.strip,u=n._menuPanel;if(i){var o=$(u).find('li a[rel="external"]'),f=o.parent(),e=$(u).find(".ui-li-divider:not(.app-info):not(.app-copy)");arguments.length==0&&(t=uc());t?(i.show(),f.hide(),e.hide(),n._title.addClass("app-hidden")):(i.hide(),f.show(),e.show(),n._title.removeClass("app-hidden"))}}function fc(n){n.length&&n[n.length-1].text&&n.push({})}function wf(t){var i;t=$(t);var f=t.attr("data-causes-calculate"),u=t.attr("data-causes-populate"),r=t.attr("data-causes-copy"),i;r&&(r=r.split(/\./),i=$app.find(r[1]),i._copyStaticLookupValues(i.findField(r[0])));f&&n.causesCalculate(f);u&&(u=u.split(/\./),$app.find(u[1])._raisePopulateDynamicLookups());i=n.dataView();i&&!t.is(":checkbox,:radio")&&setTimeout(function(){i.extension().calculate(n.dataView())},200)}function ec(n){var e=$(n.target),t,i,u,r=[],f;t=e.closest(".app-container-scrollable");t.length&&(i=t.next(),u=t.data("data-field"),t.find(":checkbox,:radio").each(function(n){$(this).is(":checked")&&(r.length&&r.push(","),r.push(di(u)[n][0]))}),f=i.val(),i.val(r.join("")),f!=i.val()&&wf(i))}function oc(t,i,r){var f=t.ItemsStyle=="CheckBoxList",h=di(t,r),o=i.attr("id"),u=i.prev(),c=u.is(".app-container-scrollable"),s,e,l=[],a=i.val(),v=a.split(/\s*,\s*/),p=Math.min(Math.ceil(di(t).length/(t.Columns>1?t.Columns:1)),Math.max(Math.ceil(n.screen().height*.45/kh()),3));c?(s=u.find("fieldset"),s.find(":checkbox,:input").off().checkboxradio("destroy"),s.controlgroup("destroy"),u.empty()):u=$('<div class="app-container-scrollable"><\/div>').attr("data-columns",t.Columns);$(h).each(function(n){n%p==0&&(e=$('<fieldset class="app-controlgroup-vertical"/>').appendTo(u),l.push(e));var r=this,i=r[0],s=$("<input/>").attr({id:o+n,type:f?"checkbox":"radio"}).appendTo(e),h=$("<label/>").attr("for",o+n).appendTo(e).text(r[1]);f||s.attr("name",o);t.HtmlEncode||h.html(r[1]);f&&(i=i!=null?i.toString():"");(f&&v.indexOf(i)!=-1||!f&&i==a)&&s.attr("checked","true")});c?h.length||u.text(y.NullValueInForms):u.insertBefore(i).data("data-field",t);$(l).controlgroup().find(":checkbox,:radio").checkboxradio();u.find(":checkbox,:radio").on("click",ec)}function bf(t,i){t.find(".app-container-scrollable").each(function(){var f=0,e=0,r=$(this),o=parseInt(r.attr("data-columns")),t=r.find("fieldset");if(i){var s=t.find(":input"),c=Math.min(Math.ceil(s.length/(o>1?o:1)),Math.max(Math.ceil(n.screen().height*.45/kh()),3)),u,h=[];t.find(":checkbox,:input").off().checkboxradio("destroy");t.controlgroup("destroy");s.each(function(n){n%c==0&&(u=$('<fieldset class="app-controlgroup-vertical"/>').appendTo(r),h.push(u));var t=$(this),i=t.prev();i.appendTo(u);t.appendTo(u)});t.remove();t=$(h).controlgroup().find(":checkbox,:radio").checkboxradio();r.find(":checkbox,:radio").on("click",ec)}i||t.each(function(){$(this).height("").find(".ui-checkbox,.ui-radio").width("")});t.each(function(){var n=$(this),t=n.width(),i=n.height();t>f&&(f=t);i>e&&(e=i)});t.each(function(){$(this).height(e).find(".ui-checkbox,.ui-radio").width(f+1)})})}function kf(){try{if(l.getSelection){var n=l.getSelection();n&&n.rangeCount>0&&n.removeAllRanges()}else document.selection&&document.selection.empty()}catch(t){}}function df(t){var r=n._menuStrip,i=r&&r.strip;i&&(i.hide(),arguments.length==1&&i.attr("data-enabled",t?"true":"false"))}function lv(n,t){t=="Cards"?n.addClass("app-cardview").removeClass("app-grid app-onecolumnview"):t=="Grid"?n.addClass("app-grid").removeClass("app-cardview app-onecolumnview"):t=="List"&&n.addClass("app-onecolumnview").removeClass("app-cardview app-grid")}function cu(t,i){$app.find(t).extension().viewStyle(i);n.pageInfo(t).echoChanged=!0;p(!0);p(!1,10)}function eo(n,t){if(t.instruction){var i=n.find("> .app-presenter-instruction"),r=t.instruction();i.length||(i=$('<div class="app-presenter-instruction"><\/div>').appendTo(n).hide());r?(i.show(),i.html(r)):i.hide();sc(t.dataView(),n.closest(".ui-page"),!1,!0)}}function sc(n,t,i,r){var e=n.extension(),f,u;e._instructed||n._totalRowCount==-1||(f=e.instruction(),u=t.find(".dv-heading"),(f||i)&&(e._instructed=!0,u.length||(u=$('<span class="dv-heading"/>').appendTo(t).hide()),f&&u.html(f.replace(/<a.*?<\/a>/gi,"")).attr("data-selector",r?".app-presenter-instruction:visible":"ul.app-listview li.app-list-instruction"),i&&ts(n,u),ni()))}function av(){$('div[data-role="presenter"]').addClass("app-stale");oo()}function oo(t){function i(i){var u=i.attr("data-presenter"),r=n.dataView();!i.closest(".app-echo-inner").length&&r&&i.css("display")!="none"&&n.presenter("show",{name:u,id:r._id,container:t||i.closest(".app-wrapper")})}t?(t.find('div[data-role="presenter"]').each(function(){i($(this))}),$('.ui-page:not(.ui-page-active) div[data-role="presenter"]').each(function(){var n=$(this);n.closest(".app-echo-inner").length||n.addClass("app-stale")})):$('div[data-role="presenter"].app-stale').each(function(){var n=$(this);n.removeClass("app-stale");i(n)})}function hc(n){n.find("> .app-map").each(function(){var i=$(this),u=n.find("> .app-page-header:visible"),f=n.find("> .app-presenter-instruction:visible"),r=$(f.length&&f||u.length&&u),e=i.data("data-map"),t,o;i.css("top",r.length?r.position().top+r.outerHeight(!0):0);i.is(":visible")&&e&&(t=e.map,o=t.getCenter(),google.maps.event.trigger(t,"resize"),t.setCenter(o))})}function so(n){n.css({display:"block","z-index":-10});pt(n);n.css({display:"","z-index":""})}function pt(n){var f=i.activePage;n||(n=f);var e=n.attr("id")==f.attr("id"),o=e?n:f,r=o.css("padding-top"),t=o.css("min-height"),a=n.find(".ui-content > .app-bar-header,.ui-content > .app-bar-actions,.ui-content > .app-tabs"),v=n.find(".ui-content > .app-bar-footer"),s=eu&&n.find(eu.fixedTop.selector),h=s&&s.css("position")=="fixed"&&s.outerHeight(),c=eu&&n.find(eu.fixedBottom.selector),l=c&&c.css("position")=="fixed"&&c.outerHeight(),u=0;e?(i.resetActivePageHeight(),t=o.css("min-height")):n.css({"padding-top":r,"min-height":t});t=parseInt(t.substring(0,t.length-2));r=parseInt(r.substring(0,r.length-2));n.find(".app-wrapper").each(function(){var i=$(this),n=0;a.each(function(){var t=$(this);t.css("display")!="none"&&(n+=t.outerHeight(!0))});v.each(function(){var n=$(this);n.css("display")!="none"&&(u+=n.outerHeight(!0))});n&&(t=t-n,r=r+n);h&&(t-=h,r+=h);l&&(t-=l,u+=l);u&&(u-=2);i.css({top:r,bottom:u,"min-height":t-u});e&&i.css({height:t-u});hc(i)})}function vv(){return ci?g.width()>=720:g.width()>=768&&g.height()>=704}function yv(){function k(n){return n&&n.match(/Landscape|Always|Never/)}var n=__settings,v=n.mobileDisplayDensity,h=Sys.Browser,y,l,p,s=$("#PageHeader").parent(),o=u.attr("data-theme")||(s.attr("class")||"").match(/\bpage-theme-(\w+)\b/i),a=$("div[data-content-framework]:first"),w=c("buttonShapes"),b=c("promoteActions"),e;typeof o=="string"&&(o=[0,o]);s.length||(s=u);r={mapApiIdentifier:n.mapApiIdentifier,pageTransition:c("pageTransition")||n.transitions||(hr?"fade":f()?"none":"slide"),sidebar:c("sidebar")||k(n.sidebar)||"Landscape",theme:o&&o[1]||c("theme")||n.theme,themeDisabled:o!=null,displayDensity:c("displayDensity")||(f()?n.desktopDisplayDensity:v=="Auto"?vv()?"Compact":"Comfortable":v),labelsInForm:c("labelsInForm")||n.labelsInForm,labelsInList:c("labelsInList")||n.labelsInList,buttonShapes:w!=null?w:n.buttonShapes||!0,promoteActions:b!=null?b:n.promoteActions||!0,initialListMode:c("initialListMode")||n.initialListMode||"SeeAll"};h.agent==h.InternetExplorer&&h.version<=9&&(u.hide(),n&&n.ui?(y=(new Date).getDate()+365,l=new Date,l.setDate(y),p=String.format("appfactorytouchui=false; expires={0}; path=/",l.toUTCString()),document.cookie=p,location.reload(i.path.parseUrl(location.href).hrefNoHash)):alert(t.TouchUINotSupported));et&&(u.addClass("app-ios"),gu<8&&u.addClass("app-ios7"));hr&&u.addClass("app-android");r.buttonShapes==!1&&u.addClass("app-buttons-text-only");s.is(".Tall")&&u.addClass("app-page-header-hidden");(s.is(".Wide")||a.length&&a.attr("data-sidebar")!="true"||!a.length&&$('div[data-app-role="page"]:first').attr("data-sidebar")=="false")&&(r.sidebar="Never",r.sidebarDisabled=!0);$(document).trigger($.Event("appinit"));i.defaultPageTransition=r.pageTransition;ro();r.displayDensity||(r.displayDensity=f()?"Compact":"Comfortable");u.addClass(us(r.theme));u.addClass(fs(r.displayDensity));r.labelsInForm=="AlignedRight"&&u.addClass("app-labelsinform-alignedright");r.labelsInList=="DisplayedAbove"&&u.addClass("app-labelsinlist-displayedabove");f()&&(e=Sys.CultureInfo.CurrentCulture.dateTimeFormat,$.datepicker.setDefaults({prevText:"",nextText:"",monthNames:e.MonthNames,monthNamesShort:e.AbbreviatedMonthNames,dayNames:e.DayNames,dayNamesShort:e.AbbreviatedDayNames,dayNamesMin:e.ShortestDayNames,firstDay:e.FirstDayOfWeek,constrainInput:!1,showOtherMonths:!0,changeMonth:!0,changeYear:!0}),$.datepicker.parseDate=function(n,t){var i=$(this._lastInput).attr("data-format-string")||"{0:d}";return Date.tryParseFuzzyDate(t,i)},$.datepicker.formatDate=function(n,t){var r=$(this._lastInput),u=r.attr("data-format-string")||"{0:d}",i=Date.tryParseFuzzyDate(r.val(),u);return i&&(t.setHours(i.getHours()),t.setMinutes(i.getMinutes()),t.setSeconds(i.getSeconds())),String.localeFormat(u,t)})}function ho(n,t,i){if(ke!=!1&&!b&&(t=t||n.find(".ui-collapsible:visible .ui-collapsible-heading:not(.ui-collapsible-heading-collapsed):first").parent().find(":input:first").first(),t.length)){var r=t.closest(".app-wrapper"),c=r.offset().top,u=r.scrollTop(),o=r.height(),e=t.offset().top+u-c,s=t.outerHeight(!0);function h(){f()&&!i&&(ni(),t.focus(),t[0].select&&t[0].select())}e<u||e+s>u+o?(b=!0,pi(r,e-(o-s)/2,function(){b=!1;h();i&&i()})):(h(),i&&i())}}function co(n){return(n.metaKey||n.ctrlKey)&&n.shiftKey}function cc(n){var i=!1,t;return n.is("span")&&n.get(0).scrollWidth-n.innerWidth()>0&&(t=$('<div class="ui-content app-popup-message"/>').html(n.text()).popup({history:!1,arrow:"b,t",overlayTheme:"b",positionTo:"origin",afteropen:function(){},afterclose:function(){rr(t)}}).popupopen({x:n.offset().left+n.outerWidth()/2,y:n.offset().top}).on("vclick",function(){return lt(t),!1}),i=!0),i}function lu(t){n.tabs("fit",{page:t})}function au(n){$(n).find(".app-wrapper").each(function(){var n=$(this),t=n.data("scroll-top");t&&n.scrollTop()!=t&&n.scrollTop(t)});$(n).find(".app-echo-inner").each(function(){var n=$(this),t=n.data("scroll-left");n.parent().is(":visible")&&t&&n.scrollLeft()!=t&&n.scrollLeft(t)})}function lo(n){$(n).find(".app-wrapper").each(function(){var n=$(this);n.data("scroll-top",n.scrollTop())});$(n).find(".app-echo-inner").each(function(){var n=$(this);n.parent().is(":visible")&&n.data("scroll-left",n.scrollLeft())})}function ao(n){function f(n,t){while(n.css("display")=="none"&&n.length)n=t=="next"?n.next():n.prev();return n}function o(n){return n.is(".app-presenter")&&(n.is(":visible")||(n=n.closest(".app-wrapper").find(".app-presenter:visible"))),n}var s=n.scrollTop(),h=n.height(),c=s+h,i=f(n.find("*:first"),"next"),u=i.length==0?0:Math.ceil(i.position().top-(i.is("ul")&&i.find("li:first").length?parseInt(i.find("> li:first").css("margin-top").replace("px","")):0)),t=o(n.find("> *:last")),r=t.is("ul")&&t.find("li:first").length?t.find("> li:last"):t.is(".app-presenter")?f(t.find("> *:last"),"prev"):t,l=r.position().top,e=Math.ceil(l+r.outerHeight()+parseInt(r.css("margin-top").replace("px",""))+(ci?0:+parseInt(r.css("margin-bottom").replace("px","")))+parseInt(t.css("margin-bottom").replace("px",""))),a=-1*(u-e);return{top:u,height:c,maxHeight:a,firstTop:u,lastBottom:e}}function gf(n){var t=n.find(".ui-panel-inner"),i,r,u;if(t.length)t.on("scroll keydown keyup",function(){b||i||(i=!0,r=t.scrollTop(),ri=!0,u=setInterval(function(){var n=t.scrollTop();n!=r?r=n:(clearInterval(u),i=!1,ri=!1,t.data("scroll-stop-time",new Date))},200))})}function pv(n){wrapper=n.find(".ui-panel-inner").off("scroll keydown keyup")}function vo(n,t){function v(n){r.data("scroll-dir",n);$(document).trigger($.Event("scrolldir.app",{relatedTarget:r}))}var r=n.find(".app-wrapper:first"),s,h,e,u,c,l,a,o;if(!r.length){if(s=n.find(".ui-content"),h=s.contents(),r=$('<div class="app-wrapper"/>').appendTo(s),t!=!1)r.on("wheel DOMMouseWheel mousewheel",function(n){if(e&&"deltaY"in n.originalEvent){var i=r.data("scroll-dir"),t=n.originalEvent.deltaY>0?"down":"up";t!=i&&v(t)}}).on("touchstart",function(){et&&gu<8&&(o=!1,ui=!0)}).on("touchmove",function(){et&&(l=vr(),a=r.scrollTop())}).on("touchend",function(){if(et&&gu<8){var t=vr()-l,n=r.scrollTop(),i=Math.abs(a-n);t>0&&i/t>.25||n<0||n>r.height()?o=!0:ui=!1}}).on("scroll",function(){if(!b)if(e){var f=r.data("scroll-dir"),n=r.scrollTop(),t=n<u?"up":n==u?"none":"down";(t!=f||r.scrollTop()<i.getScreenHeight())&&v(t)}else e=!0,u=r.scrollTop(),$(document).trigger($.Event("scrollstart.app",{relatedTarget:r})),ri=!0,c=setInterval(function(){var n=r.scrollTop();n!=u?u=n:(clearInterval(c),e=!1,ri=!1,r.data("scroll-stop-time",new Date),$(document).trigger($.Event("scrollstop.app",{relatedTarget:r})),o&&(o=!1,ui=!1))},200)});f()&&r.attr("tabindex",0);$('<div class="app-page-header"><h2/><h1/><\/div>').appendTo(r);h.appendTo(r)}return r}function o(t){n.activeLink(t)}function yo(n){o(n);setTimeout(function(){o()},200)}function e(n,t){n=$(n);n.is(".app-btn-more")?(n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");sf="link";t(n)},fi)):(o(n),setTimeout(function(){o();sf="link";n&&n.is(".app-btn")&&(sf="toolbar");t(n)},fi))}function lc(n,t){if(t||(t=n.find(".app-stub,.app-stub-main")),t.length){var i=Math.ceil(t.offset().top),r=Math.ceil(n.offset().top),u=n.height();i>r&&(i>r+u?t.height(""):t.height(u-(i-r)))}}function po(){ot();n.promo(!1);u.find("> *").hide()}function wo(){at&&at._updateLastActivity()}function bo(){i.activePage.find(".dv-heading").removeClass("app-disabled")}function ne(){return we||(we=$("#app-sidebar")),we}function ko(){return ne().is(":visible")}function go(n){cf&&(clearTimeout(cf),cf=null);n&&(lf=null)}function ns(t){return hf?!0:n.causesCalculate()?(hf=setInterval(function(){n.causesCalculate()||(clearInterval(hf),hf=null,t())},100),!0):!1}function wt(n,t){n&&(ns(function(){wt(n,t)})||(n.callback?n.callback(n.context,t):n.href&&(l.location.href=n.href)))}function vu(n){var t=i.activePage;t&&t.find(".dv-load-at-top").css("visibility",n?"hidden":"");b=n}function a(){var n=i.activePage;return n?n.attr("id"):"_"}function te(){return a()=="Main"}function bt(){return a()=="advanced-search"}function ac(n){return n?n.toJSON().slice(0,10):null}function vc(n){return n?new Date(n.getTime()-n.getTimezoneOffset()*6e4).toJSON().slice(0,19):null}function wv(n){return n?yc(n+"T00:00:00"):null}function yc(n){var t=n?new Date(n.substring(0,4),parseInt(n.substring(5,7))-1,n.substring(8,10),n.substring(11,13),n.substring(14,16),0,0):null;return t!=null&&(t=new Date(t.getTime()-t.getTimezoneOffset()*6e4)),t}function oi(t){var f=16,e=r.displayDensity;e=="Compact"?f==14:e=="Condensed"&&(f=12);$(t||i.activePage.find(".app-listview")).each(function(){var e=$(this),p=e.parent(),d=e.closest(".ui-page"),rt,st="w"+Math.ceil((g.width()-(ko()?ne().outerWidth():0))/f/5)*5,i=ch[st],ut,ht,ct,lt,at,c="app-width",a=e.attr("data-yardstick-class"),o=u.find("#app-yardstick"),nt=e.is(".app-grid"),w=p.is(".app-echo-inner"),vt=w||p.is(".app-map-info"),b,tt;if((!i&&!vt||w&&nt)&&(o.length||(o=$('<ul id="app-yardstick" class="app-listview"><li class="dv-item"><a><span>1<\/span><\/a><\/li><li><a class="dv-item">2<\/a><\/li><li><a class="dv-item">3<\/a><\/li><\/ul>').appendTo(u).listview()),w&&nt&&(p=p.closest(".app-wrapper")),o.appendTo(p).show(),ut=o.find("li:first"),rt=d.css("display"),rt!="block"&&d.css("display","block"),ct=ut.outerWidth(),o.addClass("app-cardview"),ht=ut.outerWidth(),o.removeClass("app-cardview"),o.addClass("app-grid"),lt=firstSpanPadding=o.find("span:first"),at=parseInt(lt.css("margin-left").replace("px","")),o.removeClass("app-grid"),rt!="block"&&d.css("display",""),o.appendTo(u).hide(),i={card:Math.ceil(ht/f/5)*5,list:Math.ceil(ct/f/5)*5,columnPadding:at,grid:{}},ch[st]=i),c+=!nt&&vt?Math.ceil(e.width()/f/5)*5:e.is(".app-cardview")?i.card:i.list,c!=a&&(a&&e.removeClass(a),e.addClass("app-yardstick "+c).attr("data-yardstick-class",c)),nt&&(b=n.pageInfo(w?e.closest(".app-echo").attr("data-for"):d.attr("id")),tt=b?b.id+"_"+b.dataView._viewId:null,tt&&!i.grid[tt])){i.grid[tt]=!0;var k=b.dataView,dt=k._fields,gt=k._allFields,s=[],r,v,yt=3,h=0,y=i.list*f,ft=4*f+i.columnPadding,t,it=new Sys.StringBuilder;$(dt).each(function(){var t=this,n=gt[this.AliasIndex];t.Hidden||t.OnDemand||(r=n.Columns,n.ItemsStyle=="CheckBoxList"?r=80:r>80?r=80:r||(n.Type=="String"?(r=30,n.Len>0&&n.Len<r&&(r=n.Len)):r=15),h+=r,v=0,t.tagged("item-aside")?v=1:t.tagged("item-count")?v=2:(t.tagged("item-para")&&yt++,v=t.tagged("item-desc")?yt:100),s.push({className:String.format("gc_{0}_{1}_{2}",k._id,k._viewId,n.Name),cols:r,priority:v,type:n.Type}))});var l=s[0],et=l.cols,pt,wt,ot=!0,bt=0,ni=k._hasKey();s.reverse();l.priority=0;function kt(){h-=l.cols-et;l.cols=et;l.cols/h*y<ft&&(l.cols=Math.floor(ft/y*h),h+=l.cols-et)}kt();function ti(){$(s).each(function(n){var r,i;if(t=this,!t.hidden&&(t.width=t.cols/h*y,t.width<ft)){for(r=0;r<n&&t.priority>1||r<s.length&&t.priority<2;)if(i=s[r++],t!=i&&!i.hidden&&i.priority>=t.priority&&i.priority>1)return i.hidden=!0,ot=!0,h-=i.cols,!1;t.priority>1&&(t.hidden=!0,h-=t.cols)}})}while(ot)ot=!1,ti();$(s).each(function(){this.hidden||bt++});bt<2&&s.length>0&&(kt(),$(s.reverse()).each(function(){return t=this,t.hidden?(t.hidden=!1,h+=t.cols,!1):void 0}));pt=h;y-=w?32:16;$(s).each(function(){t=this;t.hidden?it.appendFormat(".app-grid.app-width{0} .{1}, .app-grid-header.app-width{0} .{1} {{display:none!important;}}",i.list,t.className):it.appendFormat(".app-grid.app-width{0} .{1}, .app-grid-header.app-width{0} .{1} {{width:{2}%;}}",i.list,t.className,(t.cols/pt-i.columnPadding/y-(t==l&&ni?22/y:0))*100);it.appendLine()});wt=it.toString();$("<style>").appendTo($("head")).text(wt)}e.find("li.app-yardstick").each(function(){var n=$(this);c="app-width"+i.list;a=n.attr("data-yardstick-class");c!=a&&(a&&n.removeClass(a),n.addClass(c).attr("data-yardstick-class",c))})})}function bv(){var r=n.pageInfo(),t,i;r&&(t=r.dataView,i=t&&t.extension(),i&&t.get_isGrid()&&(be=!0,i.executeInContext("Eye",null,!1)))}function nr(n,t){return t&&n.addClass("app-width"+t),n}function it(t){var i=n._menuButton;if(arguments.length==0)return i.is("."+er);i&&n.toolbar().is(":visible")&&(t=="off"?i.removeClass(er):t?i.addClass(er):setTimeout(function(){i.removeClass(er)},500))}function vi(){it(!0);g.one("beforeunload pagehide",function(){it(!1)})}function pc(){}function wc(){var i=n._menuButton,r,u;i&&n.toolbar().is(":visible")&&(r=n.toolbar(),u=a(),u=="Main"||n._pages.length&&u==n._pages[0].id&&n._pages[0].home?(i.removeClass("ui-icon-back ui-icon-bars "+er).addClass("ui-icon-bars").attr({href:"#app-btn-menu",title:t.Menu}),r.removeClass("app-has-history")):(i.removeClass("ui-icon-bars "+er).addClass("ui-icon-back").attr({href:"#app-back",title:t.Back}),r.addClass("app-has-history")))}function bc(n){n.length&&(hh[a()+"_"+n.attr("id")]=n.find(".ui-panel-inner").scrollTop())}function kv(n){n.length&&n.find(".ui-panel-inner").scrollTop(hh[a()+"_"+n.attr("id")]||0)}function ts(n,t){var u=n._fields,e=n._allFields,r=!0,i;t.is(":empty")||t.wrapInner('<span class="app-grid-desc"/>');i=$('<div class="app-grid-header"/>').appendTo(t);$(u).each(function(){var l=this,t=e[l.AliasIndex],u,s,o,a,y,h,v,c;l.Hidden||l.OnDemand||(u=$("<span><\/span>").addClass(String.format("gc_{0}_{1}_{2}",n._id,n._viewId,t.Name)).text(t.HeaderText).attr("title",t.HeaderText).attr("data-field-name",t.Name).appendTo(i),s=ti(n,t.Name),o=n.get_fieldFilter(t,!0),s?(h=$('<span class="app-icon app-indicator"><\/span>').appendTo(u).attr("title",ir(t,s)),s.toLowerCase()=="asc"?u.addClass(o?"app-filter-asc":"app-sort-asc"):u.addClass(o?"app-filter-desc":"app-sort-desc")):o&&(h=$('<span class="app-icon app-indicator"><\/span>').appendTo(u),u.addClass("app-filter-on")),o&&($(n._filter).each(function(){var n=this;if(n.startsWith(t.Name+":"))return a=n,!1}),a&&f()&&(y=n._filter,n._filter=[a],v=h.attr("title"),c=n.extension().filterStatus(!0),v&&c.match(/\.\s*$/)&&(c+=" "+v+"."),h.attr("title",c),n._filter=y)),r&&(r=!1,uo(n,i)))})}function yu(n,t,i,r,u){var e=n._fields,o=n._allFields,f;$(e).each(function(e){var l=this,h=o[l.AliasIndex],a=h.itemColumnClass||String.format("gc_{0}_{1}_{2}",n._id,n._viewId,h.Name),c,s;l.Hidden||l.OnDemand||(c=$("<span><\/span>").appendTo(r).addClass(a+" app-field app-field-"+h.Name),h.itemColumnClass||(h.itemColumnClass=a),s=t[u?l.Index:h.Index],s==null&&c.addClass("app-null"),s=h.text(s,!1),e==0&&(i!=null&&(s=String.format("{0}. {1}",i,s)),uo(n,r)),u?(f=u?u[e]:null,f&&(s=t[l.Index],s=String.localeFormat(l.DataFormatString||"{0:n0}",s),c.text(s),$('<div class="app-static-text"><\/div>').text(f).insertBefore(c.contents()),c.attr("title",h.HeaderText+"\n"+f+" "+s))):(h.HtmlEncode?c.text(s):c.html(s),c.attr("title",s)))})}function tr(n,t,i,u,f,e,o){var c=n._allFields,b=e.is("a"),y=$("<h3>").appendTo(e),w=c[i.heading],s,h,l,a,v,p;if(i.thumb!=null)if(s=t[i.thumb],s&&s.toString().match(/^null/))f.addClass("ui-li-has-thumb");else var d=n.resolveClientUrl(n.get_appRootPath()),k=c[i.thumb],g=$('<img class="ui-li-thumb"/>').appendTo(e).attr({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",d,k.OnDemandHandler,s,k.OnDemandStyle==2?"&_nocrop":"")});s=t[i.heading];s=w.text(s);b&&e.attr("title",s);w.HtmlEncode?y.text(s):y.html(s);y.addClass("app-field app-field-"+w.Name);u&&$('<span class="app-item-number"/>').insertBefore(y.contents()).text(u+". ");i.aside!=null&&(f.addClass("app-li-has-aside"),h=nr($('<p class="ui-li-aside"/>').appendTo(e),i.asideRwd),l=c[i.aside],s=t[i.aside],s=l.text(s),l.HtmlEncode?h.text(s):h.html(s),h.addClass("app-field app-field-"+l.Name),i.asideLabel&&nr($('<span class="app-item-label"/>').insertBefore(h.contents()).text(l.HeaderText),i.asideLabelRwd));i.count!=null&&(h==null||i.desc.length)&&(a=nr($('<span class="ui-li-count"/>').appendTo(e),i.countRwd),v=c[i.count],s=t[i.count],s=v.text(s),v.HtmlEncode?a.text(s):a.html(s),a.addClass("app-field app-field-"+v.Name),i.countLabel&&nr($('<span class="app-item-label"/>').insertBefore(a.contents()).text(v.HeaderText),i.countLabelRwd));i.desc.length&&(p=$('<p class="app-para"/>').appendTo(e),$(i.desc).each(function(n){var l=this,u=c[l],w=i.descLabels[n],a=i.descLabelsRwd[n],b=i.descPara[n],h,v=u.HeaderText,f,y;b&&(p=$('<p class="app-para"/>').appendTo(e).insertAfter(p));s=t[l];y=s==null;f=nr($('<span class="app-item-desc"/>').appendTo(p),i.descRwd[n]).addClass("app-field app-field-"+u.Name);s=u.text(s);o?dh(u,s,f):u.HtmlEncode||u.TextMode==3?f.text(s):f.html(s);h=f.contents();w&&(r.labelsInList=="DisplayedAbove"?nr($('<span class="app-item-label-before"/>').insertBefore(h.first()).text(v),a):nr($('<span class="app-item-label-after"/>').insertAfter(h.last()).text(v),a));y&&h.wrap('<span class="app-null"/>')}));b&&uo(n,e)}function is(n,t,i){var h=".app-listview li a.app-selected:first,.app-wrapper .app-map",u=n._lookupInfo?n._id:n._parentDataViewId||n._id,r=$("#"+u).find(h),f,e=$app.find(u),s,o,c;return r.length||(r=$("#"+n._id+"_echo .app-echo-inner .app-selected"),u=n._id,e=n),r.length||(u=n._filterSource,r=$("#"+u).find(h),e=$app.find(u)),r.length&&(f=$('<li class="app-li-card">'),t&&f.appendTo(t),r.is(".app-selected")?(s=r.data("data-context"),s&&(o=s.row)):(c=r.data("data-map"),c&&(o=e.extension().commandRow())),o&&(tr(e,o,e.extension().itemMap(),null,f,f),i!=!1&&(contextDataView=$app.find(u),$('<span class="app-li-corner">').appendTo(f.addClass("app-li-has-corner")).text(contextDataView.get_view().Label)),r.parent().is(".app-li-has-aside")&&f.addClass("app-li-has-aside"))),f}function ft(t,r){var f,u,e,s,h,o,c="";if(r)u=r.closest(".ui-page");else{if(u=i.activePage,!u)return;r=u.find(".app-page-header")}if(s=r.find("h1"),h=r.find("h2"),e=u.attr("data-page-header")!="false",typeof t=="boolean")t&&e?r.show():(r.hide(),u.attr("data-page-header","false"));else return f=r.data("data-text"),t?(f&&typeof f!="string"&&typeof t=="string"&&(f[1]=t,t=f),r.data("data-text",t)):t=f,t&&(typeof t=="string"?o=t:(o=t[0],c=t[1])),r.attr("data-locked")!="true"&&(s.text(o),h.text(c)),t!=n.title()&&e?r.show():(r.hide(),e&&u.attr("data-page-header","false")),t}function kc(n){nt();var t=Math.ceil(g.width()*.9);t>800&&(t=800);n.css({maxWidth:t})}function pu(t,i){i==null&&(i=ei);ei=null;var r=t.extension();r.useAdvancedSearch()?wr(t,i,i&&"none"):n.search("configure",{text:i||r.quickFind(),placeholder:cv(t),focus:!0,scope:t._id,setCursor:!!i})}function dc(n){var t=$app.find($("#advanced-search").attr("data-scope"));bt()?(t.extension().useAdvancedSearch(!1),e(n,function(){u.one("pagecontainershow",function(){setTimeout(function(){pu(t)},200)});ai=null;history.go(-1)})):pu(t)}function wr(e,o,s){function rt(n,t,i,r){var f=i.SearchOptions,u=t.FilterType;return{field:t.Name,originalField:i.Name,id:n._id,mappedId:n._mappedId,filterField:n._mappedId&&n._filterFields[0],headerText:t.HeaderText,scopeText:n._mappedId&&n.get_view().Label,filterType:u,operation:f&&$app.filterDef(y.Filters[u].List,f[0])&&f[0]||(u=="Boolean"?"$true":u=="Text"?"$contains":"="),value:null,value2:null,values:[],required:r==!0}}function et(n,t,i){var r=a(),u=r._fields,f=r._allFields;$(u).each(function(){var u=this,o=f[u.AliasIndex],e=u.Search,s=e==1&&n=="Required",h=e==2&&n==="Suggested",c=e==4,l=!n&&t.length<3||s||h;o.AllowQBE&&l&&!c&&t.push(rt(r,o,u,s&&i==!0))})}function k(n,t){var l=t.find(".app-condition-list-field").text(n.headerText),i=n.operation,h=y.Filters[n.filterType],f=h.Kind.toLowerCase(),a=$app.filterDef(h.List,i),c=!i.match(th),v=c&&i=="$between",o=t.find(".app-condition-list-operation"),r=t.find(".app-input-container:first"),p=r.find(".app-input-value"),w=r.find(".app-input-text"),s=r.next(),u=s.next(),b=u.find(".app-input-value"),k=u.find(".app-input-text"),e=t.find(".app-condition-list-values");n.scopeText&&$("<span/>").appendTo(l).text(n.scopeText);o.text(a.Text);i.match(/month/)?o.addClass("app-condition-list-operation-month"):o.removeClass("app-condition-list-operation-month");p.text(f);w.attr("placeholder",f);b.text(f);k.attr("placeholder",f);c?r.show():r.hide();v?(s.show(),u.show()):(s.hide(),u.hide());r.find(":input").val(n.value);u.find(":input").val(n.value2);i=="$in"||i=="$notin"?(e.show(),e.text(n.lovText||ga.SelectLink),e.addClass("app-has-children")):e.hide();t.data("condition",n)}function wt(n,i){var r=$('<li class="app-condition ui-body-a"><\/li>').appendTo(i),f,u;return f=$('<a class="app-condition-list-field app-btn-select ui-btn ui-corner-all ui-btn-inline"/>').appendTo(r),(!n.required||r.closest(".app-conditions").prev().length)&&f.addClass("app-has-children"),$('<a class="app-condition-list-operation app-btn-select ui-btn app-has-children ui-corner-all ui-btn-inline"/>').appendTo(r),u=$('<div class="app-input-container ui-first-child"><\/div>').appendTo(r),$('<input type="text" class="app-input-text"/>').appendTo(u),$('<span class="app-input-value"/>').appendTo(u).css("visibility","hidden"),$('<span class="app-condition-and"/>').appendTo(r).text(y.Filters.Labels.And),u=$('<div class="app-input-container ui-last-child"><\/div>').appendTo(r),$('<input type="text" class="app-input-text"/>').appendTo(u),$('<span class="app-input-value"/>').appendTo(u).css("visibility","hidden"),$('<a class="app-condition-list-values app-btn-select ui-btn ui-corner-all ui-btn-inline"/>').appendTo(r),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(r).attr("title",t.More),k(n,r),r}function ot(n,i){var r=$('<ul class="app-condition-list ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)).data("group",i),f=$('<li class="app-matching ui-body-a"><\/li>').appendTo(r),u;return $('<a class="app-condition-list-scope app-btn-select ui-btn app-has-children ui-corner-all ui-btn-inline"/>').appendTo(f).text(t[i.scope]),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(f).attr("title",t.More),$(i.conditions).each(function(){wt(this,r)}),u=$('<li class="app-condition app-condition-more ui-body-a"><\/li>').appendTo(r),$('<a class="app-condition-list-field app-btn-select ui-btn ui-corner-all ui-btn-inline app-has-children"/>').appendTo(u).text(vt.AddConditionText),b(i).length||!c()&&st().length||u.hide(),r.parent()}function kt(n,t,i){var r=r={scope:"MatchAll",required:!1},u=[],f=[];et("Required",u,i);et("Suggested",f);u.length?r.conditions=u.concat(f):f.length?r.conditions=f:(et(null,u),r.conditions=u,t&&(n.push(r),r=JSON.parse(JSON.stringify(r)),r.scope="MatchAny"));n.push(r)}function b(n,t){function f(n,t){$(n._fields).each(function(){var i=this,u=n._allFields[i.AliasIndex],f=i.Search,e=f==4;!u.AllowQBE||e||r.indexOf(u.Name+"."+n._mappedId)!=-1||n._mappedId&&i.Name==n._filterFields[0]||t.push(i)})}var u=c(),i=[],r=[],e;if($(n.conditions).each(function(){r.push(this.field+"."+this.mappedId)}),includeIndex=r.indexOf(t),includeIndex>=0&&r.splice(includeIndex,1),f(a(),i),u){i._hasChildren=!0;for(e in u)f(u[e],i)}return i}function dt(n,t,i,r){var u;$(n).each(function(){var o=this,f=o._dataView,e=f._mappedId,s;field=f._allFields[o.AliasIndex];n._hasChildren&&(u?e&&u!=e&&(t.push({text:f.get_view().Label}),u=e):(t.push({text:f.get_view().Label}),u=f._id||e));s=i==field.Name+"."+e;t.push({text:field.HeaderText,icon:s?"check":!1,visible:s,context:{field:field.Name,originalField:o.Name,id:f._id,mappedId:e},callback:r})})}function gt(n,t,i){function e(t,u){for(var s=0;s<t.length;s++){var o=t[s],h=o&&o.Function,c=h==n.operation;o?o.List?e(o.List,u):f&&r.indexOf(h)==-1||u.push({text:o.Text,icon:c?"check":!1,visible:c,context:h,callback:i}):f||u.push({})}}var u=nt(n),o=u.findField(n.field),s=u.findField(n.originalField),r=s.SearchOptions,f=r&&r.length;e(y.Filters[o.FilterType].List,t)}function d(n,t){var i=st(),r=[];(to().length||n==!0)&&($(i).each(function(){var n=$app.find(this.id);r.push({Controller:n._controller,View:n._viewId,RequiresMetaData:!0,DoesNotRequireData:!0})}),$app._invoke("GetPageList",{requests:r},function(r){if(n==!0||n()){var f={};$(r).each(function(n){var r=this,e=i[n],o=e.id,t=new Web.DataView($("<div><\/div>").appendTo(u));t._render=function(){};r.Expressions=[];t._servicePath=a()._servicePath;t._controller=r.Controller;t._viewId=r.View;t._onGetPageComplete(r);t._filterFields=e.filterFields;t._mappedId=o;f[o]=t});c(f);t()}}))}function ni(n,t){var i=n.find(".ui-listview"),r=f(),u;r&&i.hide();items=[];t(items);ur(i);ys(i,items,{});i.listview("refresh");r&&i.show();u=n.data("position-options");n.popup("reposition",n.data("position-options"))}function hi(n,t,i){var r=[],u;t.mappedId&&!c()?r.push({text:ut.Loading,icon:"refresh",animate:!0,context:{},keepOpen:!0,callback:function(){}}):gt(t,r,i);w({anchor:n,items:r,afterclose:function(){u=!0;yt()},afteropen:function(){var n=this;d(function(){return u!=!0},function(){ni(n,function(n){gt(t,n,i)})})}})}function ti(n,t,i,r){var s=a(),e=st(),o=b(t,i),u=[],f;dt(o,u,i,r);e.length&&!c()&&u.push({text:ut.Loading,icon:"refresh",animate:!0,context:{},keepOpen:!0,callback:function(){}});w({anchor:n,items:u,afterclose:function(){f=!0;yt()},afteropen:function(){var n=this;d(function(){return f!=!0},function(){ni(n,function(n){dt(b(t,i),n,i,r)})})}})}function a(){return $app.find(l.attr("data-scope"))}function c(n){if(arguments.length==0)return l.data("detail-map");l.data("detail-map",n)}function st(t){t||(t=a());var i=[];return $(n._pages).each(function(){var r=this,n=r.dataView;n&&n._filterSource==t._id&&i.push({id:n._id,filterFields:n._filterFields.split(/,/)})}),i}function ii(t){var i=l.find(".app-wrapper"),r=t.closest(".app-conditions"),u=r.offset();pi(i,i.scrollTop()+u.top-(i.height()-r.outerHeight())/2,function(){n.blink(t.find(".app-matching .app-btn-select"),function(){f()&&t.find("input:visible").first().focus()})})}function ht(t){n.blink(t,function(){f()&&t.parent().find(":input:visible").first().focus()})}function ci(){$app.confirm(t.ResetSearchConfirm,function(){var n=a();n.viewProp("advancedSearchConfig",null);wr(n,null,"no")})}function ri(n,i){if(i&&i.length){var u=i.slice().reverse(),r=!0;$(u).each(function(){var i=this,f,u;n&&i.count<5||!n&&i.count>=5||(r&&(r=!1,$('<div class="app-clear-fix"><\/div>').appendTo(h),$('<div class="app-header"><\/div>').appendTo(h).text(n?t.Favorites:t.Recent)),f=$('<ul class="app-condition-list app-condition-list-history ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)),u=$('<li class="app-condition app-condition-history ui-body-a"><\/li>').appendTo(f),$("<div/>").appendTo(u).text(i.date),$("<div/>").appendTo(u).text(i.text),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(u).attr("title",t.More))})}}function g(n){if(!n)return h.find(".app-clear-fix").nextAll().andSelf().detach();n.appendTo(h)}function ui(n,t){var i=-1;return $(n).each(function(n){if(this.text==t)return i=n,!1}),i}function fi(n,t,r){var f=n[ui(n,t)],u=a();u.viewProp("advancedSearchConfig",f.config);pi(i.activePage.find(".app-wrapper"),0,function(){wr(u,null,r)})}function nt(n){return $app.find(n.id)||c()[n.mappedId]}function li(){var t,n;r.pageTransition!="none"&&o&&s!="none"&&(t=i.navigate.history.stack,t[t.length-1].transition="slidedown");n=h.find("input:visible").first();n.length&&(o&&!n.val().length&&(n.val(o),n.closest(".app-condition").data("condition").value=o),f()&&(pf(n,n.val().length),n.focus()))}var vi=e.get_filter(),yi=e.extension(),p=n.content("advanced-search"),l=p.closest(".ui-page"),it=p.find(".app-page-header"),lt=e.get_view().Label,at=t.AdvancedSearch,h=p.find(".app-panel-filter"),pt=e.viewProp("advancedSearchRecent"),v,tt,ei,ct,oi,si;if(ls(),n._contextButton.show().removeClass("ui-icon-dots").addClass("ui-icon-carat-d").attr("title",vt.HideAdvancedSearch),l.attr("data-scope")!=e._id||l.attr("data-view")!=e._viewId){if(l.attr("data-scope",e._id),l.attr("data-view",e._viewId),tt=c(),tt)for(ei in tt)ct=tt[ei],ct._element.remove(),ct.dispose();c(null);l.find(".app-wrapper").data("scroll-top",null)}it.attr("data-locked","false");ft(lt==n.title()?[at,""]:[lt,at],it);it.attr("data-locked","true");l.addClass("app-page-search app-page-scrollable");u.one("pagecontainershow",function(){ai=function(){e._totalRowCount==-1&&e.sync()}});if(!h.length){h=$('<div class="app-panel-filter"><\/div>').appendTo($("<div><\/div>").appendTo(p)).on("vclick",function(i){var r=$(i.target).closest(".ui-btn"),u=h.data("config");r.length&&n.callWithFeedback(r,function(){var s,i,f,n;if(r.is(".app-btn-more"))if(r.parent().is(".app-matching"))w({anchor:r,iconPos:"left",tolerance:2,items:[{text:nu.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){var n=r.closest(".app-condition-list"),i=n.data("group"),t=!0;$(n).find(".app-condition").each(function(){var n=$(this),i=n.data("condition");if(i&&i.required)return t=!1,w({anchor:n.find(".app-condition-list-field"),title:tu.RequiredField}),!1});t&&(u.splice(u.indexOf(i),1),n.find(".app-condition").data("condition",null),n.data("group",null).parent().remove())}},{text:nu.Scopes.Grid.Duplicate.HeaderText,icon:"duplicate",callback:function(){var n=r.closest(".app-condition-list").data("group"),t,i=g();n=JSON.parse(JSON.stringify(n));u.push(n);t=ot(a(),n);h.find(".app-matching-more").closest(".app-conditions").appendTo(h);g(i);ii(t)}}],afterclose:yt});else if(r.parent().is(".app-condition-history")){var tt=a(),p=r.parent().find("div:last").text(),o=tt.viewProp("advancedSearchRecent");r.parent().addClass("app-selected");w({anchor:r,iconPos:"left",tolerance:2,items:[{text:vt.PerformAdvancedSearch,icon:"search",callback:function(){fi(o,p,"search")}},{text:nu.Scopes.Grid.Edit.HeaderText,icon:"edit",callback:function(){fi(o,p,"no")}},{},{text:nu.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){o.splice(ui(o,p),1);tt.viewProp("advancedSearchRecent",o);var n=r.closest(".app-conditions");n.prev().is(".app-header")&&!n.next().is(".app-conditions")&&(n.prev().remove(),n.prev().remove());n.remove()}}],afterclose:function(){r.parent().removeClass("app-selected");yt()}})}else r.parent().is(".app-condition")&&w({anchor:r,iconPos:"left",tolerance:2,items:[{text:nu.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){var n=r.closest(".app-condition-list"),t=n.data("group"),i=r.parent(),f=i.data("condition");f.required&&!r.closest(".app-conditions").prev().length?w({anchor:i.find(".app-condition-list-field"),title:tu.RequiredField}):(t.conditions.splice(t.conditions.indexOf(f),1),i.data("condition",null).remove(),n.find(".app-condition").length<=1?(u.splice(u.indexOf(t),1),n.data("group",null).parent().remove()):b(t).length&&n.find(".app-condition-more").show())}}],afterclose:yt});else if(r.is(".app-btn-select"))if(r.is(".app-condition-list-scope")){i=r.closest(".app-condition-list").data("group");function l(n){i.scope=n;r.text(t[n])}w({anchor:r,iconPos:"left",items:[{text:t.MatchAll,context:"MatchAll",icon:i.scope=="MatchAll"?"check":!1,callback:l},{text:t.MatchAny,context:"MatchAny",icon:i.scope=="MatchAny"?"check":!1,callback:l},{text:t.DoNotMatchAll,context:"DoNotMatchAll",icon:i.scope=="DoNotMatchAll"?"check":!1,callback:l},{text:t.DoNotMatchAny,context:"DoNotMatchAny",icon:i.scope=="DoNotMatchAny"?"check":!1,callback:l}],afterclose:yt})}else if(r.parent().is(".app-matching-more")){function v(n){kt(u,!1,u.length==0);var t=u[u.length-1],i,f=g();t.scope=n;i=ot(a(),t);r.closest(".app-conditions").appendTo(h);g(f);ii(i)}w({anchor:r,items:[{text:t.MatchAll,context:"MatchAll",callback:v},{text:t.MatchAny,context:"MatchAny",callback:v},{text:t.DoNotMatchAll,context:"DoNotMatchAll",callback:v},{text:t.DoNotMatchAny,context:"DoNotMatchAny",callback:v}],afterclose:yt})}else if(r.parent().is(".app-condition-more"))s=r.closest(".app-condition-list"),i=s.data("group"),ti(r,i,null,function(n){var t=nt(n),u=rt(t,t.findField(n.field),t.findField(n.originalField)),f;i.conditions.push(u);f=wt(u,s);r.parent().appendTo(s);b(i).length?r.parent().show():r.parent().hide();ht(f.find(".app-condition-list-field"))});else if(r.is(".app-condition-list-field")){var s=r.closest(".app-condition-list"),i=s.data("group"),f=r.parent(),e=f.data("condition");e.required&&!r.closest(".app-conditions").prev().length?w({anchor:f.find(".app-condition-list-field"),title:tu.RequiredField}):ti(r,i,e.field+"."+e.mappedId,function(n){var u=nt(n),t=rt(u,u.findField(n.field),u.findField(n.originalField));t.value=e.value;t.value2=e.value2;$app.filterDef(y.Filters[t.filterType].List,e.operation)&&(t.operation=e.operation);i.conditions[i.conditions.indexOf(e)]=t;k(t,f);ht(r)})}else if(r.is(".app-condition-list-operation"))f=r.parent(),n=f.data("condition"),hi(r,n,function(t){n.operation=t;k(n,f);ht(r)});else if(r.is(".app-condition-list-values")){f=r.parent();n=f.data("condition");function it(){var t=nt(n),i=n.field;wy(r,t,i,n.lov,function(r){var s=r.match(/^\w+\:((\$\w+)\$|=)(.+)$/),e=t.findField(i),u=n.operation,h,o,c=[];s?(h=n.lov=s[3],o=s[1],o=="="?u="=":u=="$in"?o=="$in$"||(u="$notin"):o=="$in$"||(u="$in"),n.operation=u,u=="="?(n.value=e.text(t.convertStringToFieldValue(e,h)),n.lovText=null,n.lov=null):($(h.split(/\$or\$/g)).each(function(){var n=t.convertStringToFieldValue(e,this);c.push(e.text(n))}),n.lovText=c.join(", "))):(n.lov=null,n.lovText=null);k(n,f);yt()},yt)}n.mappedId&&!c()?d(!0,it):it()}})});h.on("change",function(n){var t=$(n.target),i,r;t.is(".app-input-text")&&(i=t.closest(".app-condition").data("condition"),r=t.val(),t.parent().is(".ui-first-child")?i.value=r:i.value2=r)}).on("vclick",function(n){var t=$(n.target);if(t.is(".app-condition"))return t.find(":input:visible").first().focus(),!1});$('<div class="app-promo-filler"><\/div>').appendTo(p);$(document).on("sidebar.app",function(n){if(bt()){var i=n.context;i.splice(0,n.context.length);i.push({text:t.AdvancedSearchInstruction,isStatic:!0,wrap:!0});i.push({});i.push({text:vt.ResetAdvancedSearch,icon:"refresh",callback:ci})}}).on("search.app",function(t,i){function f(){var n,d=c(),t=a(),g={MatchAll:"_match_:$all$",MatchAny:"_match_:$any$",DoNotMatchAll:"_donotmatch_:$all$",DoNotMatchAny:"_donotmatch_:$any$"},e={positive:[],negative:[]},l,o,s,v,f,y=[],p=[],b={},k=0,u;$(r).each(function(t){var i=this,r,u;$(i.conditions).each(function(f){function nt(n,i,r){return{gIndex:t,cIndex:f,text:n,focus:i,focus2:r}}var o=this,s=o.operation,rt=!s.match(th),ut=o.value,tt,ft=o.value2,it,v=$app.find(o.id)||o.mappedId&&d[o.mappedId],y=v.findField(o.field),w=y.Name,h,l,a="",et;if(rt?(String.isBlank(ut)?o.required&&(n=nt(tu.RequiredField,!0)):(tt={NewValue:ut.trim()},l=v._validateFieldValueFormat(y,tt,!0),l?n=nt(l,!0):a=v.convertFieldValueToString(y,tt.NewValue)),n||s=="$between"&&(String.isBlank(ft)?o.required&&(n=nt(tu.RequiredField,!1,!0)):(it={NewValue:ft.trim()},l=v._validateFieldValueFormat(y,it,!0),l&&(n=nt(l,!1,!0))),!n&&tt.NewValue>=it.NewValue&&(n=nt(ft+" "+nv.LessThanOrEqual+" "+ut,!1,!0)),n||(a+="$and$"+v.convertFieldValueToString(y,it.NewValue)))):(s=="$in"||s=="$notin")&&(a=o.lov,rt=!0),n)return!1;if(!rt||a){if(o.mappedId&&(h=c()[o.mappedId],h==null))return;r||(r=!0,u=i.scope.startsWith("DoesNot")?e.negative:e.positive,u.push(g[i.scope]),k++);s.match(/\$/)&&(s+="$");o.mappedId&&(et=new Sys.StringBuilder,h._fieldNameHint={},h._fieldNameHint[w]=o.headerText+" ("+o.scopeText.toUpperCase()+")",h._renderFilterDetails(et,[w+":"+s+a],!1),w+=","+h._controller+"."+(h._viewId||"grid1")+"."+o.filterField,b[w.replace(/\W/g,"_")+(k-1)]=et.toString());u.push(w+":"+s+a)}else p.push(o)});r||y.push(i)});n?(l=h.find(".app-condition-list").get(n.gIndex),o=$($(l).find(".app-condition").get(n.cIndex)),s=n.focus?o.find(".ui-first-child .app-input-text"):n.focus2?o.find(".ui-last-child .app-input-text"):o.find(".app-condition-list-field"),w({anchor:s,title:n.text,xOffset:8,yOffset:"bottom",afterclose:function(){s.is(":input")&&s.focus();yt()}})):(t.viewProp("advancedSearchFilter",e.positive.concat(e.negative)),$(r).each(function(){var n=this;$(p).each(function(){var t=n.conditions.indexOf(this);t>=0&&n.conditions.splice(t,1)})}),$(y).each(function(){var n=r.indexOf(this);n>=0&&r.splice(n,1)}),t.viewProp("advancedSearchConfig",r.length==0?null:r),t.viewProp("deepSearchInfo",b),r.length&&(v=t._filter,t._filter=[],f=t.extension().filterStatus(),t._filter=v,u=t.viewProp("advancedSearchRecent")||[],$(u).each(function(n){var t=this;if(t.text==f)return t.date=nc(),t.count++,u.splice(n,1),u.push(t),f=null,!1}),f&&(u.push({text:f,date:nc(),count:1,config:r}),u.length>30&&u.splice(30,1)),t.viewProp("advancedSearchRecent",u)),i())}n.promo(!1);var r=[],u;h.find(".app-condition-list").each(function(){var n=$(this).data("group");n&&(r.push(n),$(n.conditions).each(function(){this.mappedId&&(u=!0)}))});u&&!c()?d(!0,f):f()})}if(v=e.viewProp("advancedSearchConfig"),v||(v=[],kt(v,!0,!0)),h.data("condition",null),h.find(".app-condition").data("condition",null),h.data("config",v).find(".app-condition-list").data("group",null).parent().remove(),h.find(".app-header,.app-clear-fix").remove(),$(v).each(function(){ot(e,this)}),oi=$('<ul class="app-condition-list app-condition-list-more ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)),si=$('<li class="app-matching app-matching-more ui-body-a"><\/li>').appendTo(oi),$('<a class="app-condition-list-field app-btn-select app-has-children ui-btn ui-corner-all ui-btn-inline"/>').appendTo(si).text(t.AddMatchingGroup),ri(!0,pt),ri(!1,pt),$('<div class="app-clear-fix"><\/div>').appendTo(h),s=="no"){n.blink(h.find(".app-condition-list-scope"));return}if(s=="search"){n.blink(h.find(".app-condition-list-scope"),function(){setTimeout(function(){wu(!0)},500)});return}u.one("pagecontainershow",function(){setTimeout(li,200)});so(l);i.changePage("#advanced-search",{changeHash:!0,transition:r.pageTransition=="none"?"none":s||"slidedown"})}function wu(t){t?e(n.promo(),function(){wu()}):$(document).trigger("search.app",function(){var t=$("#advanced-search"),r=$app.find(t.attr("data-scope")),n=i.navigate.history.stack;n[n.length-1].transition="none";u.one("pagecontainershow",function(){au(i.activePage);su(r)});ai=null;history.go(-1)})}function gc(f,o){function g(){(c||h.length>0&&!f.get_useCase())&&(c&&o.parent().addClass("app-page-tasks"),s=$('<ul data-role="listview" data-inset="true" data-shadow="false" class="app-listview app-listview-static"/>').appendTo(o),f&&(k=is(f,s,c)))}function tt(){c&&(h.length&&h.push({}),h.push({text:t.Settings,icon:"gear",callback:function(){n.contextScope("_taskAssistant");es()}}))}var h=[],v,b=n.pageInfo(f&&f._id),c=!f,s,k,y=!1,p,d="eye",it,w,l;if(f||(f=b&&b.dataView),o||(o=n.content("taskassistant"),v=o.closest(".ui-page"),v.find(".app-page-header").remove(),v.addClass("app-page-tasks app-page-scrollable"),o.find('ul[data-role="listview"]').listview("destroy").remove(),n.tabs("destroy",{container:v}),so(v)),f&&(n.contextScope(f._id),h.isTaskAssistant=c,n.navContext(h,!c),n.contextScope(null),h.length&&h[0].icon=="back"&&(h=h.splice(1)),g(),c&&(f.get_isInserting()?(p="Entering",d="plus"):f.get_isEditing()?(p="Editing",d="edit"):f._lookupInfo&&(p="Lookup")),!1&&n.renderContext(s,h,function(n){var t=n.navigateTo=="detail";return t&&(y=!0),t}),c&&(y&&$('<li data-role="list-divider">').appendTo(s),it=$("<li>").appendTo(s).attr("data-icon",d),resumeLink=$('<a href="#"/>').appendTo(it).text(t["Resume"+(p||(f.get_isForm()?"Viewing":"Browsing"))]),$('<p class="app-item-desc"/>').appendTo(resumeLink).text(b.text),tt(),y=!0,n.renderContext(s,h,function(n){return y&&(y=!1,$('<li data-role="list-divider"/>').appendTo(s)),!n.navigateTo&&(n.callback||n.href)&&n.icon!="dots"&&(!n.command||!n.command.match(/^(Eye|SideBar)$/))})),s&&!c)){l=[];function rt(){n.tabs("create",{tabs:l,className:"app-tabs-echo",change:function(){ct()}})}$(h).each(function(){var i=this,t,n;i.navigateTo=="detail"&&(n=i.activator,n&&n.type=="Tab"&&($(l).each(function(){if(n.text==this.text)return t=this,!1}),t||(w!=n.container&&(w&&(rt(),l=[]),w=n.container),t={text:n.text,content:[]},l.push(t))),echo=il(this.context,s.parent()),t&&t.content.push(echo))});w&&rt()}if(c&&!f&&(tt(),g(),n.renderContext(s,h)),s){s.listview().on("vclick",function(n){nt();var t=$(n.target).closest("a").andSelf("a"),r=t.data("context-action"),f=i.navigate.history.stack;return t.length&&!co(n)&&e(t,function(){if(a()=="taskassistant"){f[f.length-1].transition="none";u.one("pagecontainershow",function(){au(i.activePage);setTimeout(function(){wt(r)},100)});history.go(-1)}else wt(r)}),!1});s.find(".ui-btn-icon-right").toggleClass("ui-btn-icon-right ui-btn-icon-left");oi(s)}c&&s&&s.find("li:first").length&&(l=[{text:uh.Tasks,content:$('#taskassistant ul[data-role="listview"]')},{text:t.Recent,content:$()},{text:t.Favorites,content:$()}],n.tabs("create",{tabs:l,className:"ui-header-fixed app-tabs-tasks",id:"tasks",placeholder:o}),i.changePage("#taskassistant",{changeHash:!0,transition:r.pageTransition=="none"?"none":"slidedown"}));c||!k||k.next().length||s.off().listview("destroy").remove()}function yi(n){n.find("a").data("data-context",null);n.find('ul[data-role="listview"]').listview("destroy").remove()}function nl(t,i){t.find("h3").on("vclick",function(r){var f=$(r.target).closest("h3"),u=[],s=n.contextScope(),o;return f.addClass("app-selected"),e(f,function(){o=te();n.contextScope(i);dl(u,!1,o||!o&&t.is(".app-echo-toolbar")||!$("#app-sidebar:visible").length);n.contextScope(s);u.length&&u[u.length-1].text&&u.push({});u.push({text:cr.Refresh,icon:"refresh",callback:function(){$app.find(i).sync()}});w({anchor:f,items:u,iconPos:"left",dropDown:!0,y:f.offset().top+f.outerHeight()})}),!1})}function tl(t,i){t.on("vclick",".ui-btn",function(t,r){function e(){var r=f.context&&f.context.group,e=[],t;r?(t=n.pageInfo(i).dataView,ee(r.Id,t,e,t.extension().commandRow()),w({items:e,iconPos:"left",defaultIcon:"carat-r",scope:t._id,anchor:u,y:u.offset().top+u.outerHeight(!0)/4*3,dropDown:!0})):f.callback(f.context)}var u=$(t.target).closest("a"),f=u.data("data-context");return u.length&&!n.busy()&&(r!=!1?n.callWithFeedback(u,e):e()),!1})}function il(i,r){var u=$('<div class="app-echo"/>').appendTo(r).attr({id:i+"_echo","data-for":i}),s,h,c=$app.find(i),o=$('<div class="app-echo-toolbar"><h3><\/h3><a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-dots ui-btn-icon-notext app-btn-more"/><div class="app-echo-controls"><\/div><span class="app-echo-see-all"><span><\/span><a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-carat-r ui-btn-icon-notext"/><\/span><\/div>').appendTo(u).on("vclick","a",function(t){var r=$(t.target);return gt(r)&&!n.busy()&&e(r,function(){r.is(".ui-icon-carat-r")?n.changePage(i):r.is(".ui-icon-dots")&&n.showContextMenu({scope:i})}),!1});s=o.find("h3");c.get_showViewSelector()||s.addClass("app-hidden");o.find(".ui-icon-dots").attr("title",t.More).css("visibility","hidden");nl(o,i);o.find(".ui-icon-carat-r").attr("title",t.SeeAll);o.find(".app-echo-see-all span").html(t.SeeAll).on("vclick",function(t){var r=$(t.target).addClass("app-selected");setTimeout(function(){r.removeClass("app-selected");n.changePage(i)},fi)});tl(o.find(".app-echo-controls"),i);c.get_showActionBar()||o.hide();$('<div class="app-echo-instruction"><\/div>').appendTo(u).hide();h=$('<div class="app-echo-inner"><\/div>').appendTo(u).hide().on("vclick taphold",function(t){var r=$(t.target),o=r.closest("a"),y,s,c,l,p=t.type,a=p!="taphold"&&!t.ctrlKey,w=o.is(".dv-action-see-all"),v;if(!r.closest(".app-presenter").length)return o.length&&!o.is(".app-divider")&&gt(r,p)&&(!w||a)&&!n.busy()&&e(r,function(){w?n.changePage(i):(n.contextScope(i),y=n.pageInfo(i),s=y.dataView,c=s.extension(),l=o.data("data-context"),v=o.is(".app-selected"),s._hasKey()?(u.find(".app-echo-inner .app-selected").removeClass("app-selected"),a?o.addClass("app-selected"):v?o.removeClass("app-selected"):o.addClass("app-selected"),n.dataViewUILinks(s).removeClass("app-selected"),a?(c.tap(l,"none"),r.is(".app-btn-more")?vs(r):c.tap(l)):(v?c.clearSelection():c.tap(l,"none"),h.find(".app-listview.app-grid").length&&!f()&&r.is("span")&&cc(r)),yh(s,u)):n.infoView(s,!0,l.row),n.contextScope(null))}),r.closest(".app-grid-header").length?void 0:!1}).on("contextmenu",function(t){return oa(n.pageInfo(i).dataView,t)});$('<div class="app-echo-footer"><\/div>').appendTo(u).on("vclick",function(){var r=$(event.target),t=r.closest("a");return t.length&&t.is(".dv-action-see-all")&&e(t,function(){n.changePage(i)}),!1});return rl(u),o.find("h3").text(n.pageInfo(i).text),f()&&u.find(".app-echo-inner").attr("tabindex",0),u}function ct(t,r){var e,f,u,o=0;t?i.activePage.find(".app-echo-toolbar").each(function(){e=$(this).parent();f=e.attr("data-for");u=n.pageInfo(f);u.echoId&&!u.dataView._busy()&&br(u.echoId)}):ri||b||ui||n.callWhenVisible(".app-echo:visible",function(t){setTimeout(function(){f=t.attr("data-for");u=n.pageInfo(f);!u.dataView||u.dataView._busy()||u.dataView.get_isForm()||(u.echoInitialized?u.echoChanged&&br(u.echoId):(u.echoId=t.attr("id"),n.pageInit(u.id,!1)&&br(u.id+"_echo")))},r==null?o:r);o+=50});i.activePage.find(".app-echo-controls.app-stale").each(function(){var t=$(this).closest(".app-echo"),i=t.attr("id"),r=n.pageInfo(i.substring(0,i.length-5));ul(r.dataView,t)})}function rl(n){var t=r.displayDensity;t!="Condensed"&&(t=="Comfortable"&&g.width()/16<31?n.addClass("app-density-compact"):t=="Compact"&&g.width()/14<31&&n.addClass("app-density-condensed"))}function ie(n,t,i){var r=n.find("h3").empty().text(t.get_view().Label||i.text),u=t._totalRowCount;return n.length&&u&&($("<span> (<\/span>").appendTo(r),$('<span class="app-echo-count"><\/span>').appendTo(r).text(u),$("<span>)<\/span>").appendTo(r),f()&&r.attr("title",r.text())),r}function br(r){function fi(){if(lt){st.show().empty();var n=s.aggregateLabels(),t=$('<div class="app-echo-container-aggregates"><\/div>').appendTo(st);$(c._fields).each(function(i){var f=this,o=c._allFields[f.AliasIndex],e=n[i],r,u,s;e&&(r=lt[f.Index],r=String.localeFormat(f.DataFormatString||"{0:n0}",r),u=$('<a class="ui-btn ui-inline app-calculated app-btn-static"/>').appendTo(t),$('<span class="app-calculated-label"/>').text(o.HeaderText).appendTo(u),s=$('<span class="app-calculated-value"/>').text(r).appendTo(u),$('<div class="app-static-text"/>').text(e).insertBefore(s.contents()),u.attr("title",o.HeaderText+"\n"+e+" "+r))});i.activePage.find(".app-echo:visible").length==1&&p.prev().is(".app-page-header,.app-tabs")&&(it-=st.outerHeight())}}function ei(){b!=null&&o<ft&&(bt=Math.floor(o/2),tt=v+b-bt+1,ft-(v+b)<bt&&(tt-=bt-(ft-(v+b))),tt<0&&(tt=0),tt!=v&&(tt>v?(l=l.slice(0),l.splice(0,tt-v),b-=tt-v,v=tt,l.length<o&&ht<s.pageCount()-1&&(ut=s.visibleDataRows(ht+1),ut&&(l=l.concat(ut)))):ht>0&&(ut=s.visibleDataRows(ht-1),ut&&(ut=ut.slice(0),ut.splice(0,dt-(v-tt)),b+=ut.length,v=tt,l=ut.concat(l)))),k=dt)}function si(n,i,r){return n.html(t.SeeAll+'<span class="app-info">'+String.format(cr.ShowingItems,i+1,r+1,ft)+"<\/span>")}var p,hi,ci,vi;if(!ui&&(p=$("#"+r),p.length)){p.removeClass("app-density-condensed app-density-compact");var g=p.parent(),u=p.find(".app-echo-inner").show(),st=u.next().hide(),fr=p.attr("data-for"),nt=n.pageInfo(fr),c=nt.dataView,ft=c._totalRowCount,s=c.extension(),ht=s.currentPageIndex()||0,dt=s.pageSize(),v=ht*dt,pi,tt,l=s.visibleDataRows(ht),ut,yt=s.itemMap(),e,h,a,pt,wt,at=c.get_showRowNumber()==!0,gt=$(p).find(".app-echo-toolbar"),er=gt.find(".app-echo-controls"),or=gt.find(".app-echo-see-all"),wi,bi=u.prev(),ni=s.instruction(!1),et=s.viewStyle(),ki,sr=i.getScreenHeight(),it=g.height()*.55,ti,b,k,o,bt,ii,ot,ri,vt,di=c.get_selectedKey().length>0,kt,nr,lt=s.aggregates(),ir,rr;if(!p.is(":visible")){nt.echoChanged=!0;return}if(nt.echoChanged=!1,rl(p),!l){c.goToPage(0,!0);s.echoCallback=function(){s.echoCallback=null;br(r)};return}if(wi=ie(gt,c,nt),nt.echoInitialized||(nt.echoInitialized=!0,nt.refreshed=!1),p.css("padding-bottom",""),ot=g.find(".app-stub,.app-stub-main"),ot.length||(ot=$("<div><\/div>").appendTo(g).addClass("app-stub"+(te()?"-main":""))),ot.height(ot.outerHeight()+u.outerHeight(!0)),ni&&(l.length||ni.match(/"app-filter"/))?bi.html(ni).show():bi.hide(),ti=u.scrollLeft(),yi(u),ir=u.find('div[data-role="presenter"]').detach(),u.empty(),ir.appendTo(u),n.presenter("hide",{container:u}),l.length){if(u.removeClass("app-no-scrolling app-horizontal-scrolling"),c._filterSource||g.find(".app-echo:visible").length!=1?f()&&g.css("overflow",""):(it=sr-u.offset().top,f()&&(it-=gi(p.css("padding-top"))+gi(p.css("padding-bottom")),et&&et.match(/List|Grid|Cards/)?(g.css("overflow","hidden"),nr=!0):g.css("overflow",""))),ku(c,u),n.presenter("supports",et)&&(hi=[],ci=!1,n.presenter("enumerate",{id:c._id,list:hi}),$(hi).each(function(){if(this.name==et)return ci=!0,!1}),u.addClass("app-no-scrolling").height(""),fi(),ci&&n.presenter("show",{name:et,id:c._id,container:u,maxHeight:Math.ceil(it)})?rr=!0:et=f()?"Grid":"List"),!rr)if($(l).each(function(n){var t=this;if(c.rowIsSelected(t))return b=n,s.commandRow()||(s.clearSelection(),s.tap(t,"none"),s.currentPageIndex(ht)),!1}),k=l.length,et=="Grid")u.addClass("app-no-scrolling").height(""),yi(u),e=$('<ul class="app-listview app-grid" data-role="listview"/>').appendTo(u),h=$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(e),ts(c,h),h=$('<li data-icon="false" class="dv-item"/>').appendTo(e),yu(c,l[0],null,$("<a/>").appendTo(h)),e.listview(),it-=h.prev().outerHeight(!0)+1,o=Math.ceil(it/(h.outerHeight(!0)+1)),lt&&(o-=2),h.remove(),o<4&&(o=4),ei(),$(l).each(function(n){var t=this,r=v+n+1,u=$('<li data-icon="false" class="dv-item"/>').appendTo(e),i=$("<a/>").appendTo(u).data("data-context",{row:this.slice(0),pageIndex:0});return yu(c,t,at?r:null,i),n==b&&(vt=t,i.addClass("app-selected")),pi=v+n,o<k&&o-2==n?!1:void 0}),lt&&(h=$('<li data-icon="false" class="dv-item"/>').appendTo(e),h.prev().addClass("app-followed-by-aggregates"),a=$('<a class="app-divider app-calculated"/>').appendTo(h),yu(c,lt,null,a,s.aggregateLabels())),(o<k||k<ft)&&(ii=a=si($('<a class="dv-action-see-all"/>').appendTo($("<li/>").appendTo(e)),v,pi)),oi(e.listview().listview("refresh")),ii&&ii.toggleClass("ui-btn-icon-right ui-btn-icon-left");else if(et=="List"){o=30;ei();u.addClass("app-no-scrolling").height("");yi(u);fi();e=$('<ul class="app-listview app-onecolumnview" data-role="listview"/>').appendTo(u).listview();for(var ur=0,w=b==null?0:b,d=w,rt=w,li,ct;w>=0&&w<l.length;){var ai=l[w],hr=v+w+1,h=$('<li data-icon="false" class="dv-item"/>').appendTo(e),a=$("<a/>").appendTo(h).data("data-context",{row:ai.slice(0),pageIndex:0});if(tr(c,ai,yt,at?hr:null,h,a,!0),w==b&&(vt=ai,a.addClass("app-selected")),e.listview("refresh"),ur+=h.outerHeight(),ur>=it&&rt-d>=3)break;ct=="up"?(h.insertBefore(li),li=h,rt<l.length-1?(ct="down",rt++,w=rt):(d--,w=d)):ct=="down"?d>0?(ct="up",d--,w=d):(rt++,w=rt):(li=h,d>0?(d--,ct="up",w=d):(rt++,ct="down",w=rt))}rt-d<ft&&(ct=="down"?rt--:d++,a.removeData(),h.remove(),h=$('<li data-icon="carat-r" class="dv-item"/>').appendTo(e),a=si($("<a/>").appendTo(h).addClass("dv-action-see-all"),v+d,v+rt),e.listview("refresh"),a.toggleClass("ui-btn-icon-left ui-btn-icon-right"));oi(e)}else{if(o=30,ei(),k=l.length,e=$('<ul class="app-listview" data-role="listview"/>').hide().appendTo(u),h=$('<li data-icon="false"/>').appendTo(e),a=$("<a/>").appendTo(h),fi(),tr(c,l[0],yt,at?1:null,h,a),e.listview().show(),pt=h.outerHeight(!0),wt=Math.floor(u.innerWidth()/h.outerWidth(!0)),o=Math.floor(it/pt),o<1&&(o=1),e=st.find(".app-echo-container-see-all").hide(),ft>k&&(st.show(),e.length?(e.show(),a=e.find(".ui-btn")):(e=$('<div class="app-echo-container-see-all"><\/div>'),lt?e.insertBefore(st.find(".app-echo-container-aggregates")):e.appendTo(st),a=$('<a class="ui-btn-icon-left ui-btn-icon-right ui-btn ui-icon-carat-r dv-action-see-all"/>').appendTo(e)),si(a,v,v+l.length-1),it-=e.outerHeight(!0),o=Math.floor(it/pt),o<1&&(o=1)),wt*o>=l.length&&(o=Math.ceil(l.length/wt),u.addClass("app-no-scrolling")),ft>k&&wt*o>=k&&u.addClass("app-no-scrolling"),u.is(".app-no-scrolling")||(u.addClass("app-horizontal-scrolling"),f()&&(o=Math.floor(it/pt),o<1&&(o=1))),yi(u),$(l).each(function(n){if(n>=k)return!1;e&&n%o!=0||(e=$('<ul class="app-listview" data-role="listview"/>').appendTo(u),ku(c,e));var t=this,f=v+n+1,i=$('<li data-icon="false" class="dv-item"/>').appendTo(e),r=$("<a/>").appendTo(i).data("data-context",{row:this.slice(0),pageIndex:0});tr(c,t,yt,at?f:null,i,r);n==b&&(vt=t,r.addClass("app-selected"))}),k>o&&(vi=o-k%o,vi<o))while(vi-->0)h=$('<li data-icon="false" class="dv-item"/>').appendTo(e),a=$("<a/>").appendTo(h),tr(c,l[0],yt,at?1:null,h,a),a.css("visibility","hidden");o==ft&&e.addClass("app-list-one-column");oi(u.find("ul").listview());e=u.find("ul:first");e.length&&(ki=u[0].offsetHeight-u[0].clientHeight,u.height(e.height()+ki+8));a=u.find(".app-selected");a.length&&(ri=a.offset().left-u.offset().left+a.outerWidth(),ri>u.width()&&(ti=ri-a.outerWidth()));u.scrollLeft(ti)}}else $('<div class="app-echo-empty"/>').appendTo(u.height("")).text(y.NoRecords);p.prev().is(".app-echo")||p.next().is(".app-echo")||p.css("padding-bottom",0);lc(g,ot);nr&&ot.first().prev().offset().top+ot.first().prev().height()>g.offset().top+g.height()&&g.css("overflow","");di?vt?c.rowIsSelected(s.commandRow())||(s.clearSelection(),s.tap(vt,"none")):s.clearSelection():s.commandRow()&&s.clearSelection();nt.echoRefreshCallback&&(nt.echoRefreshCallback(),nt.echoRefreshCallback=null);ul(c,p,di,er,wi,or);s._checkedAutoSelect||(s._checkedAutoSelect=!0,setTimeout(function(){kt=s._autoSelect;s._autoSelect=null;kt&&!n.busy()&&(nt.echoChanged=!0,n.contextScope(c._id),s.tap(kt.row,kt.action),n.contextScope(null))}))}}function ul(n,t,i,r,u,f){if(i==null&&(i=n.get_selectedKey().length>0),!r){if(t||(t=$("#"+n._id+"_echo")),!t.length)return;r=t.find(".app-echo-toolbar .app-echo-controls");u=r.parent().find("h3");f=r.next()}var e=u.next().css("visibility",""),o=e.offset().left+e.outerWidth(),s=f.offset().left;fl(n,r,o,s)}function fl(t,i,r,u,f,e){function c(n){return n.offset().left+n.outerWidth()>w+a-1}var y=[],l=[],p,w,a,o=[],v=[],s,h;if(r==0||u==0)i.addClass("app-stale");else if(u-r>=28){if(i.find(".ui-btn").data("data-context",null),i.hide().contents().remove(),p=n.contextScope(),n.contextScope(t._id),t.extension().context(y,["ActionBar"]),n.contextScope(p),$(y).each(function(){var n=this;n.system?n.icon!="search"||f||l.push(n):n.text&&l.push(n)}),$(l).each(function(){var r=this,n,t=r.icon,u;e&&t==e||(n=$('<a class="ui-btn"/>').appendTo(i).data("data-context",r),t=="dots"?n.addClass("app-has-children ui-corner-all ui-mini").text(r.text):(u=vf(t),n.addClass("ui-mini ui-btn-icon-left ui-corner-all ui-icon-"+(u?"":t||"carat-r")).attr("title",r.text),u&&n.toggleClass("ui-btn-icon-left ui-icon-"),t=="search"?n.toggleClass("ui-btn-icon-left ui-btn-icon-notext ui-mini "):n.text(r.text),u&&$('<span class="glyphicon"> <\/span>').insertBefore(n.contents()).addClass(t)))}),a=u-r-gi(i.css("marginRight")),i.width(a).show(),w=i.offset().left,i.find(".ui-btn").each(function(){var n=$(this);n.is(".ui-btn-icon-left")&&v.push(n);c(n)&&o.push(n)}),o.length)for(v.reverse();o.length;){if(s=o[0],h=c(s),h&&(isGeneric=s.is(".ui-icon-carat-r"),isGeneric?o.push(s):s.is(".ui-btn-icon-left")&&(s.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),h=c(s)),!isGeneric&&h&&$(v).each(function(){var n=this;if(o.indexOf(n)==-1&&n.is(".ui-btn-icon-left")&&(n.is(".ui-icon-carat-r")?n.hide():n.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),h=c(s),!h))return!1}),h)){$(o).each(function(){this.hide()});break}o.splice(0,1)}$('<a class="ui-btn ui-btn-icon-notext ui-corner-all"/>').appendTo(i).css("visibility","hidden")}else i.hide()}function dv(t,i){var r=$('<div class="app-bar-actions ui-header ui-bar-inherit ui-header-fixed"><\/div>').insertBefore(i),u=$("<h3/>").appendTo(r).text(n.pageInfo(t._id).text);return $('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots app-btn-more"/>').appendTo(r),nl(r,t._id),t.get_showViewSelector()||u.addClass("app-hidden"),tl($('<div class="app-bar-controls"><\/div>').appendTo(r),t._id),r}function gv(){var n=ri||b;return n==!0}function gt(n,t){var i;if(ri||b)return!1;if(et)if(i=$(n).closest("a"),i.data("scroll-check")==!0)i.data("scroll-check",!1);else{ui=!1;var r=i.closest(".app-wrapper,.ui-panel-inner"),u=r.data("scroll-stop-time"),f=r.scrollTop();return u&&vr()-u.getTime()>5e3?!0:(i.data("scroll-check",!0),setTimeout(function(){t||(t="vclick");f==r.scrollTop()?($(n).is(".app-btn-more")?n:i).trigger(t):(gt(i,t),o())},10),!1)}return!0}function bu(n){setTimeout(function(){$("div.ui-panel-open").panel("close",n!=!0)},fi)}function p(t,i,r){i||(i=450);iu&&(clearTimeout(iu),iu=null);t||(iu=setTimeout(function(){if(b)p(t,100,r);else{iu=null;oi();var i=ne(),u=n.contextScope();bc(i);n.contextScope(null);n.refreshContextMenu(i);n.contextScope(u);n.refreshMenuStrip();r&&r()}},i))}function si(n,t){if(n=location.pathname.replace(/\W/g,"_")+"_"+n,arguments.length==1)return c(n);c(n,t)}function c(n,t){if(ye||(ye=__settings.appInfo.replace(/\W/g,"_")),n=ye+"_"+n,arguments.length==1){if(typeof Storage!="undefined")try{return t=localStorage[n],t!=null&&(t=JSON.parse(t)),t}catch(i){}return null}if(typeof Storage!="undefined")if(t==null)localStorage.removeItem(n);else try{localStorage[n]=JSON.stringify(t)}catch(i){}}function el(n,t){var r={text:t,resolved:!0,description:null,type:null},i=n.attr("data-activator"),e,u,o,s=$(n).prev(".DataViewHeader").text(),f;return i||(o=n.closest("div[data-activator]"),i=o.attr("data-activator"),n=o),i&&(e=n.parent(),u=e.attr("id"),u||(u="aid"+rv++,e.attr("id",u)),r.container=u),i||(i=s),i&&i!="false"?(i=$app.eval(i),f=aa.exec(i),f?(r.text=f[4]||f[2],r.type=f[1]):r.text=i):r.resolved=!1,r.description=n.attr("data-activator-description"),r}function re(n,t){return(t?n.tagged("action-call"):n.tagged("action-call","field-call"))||n.Name.match(wa)&&(!t||!n.tagged("action-call-disabled"))}function ue(n,t){return(t?n.tagged("action-email"):n.tagged("action-email","field-email"))||n.Name.match(ba)&&!(t||!n.tagged("action-email-disabled"))}function ol(n,t){return(t?n.tagged("action-url"):n.tagged("action-url","field-url"))||n.Name.match(ka)&&(!t||!n.tagged("action-url-disabled"))}function ny(n,t){return t?n.tagged("action-location"):n.tagged("action-location","map-address")&&!n.tagged("action-location-disabled")}function ty(n){var t=n.ItemsStyle;return!String.isNullOrEmpty(t)&&t!="CheckBoxList"}function ku(n,t){n.get_isTagged("thumb-person")||n._controller.match(/\b(emp|acc|user|usr|person|cust)/i)&&!n.get_isTagged("thumb-standard")?t.addClass("app-thumb-person"):t.removeClass("app-thumb-person")}function pi(n,t,i){b=!0;n.animate({scrollTop:t},"swing",function(){b=!1;i&&i()})}function sl(t,i,r){r||(r={});var f=$(t),s=r.position||"right";if(nt(),ar=null,f.length==0){f=$(String.format('<div data-position-fixed="true" data-role="panel" data-theme="a" data-display="overlay" class="ui-panel ui-panel-display-overlay ui-panel-animate ui-panel-position-{0}"><ul/><\/div>',s)).appendTo(u).panel({animate:yr(),position:s,beforeopen:function(){lr=!0;ru&&(clearTimeout(ru),ru=null);i&&i()},open:function(){lr=!1;o();r&&r.afteropen&&r.afteropen()},beforeclose:function(){lr=!0;bc(f)},close:function(){lr=!1;ar&&ar();n.contextScope()&&(ru=setTimeout(function(){n.contextScope(null);ru=null},1e3));ar=null;r&&r.close&&r.close()}});yr(f);r.className&&f.addClass(r.className);gf(f);t.match(/^#/)&&f.attr("id",t.substring(1));f.find("ul").listview().on("vclick",function(n){var t=$(n.target).closest("a"),r=t.closest("li").attr("data-icon"),i;if(lr||t.length&&!gt(t))return!1;if(i=t.data("context-action"),i&&!oh){if(i.dataRel)return!0;i.feedback==!1?(o(),i.keepOpen==!0?wt(i,t):(f.panel("close",r!="dots"&&r!="back"),ar=function(){setTimeout(function(){wt(i,t)},10)})):i.keepOpen==!0?e(t,function(){wt(i,t)}):e(t,function(){f.panel("close",r!="dots"&&r!="back");ar=function(){setTimeout(function(){wt(i,t)},yr()?10:fi)}})}return oh=!1,!1}).on("swipe",function(){});r&&r.resetScrolling&&f.addClass("app-reset-scrolling")}return f}function kr(){n.contextScope()=="_contextMenu"?n._menuPanel.panel("toggle"):n.toggleContextPanel("#app-panel-context")}function nt(){s&&$(s).blur()}function ot(){n.headingBar().is(":visible")&&n.headingBar().hide()}function hi(t){t!=null?setTimeout(function(){n.fetchOnDemand()},t):n.fetchOnDemand()}function ni(t){return n.headingOnDemand(t),n}function k(t,i,r){return nt(),h=t,(n.contextScope()&&(!r||r.position!="left")||r&&r.position!="right")&&(i+="-scope",r||(r={}),r.position="left"),sl(i,function(){n.refreshContextMenu(i,h)},r).panel("toggle")}function iy(n){var i=new Sys.StringBuilder,f=n._fields,t,r,u;if(n.get_sortExpression())for(r=0;r<f.length;r++)t=n._allFields[f[r].AliasIndex],t.AllowSorting&&(u=ti(n,t.Name),u&&(i.isEmpty()||i.append(", "),i.appendFormat("{1} | {0}",t.HeaderText,ir(t,u))));return i.toString()}function du(n){n.extension()._instructed=!1}function rs(){var t=n.contextDataView(),i=new Sys.StringBuilder;wi!=null&&($(t._fields).each(function(){var n=t._allFields[this.AliasIndex],r=ti(t,n.Name);r&&(i.isEmpty()||i.append(","),i.appendFormat("{0} {1}",n.Name,r))}),t._sortExpression=i.toString(),wi=null,du(t),ot(),t.sync())}function ti(n,t,i){var f=wi==null?n.get_sortExpression()||"":wi,e=f.split($app._simpleListRegex),r,u;if(i==null){if(f)for(r=0;r<e.length;r++)if(u=e[r].match(da),u[1]==t)return u[3]||"asc";return null}wi=i?String.format("{0} {1}",t,i):"";n.viewProp("sortExpression",wi)}function ir(n,t){var i=ut.GenericSortAscending,r=ut.GenericSortDescending;switch(n.FilterType){case"Text":i=ut.StringSortAscending;r=ut.StringSortDescending;break;case"Date":i=ut.DateSortAscending;r=ut.DateSortDescending}return t=="asc"?i:r}function rt(n,t){h=n;t?setTimeout(t,500):es()}function hl(){function i(t){df();ot();n.contextScope(null);r.sidebar=t;c("sidebar",t);ro();oi();hi(1e3);bv();p();setTimeout(function(){lu();ct(!0);f();ni()},750)}function f(){rt(u,hl)}var u=h,e=[{text:t.Back,icon:"back",callback:function(){rt(u)}},{text:t.Sidebar,isStatic:!1,instruction:!0},{text:t.Landscape,icon:r.sidebar=="Landscape"?"check":!1,context:"Landscape",callback:i},{text:t.Always,icon:r.sidebar=="Always"?"check":!1,context:"Always",callback:i},{text:t.Never,icon:r.sidebar=="Never"?"check":!1,context:"Never",callback:i},];n.contextScope("_contextMenu");k(e,"#app-panel-settings-sidebar")}function us(n){return"app-theme-"+n.toLowerCase()}function fs(n){return"app-density-"+n.toLowerCase()}function cl(){var f=h,n=r.theme,e=[{text:t.Back,icon:"back",callback:function(){rt(f)}},{text:t.Themes.Label,isStatic:!1,instruction:!0}];for(var i in t.Themes.List)e.push({text:t.Themes.List[i],icon:i==n?"check":!1,context:i,callback:function(t){t!=n&&(n&&u.removeClass(us(n)),r.theme=t,u.addClass(us(t)),c("theme",t),av());rt(f,cl)}});k(e,"#app-panel-settings-theme")}function ll(){var i=h,u=r.pageTransition,f=[{text:t.Back,icon:"back",callback:function(){rt(i)}},{text:t.Transitions.Label,isStatic:!1,instruction:!0},];for(var n in t.Transitions.List)f.push({text:t.Transitions.List[n],icon:n==u?"check":!1,context:n,callback:function(n){n!=u&&(r.pageTransition=n,c("pageTransition",n));rt(i,ll)}});k(f,"#app-panel-settings-theme")}function al(){var f=h,n=r.displayDensity,e=[{text:t.Back,icon:"back",callback:function(){rt(f)}},{text:t.DisplayDensity.Label,isStatic:!1,instruction:!0},];for(var i in t.DisplayDensity.List)e.push({text:t.DisplayDensity.List[i],icon:i==n?"check":!1,context:i,callback:function(t){t!=n&&(g.trigger("resize"),u.removeClass(fs(n)),r.displayDensity=t,u.addClass(fs(t)),pt(),c("displayDensity",t),setTimeout(function(){},fi),g.trigger("throttledresize"));rt(f,al)}});k(e,"#app-panel-settings-display-density")}function vl(){var i=h,f=r.labelsInForm,e=[{text:t.Back,icon:"back",callback:function(){rt(i)}},{text:t.LabelsInForm.Label,isStatic:!1,instruction:!0},];for(var n in t.LabelsInForm.List)e.push({text:t.LabelsInForm.List[n],icon:n==f?"check":!1,context:n,callback:function(n){n!=f&&(u.removeClass("app-labelsinform-alignedright"),r.labelsInForm=n,n=="AlignedRight"&&u.addClass("app-labelsinform-alignedright"),c("labelsInForm",n));rt(i,vl)}});k(e,"#app-panel-settings-labels-in-form")}function ry(){var u=h,f=r.labelsInList,i=[{text:t.Back,icon:"back",callback:function(){rt(u)}},{text:t.LabelsInList.Label,isStatic:!1,instruction:!0},];for(var n in t.LabelsInList.List)i.push({text:t.LabelsInList.List[n],icon:n==f?"check":!1,context:n,callback:function(n){$app.confirm(t.ConfirmReload,function(){c("labelsInList",n);vh()})}});k(i,"#app-panel-settings-labels-in-form")}function yl(){function e(n){r.buttonShapes=n;c("buttonShapes",n);n?u.removeClass("app-buttons-text-only"):u.addClass("app-buttons-text-only");p();rt(i,yl)}var i=h,f=r.buttonShapes,n=[{text:t.Back,icon:"back",callback:function(){rt(i)}},{text:t.ButtonShapes,isStatic:!1,instruction:!0},];n.push({text:uf,icon:f!=!1?"check":!1,context:!0,callback:e});n.push({text:rf,icon:f==!1?"check":!1,context:!1,callback:e});k(n,"#app-panel-settings-button-shapes")}function pl(){function f(n){r.promoteActions=n;c("promoteActions",n);p();rt(i,pl)}var i=h,u=r.promoteActions,n=[{text:t.Back,icon:"back",callback:function(){rt(i)}},{text:t.PromoteActions,isStatic:!1,instruction:!0},];n.push({text:uf,icon:u!=!1?"check":!1,context:!0,callback:f});n.push({text:rf,icon:u==!1?"check":!1,context:!1,callback:f});k(n,"#app-panel-promote-actions")}function uy(){var u=h,f=r.initialListMode,i=[{text:t.Back,icon:"back",callback:function(){rt(u)}},{text:t.InitialListMode.Label,isStatic:!1,instruction:!0},];for(var n in t.InitialListMode.List)i.push({text:t.InitialListMode.List[n],icon:n==f?"check":!1,context:n,callback:function(n){$app.confirm(t.ConfirmReload,function(){c("initialListMode",n);vh()})}});k(i,"#app-panel-settings-default-list-mode")}function es(){var i=[];n.contextScope()!="_taskAssistant"&&i.push({text:t.Back,icon:"back",callback:kr});i.push({text:t.Settings});r.displayDensityDisabled||i.push({text:t.DisplayDensity.Label,icon:"dots",callback:al,desc:t.DisplayDensity.List[r.displayDensity]});r.themeDisabled||i.push({text:t.Themes.Label,icon:"dots",callback:cl,desc:t.Themes.List[r.theme]});r.pageTransitionDisabled||i.push({text:t.Transitions.Label,icon:"dots",callback:ll,desc:t.Transitions.List[r.pageTransition]});r.sidebarDisabled||i.push({text:t.Sidebar,icon:"dots",callback:hl,desc:r.sidebar=="Landscape"?t.Landscape:r.sidebar=="Always"?t.Always:t.Never});r.labelsInFormDisabled||i.push({text:t.LabelsInForm.Label,icon:"dots",callback:vl,desc:t.LabelsInForm.List[r.labelsInForm]});r.labelsInListDisabled||i.push({text:t.LabelsInList.Label,icon:"dots",callback:ry,desc:t.LabelsInList.List[r.labelsInList]});r.buttonShapesDisabled||i.push({text:t.ButtonShapes,icon:"dots",callback:yl,desc:r.buttonShapes!=!1?uf:rf});r.promoteActionsDisabled||i.push({text:t.PromoteActions,icon:"dots",callback:pl,desc:r.promoteActions!=!1?uf:rf});r.initialListModeDisabled||i.push({text:t.InitialListMode.Label,icon:"dots",callback:uy,desc:t.InitialListMode.List[r.initialListMode]});k(i,"#app-panel-settings")}function fy(){wi=null;var i=n.contextDataView(),r=i.get_view().Label,f=i._fields,e=i._allFields,u=[{text:t.Back,icon:"back",callback:kr},{text:String.format(t.SortByField,r)}];$(f).each(function(){var f=this,s=f,c,o;f=e[f.AliasIndex];!s.Hidden&&f.AllowSorting&&(o=ti(i,f.Name),o&&(c=!0),u.push({text:f.HeaderText,context:f,icon:o?o=="asc"?"arrow-u":"arrow-d":"false",desc:o?ir(f,o):null,callback:function(u){function o(){h=s;n.toggleContextPanel("#app-panel-sort-fields")}function e(n,t){ti(i,n.Name)==t?o():(ti(i,n.Name,t),rs())}var s=h,f=ti(i,u.Name);h=[{text:t.Back,icon:"back",callback:o}];h.push({text:String.format(t.SortByOptions,r,u.HeaderText)});h.push({text:ir(u,"asc"),callback:function(){e(u,"asc")},icon:f=="asc"?"check":!1});h.push({text:ir(u,"desc"),callback:function(){e(u,"desc")},icon:f=="desc"?"check":!1});h.push({text:t.DefaultOption,callback:function(){e(u,!1)},icon:f?!1:"check"});k(h,"#app-panel-sort-options")}}))});k(u,"#app-panel-sort-fields")}function ey(n){var t=n.get_filter(),i=n._externalFilter||[];return t&&t.length&&i.length<t.length||pr(n).length}function os(n){var t=$(".ui-panel-open .app-btn-apply,.ui-popup-active .app-btn-apply");t.is(".app-enabled")||(n?t.removeClass("ui-disabled"):t.addClass("ui-disabled"))}function fe(n){var t=n.find(".app-icon-check");n.is(".app-checked")?t.length||$(ki).appendTo(n):t.remove()}function oy(n,t){var i=wl(t),r=ss(t);t.toggleClass("ui-btn-icon-right app-checked");fe(t);r.length>r.filter(".app-checked").length?i.removeClass(or):i.addClass(or);fe(i);os(r.filter(".app-checked").length>0)}function wl(n){return n.closest(".ui-panel-inner").find(".app-btn-select-all a")}function ss(n){return wl(n).parent().nextAll().find("a")}function sy(n){return n.length>0?n.data("data-context")||n.data("context-action"):null}function hy(n,t){var i=$app.find(n.dataViewId),r=n.field,f=i.findField(r),e=i._allFields[f.AliasIndex],u=bl(i,r,t);i.removeFromFilter(e);u&&i._filter.push(u);su(i)}function bl(n,t,i){function s(t){r=[];o.each(function(){var i=$(this),u=i.is(".app-checked");(u&&t||!u&&!t)&&r.push(n.convertFieldValueToString(f,f._listOfValues[sy(i).context]))})}var f=n.findField(t),h=n._allFields[f.AliasIndex],u=[],r,e,o=ss(i);return o.filter(":not(.app-checked)").length&&(s(!0),r.length&&(u.push(h.Name+":"),r.length==1?u.push("="+r[0]):(e=r.length<=10||r.length<=r.length/2,u.push(e?"$in$":"$notin$"),e||s(!1),$(r).each(function(n){n>0&&u.push("$or$");u.push(this)})))),u.join("")}function dr(i){function o(n,i){var f=n._dataView,u=f._allFields[n.AliasIndex],e=f.get_fieldFilter(u,!0);r||(i.push({text:t.Back,icon:"back",callback:c}),i.push({text:u.HeaderText}));e&&i.push({text:y.Filters.Labels.Clear,context:u.Name,callback:function(){f.removeFromFilter(u);su(f)},icon:"delete"});i.push({text:y.Filters[u.FilterType].Text,context:u.Name,disabled:!0,callback:function(){},icon:"dots"});r||i.push({text:String.format(t.FilterByOptions,f.get_view().Label,u.HeaderText,t.Apply)})}function s(n,i){var e,r,w,u=n._dataView,l=n._listOfValues||[],a=u._allFields[n.AliasIndex],h=u.get_fieldFilter(a,!0),v=[],o,p,s,f,c=h=="$notin";for(h&&(h=="="||h=="$in"||c)&&(p=(u.get_fieldFilter(a)||"").split(/\$or\$/)),o={text:t.Apply,disabled:!0,itemClassName:"app-btn-apply",context:{dataViewId:u._id,mappedId:u._mappedId,field:n.Name},callback:hy},i.push(o,{}),l.length>1&&i.push({text:y.Filters.Labels.SelectAll,keepOpen:!0,itemClassName:"app-btn-select-all",icon:!1,callback:function(n,t){var i=ss(t);t.is(".app-checked")?(t.removeClass(or),i.removeClass(or).find(".app-icon-check").remove(),os(!1)):(t.addClass(or),$(ki).appendTo(i.addClass(or)),os(!0));fe(t)}}),e=0;e<l.length;e++)r=l[e],f=p&&p.indexOf(u.convertFieldValueToString(n,r))!=-1,c&&(f=!f),w=r==null?ut.EmptyValue:typeof r=="string"&&r==""?ut.BlankValue:a.text(r),s={text:w,icon:f?"check":!1,keepOpen:!0,context:e,callback:oy,linkClassName:f?"app-checked":""},f?(c?v.push(s):i.push(s),o.disabled&&(o.disabled=!1,o.itemClassName+=" app-enabled")):c?i.push(s):v.push(s);return i.concat(v)}function h(t){var i=[],u=n.contextDataView(),r=u.findField(t),f=u._allFields[r.AliasIndex];o(f,i);e&&i.splice(0,1);r._listOfValues&&r._listOfValues.length?i=s(r,i):i.push({text:ut.Loading,icon:"refresh",animate:!0,context:{id:u._id,field:t},keepOpen:!0,callback:function(){}});k(i,"#app-panel-filter-field",{position:"right",resetScrolling:!0,afteropen:function(){var u=ph().data("context-action"),r=u&&u.context,i,f,t;r&&(i=$app.find(r.id),t=i.findField(r.field),f=i._allFields,i._loadListOfValues(null,t.Name,f[t.AliasIndex].Name,function(){var u=ph(),f=u.length&&u.data("context-action").context,r=[];u.length&&f.id==i._id&&f.field==t.Name&&(o(t,r),e&&r.splice(0,1),r=s(t,r),n.refreshContextMenu(u.closest(".ui-panel"),r))}))}})}function c(){var i=n.contextDataView(),r=f?[]:[{text:t.Back,icon:"back",callback:kr}],u={},e=i&&i._filter;ey(i)&&(r.push({text:i.extension().filterStatus()}),r.push({text:y.Filters.Labels.Clear,icon:"delete",callback:function(){var t=n.contextDataView();fo(t)}}),f&&pr(i).length&&r.push({text:vt.ShowAdvancedSearch,desc:ic(i),icon:"search",toolbar:!1,system:!0,context:{dataViewId:i._id},callback:wh}));r.push({text:String.format(t.FilterByField,i.get_view().Label)});$(i._filter).each(function(){var n=this,t=n.match(/^\w+/);t&&(u[t[0]]=n)});$(i._externalFilter).each(function(){u[this.Name]=null});$(i._fields).each(function(){var o=this,t,f,n;t=i._allFields[o.AliasIndex];f=u[t.Name];f&&(i._filter=[f],n=i.extension().filterStatus(!0,!0),n.indexOf(t.HeaderText)==0&&(n=n.substring(t.HeaderText.length).trim(),n.length>2&&(n=n.charAt(0).toUpperCase()+n.slice(1))));!o.Hidden&&t.AllowQBE&&r.push({text:t.HeaderText,context:o.Name,icon:f?"filter":!1,desc:n,callback:h});i._filter=e});k(r,"#app-panel-filter")}var f,e,r,u;if(typeof i=="object"&&(i._dataView?r=i:i.mode=="everything"?f=!0:i.mode=="field"&&(e=!0)),r)return u=[],o(r,u),r._listOfValues&&r._listOfValues.length?u=s(r,u):u.push({text:ut.Loading,icon:"refresh",animate:!0,context:{id:r._dataView._id,field:r.Name},keepOpen:!0,callback:function(){}}),u;i&&i.mode=="field"?h(i.field):c()}function kl(t,r,u,f){u||(u=n.pageInfo());var e=u&&u.dataView,o=e&&e.get_view(),s=0;return e&&e.get_isGrid()&&e.get_showViewSelector()&&$(e.get_views()).each(function(){var n=this,h=n.Label==o.Label;r&&n.Id==o.Id||(n.Type!="Form"&&n.ShowInSelector||n.Id==o.Id)&&(t.push({text:n.Label,icon:h?"check":r?"":!1,context:s,callback:function(t){var r=$.find("#"+u.id+" .ui-content > .app-tabs-views .ui-btn");f&&r.length?$(r[t]).trigger("vclick",{selectedTab:n.Label}):(e._forceSync(),e.extension()._commandRow=null,e._requestedSortExpression=e.pageProp(n.Id+"_sortExpression"),e._requestedFilter=e.pageProp(n.Id+"_filter"),e.executeCommand({commandName:"Select",commandArgument:n.Id}),e.pageProp("viewId",n.Id),f&&!r.length&&si(u.id+"_view-tabs",n.Label),u.id==a()&&(ft(n.Label),i.activePage.find(".dv-heading").remove(),du(e),p()))}}),s++)}),s}function dl(i,r,u){var e=n.contextDataView(),f=e.extension(),o=f.viewStyle(),h=e!=n.dataView(),s=[];kl(i,null,n.contextPageInfo(),!0)==1&&i.splice(i.length-2,2);e.get_isGrid()&&e.get_showViewSelector()&&(r==!1?i.length&&i.push({}):i.push({text:t.PresentationStyle}),(u==null||u==!0)&&(f.tagged("view-style-grid-disabled")||i.push({text:t.Grid,icon:o=="Grid"?"check":!1,callback:function(){f.viewStyle("Grid")}}),f.tagged("view-style-list-disabled")||i.push({text:t.List,icon:o=="List"?"check":!1,callback:function(){f.viewStyle("List")}}),f.tagged("view-style-cards-disabled")||i.push({text:t.Cards,icon:o=="Cards"?"check":!1,callback:function(){f.viewStyle()!="Cards"&&f.viewStyle("Cards")}}),h||f.tagged("view-style-map-disabled")||f.tagged("supports-view-style-map")&&i.push({text:t.Map,icon:o=="Map"?"check":!1,callback:function(){f.viewStyle("Map")}}),n.presenter("enumerate",{id:e._id,list:s}),$(s).each(function(){var n=this;f.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.icon=n.name==o?"check":!1,i.push(n))})))}function cy(){var n=[{text:t.Back,icon:"back",callback:kr},{text:t.AlternativeView}];dl(n);k(n,"#app-panel-view-options")}function gl(t,r,u){var o=t._parentDataViewId&&!t._lookupInfo,e=t.extension(),h=e.itemMap(),s=t._allFields[h.heading],f;u&&u.length&&!e.inserting()&&r.push({text:s.text(u[s.Index]),theme:"b",toolbar:!1,icon:"eye",command:"Eye",toolbar:!o,system:!0,callback:function(){var c=i.activePage.find("#"+t._id+"_echo"),v=n.contextPageInfo(),u=c.length?c:n.content(t._id),s,r,l,h,a;if(e.viewStyle()=="Map")f=i.activePage.find(".app-map").data("data-map"),f.selected&&(f.map.panTo(f.selected.position),setTimeout(function(){gr(f.selected);n.infoView(t,!0)},500));else if(o||t.get_isForm()){function y(){pi(u,0,function(){ni().blink(i.activePage.find(".ui-collapsible-heading:first a"))})}s=i.activePage.find('div[data-role="navbar"] a:first');s.length&&!s.is(".app-tab-active")?(s.trigger("vclick"),setTimeout(y,200)):y()}else if(r=u.find('ul[data-role="listview"] a.app-selected'),l=n.screen(),!r.length&&v.echoId&&(r=i.activePage.find("#"+v.echoId).find(".app-selected")),r.length){h=r.offset().top;a=r.outerHeight(!0);function p(t){n.blink(r,t)}h>=l.top&&h+a<l.bottom||c.length?be?be=!1:p(function(){n.infoView(t,!0)}):(ot(),pi(u,u.scrollTop()+h-u.offset().top-(u.height()-a)/2,function(){ni();hi();p();n.promo(r)}))}else t.sync()}})}function hs(n,t,i){i&&$(n._fields).each(function(){var r=n._allFields[this.AliasIndex],f=re(r,!0),e=ue(r,!0),u;(f||e)&&(u=i[r.Index],u!=null&&(f?t.push({text:r.text(u),desc:r.HeaderText,icon:"phone",href:"tel:"+u,system:!0}):e&&t.push({text:r.text(u),desc:r.HeaderText,icon:"mail",href:"mailto:"+u,system:!0})))})}function ly(n){var t=null,i=n.CssClass;if(i&&(t=i.match(/\bui-icon-(\w+)\b/),t?t=t[1]:(t=i.match(/\bglyphicon-([\w\-]+)\b/),t&&(t=t[0]))),!t)switch(n.CommandName){case"Delete":t="trash";break;case"New":t="plus";break;case"Edit":t="edit";break;case"Insert":case"Update":t="check";break;case"Cancel":t="back";break;case"Duplicate":t="duplicate"}return t}function ee(i,r,u,f,e){function d(n){for(var i=r._views,t=0;t<i.length;t++)if(i[t].Id==n)return i[t].Type!="Form";return!1}var w=r.rowIsSelected(f),s,v=[],g=r.get_viewId(),y=r.get_isGrid(),p={},c,o,a,b=kt?/^(DataSheet|Grid|Import|BatchEdit)$/:/^(DataSheet|Grid|Export(Rowset|Rss)|Import|BatchEdit)$/;$(r.actionGroups(i)).each(function(g){var nt=this,tt=nt.Scope;tt!="ActionBar"||nt.Flat||nt.Id==i?(!nt.Scope.match(/Grid|ActionColumn/)||w&&y||nt.Flat)&&$(this.Actions).each(function(t){var h=this,i=h.CommandName,w=h.CommandArgument,it=i+"/"+w+"/"+h.HeaderText,k=v.indexOf(it)==-1&&(!i||!i.match(b))&&(!nt.Flat||h.HeaderText);a=i?function(){if(n.contextScope(null),!r._busy())if(i=="Cancel")l.history.go(-1);else{function u(){r.extension().command(f,i,w,h.CausesValidation,h.Path)}String.isNullOrEmpty(h.Confirmation)?u():r._confirm({action:h,scope:nt.Scope,actionIndex:t,rowIndex:0,groupIndex:g},function(n){$app.confirm(n,function(){u()})})}}:null;o=null;k&&(c=i&&i.match(/^(Select|Edit|New|Duplicate)$/),c&&y&&(!w||d(w))?e&&i=="Edit"?w=e:(p[i]=u[u.length-1],k=!1):c&&(o=p[i]));k&&!a&&nt.Scope.match(/Grid|ActionColumn/)&&(k=!1);k&&(v.push(it),s={text:h.HeaderText,callback:a,icon:ly(h),uiScope:tt,command:i,argument:w},o?Array.insert(u,u.indexOf(o)+1,s):u.push(s))}):u.push({text:nt.HeaderText,icon:"dots",uiScope:tt,context:{group:nt,isSideBar:u.isSideBar},callback:function(n){h=[];n.isSideBar||h.push({text:t.Back,icon:"back",callback:kr});h.push({text:nt.HeaderText});ee(n.group.Id,r,h,f);k(h,"#app-panel-group-actions",n.isSideBar?{position:"left"}:null)}})})}function ay(n,t){function o(n){$(f).each(function(t){var e=f[t],o=e.AliasIndex,v=f[o];if(!e.Hidden&&e.tagged(n)){u=!0;var a=e.tagged(n+"desc"),s=e.tagged(n+"label")||a,h=$app.tagSuffix,c=e.tagged(n+"count"),l=e.tagged(n+"aside");e.tagged(n+"heading")&&(i.heading=o);!e.tagged(n+"desc")&&(!s||c||l)||(i.desc.push(o),r=i.desc.length-1,$app.tagSuffix&&(i.descRwd[r]=$app.tagSuffix),s&&(i.descLabels[r]=!0,h&&(i.descLabelsRwd[r]=h)),e.tagged(n+"para")&&(i.descPara[r]=!0));c&&(i.count=o,i.countRwd=$app.tagSuffix,i.countLabel=s,i.countLabelRwd=h);l&&(i.aside=o,i.asideRwd=$app.tagSuffix,i.asideLabel=s,i.asideLabelRwd=h);e.tagged(n+"thumb")&&(i.thumb=o)}})}var e=n._fields,f=n._allFields,i={heading:null,thumb:null,aside:null,count:null,desc:[],descRwd:[],descLabels:[],descLabelsRwd:[],descPara:[]},u=!1,r,s,h;if(t?o("list-"):(o("card-"),u||o("item-")),u)i.heading==null&&(i.heading=e[0].AliasIndex);else{function c(n){if(!this.Hidden)if(this.OnDemand)i.thumb==null&&this.OnDemandStyle!=1&&(i.thumb=n);else if(!s||this.ShowInSummary){n=this.AliasIndex;var e=f[n],o=e.Type.match(/^Date/);isSimpleType=e.Type!="String"&&!e.OnDemand;i.heading==null?i.heading=n:i.aside==null&&o&&i.count==null?i.aside=n:i.count==null&&isSimpleType&&!o&&i.aside==null?i.count=n:(i.desc.push(n),r=i.desc.length-1,i.descLabels[r]=n,t&&(!e.ItemsLookupStyle&&e.Rows>1?(i.descPara[r]=!0,h=!0):h&&(i.descPara[r]=!0,h=!1)));u=!0}}t&&(s=!1);$(e).each(c);u||(s=!1,$(e).each(c))}return i}function oe(n){var t={latitude:null,longitude:null,segments:[]},i=[];return $(n._allFields).each(function(n){var r=this;r.tagged("map-")&&(r.tagged("map-latitude")?t.latitude=n:r.tagged("map-longitude")?t.longitude=n:i.push(this))}),$(["address","city","state","region","postalcode","zipcode","zip","country"]).each(function(){var n=this;$(i).each(function(r){var u=this;if(u.tagged("map-"+n))return t.segments.push(u.Index),i.splice(r,1),!1})}),t}function vy(n){var t=uu||c("geoLocations"),i=null;return t&&$(t).each(function(){var t=this;if(t.address==n)return i=t.lat==null&&t.lng==null?"ZERO_RESULTS":{lat:t.lat,lng:t.lng},!1}),uu||(uu=t),i}function na(n,t,i){var r=uu||c("geoLocations");r||(r=[]);r.push({address:n,lat:t,lng:i});r.length>tv&&r.splice(0,1);uu=r;setTimeout(function(){c("geoLocations",r)},0)}function ta(n,t,i){var r=new Sys.StringBuilder;return et?r.append("http://maps.apple.com/?"):r.append("https://maps.google.com/?"),i=="q"?r.append("q="):i=="to"?r.append("daddr="):r.append("saddr="),t.latitude!=null&&t.longitude!=null?r.appendFormat("{0},{1}",t.latitude,t.latitude):$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(",+"),r.append(i.trim().replace(/\s+/g,"+")))}),r.toString()}function yy(n,t){var u,f,r,e,i;return t.latitude!=null&&t.longitude!=null?(u=n[t.latitude],f=n[t.longitude]):(r=new Sys.StringBuilder,$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(","),r.append(i))}),e=r.toString(),i=vy(e),i?typeof i!="string"&&(u=i.lat,f=i.lng):i=e),typeof i!="string"&&(i=new google.maps.LatLng(u,f)),i}function ia(n){$(n.markers).each(function(){google.maps.event.clearListeners(this,"click");this.setMap(null)});n.markers=[];n.selected=null}function cs(n){if(n.fit!=!1){var i=new google.maps.LatLngBounds,t=n.markers,r=n.map;t.length==1?r.setCenter(t[0].position):($(t).each(function(){i.extend(this.position)}),r.fitBounds(i))}}function ls(){if(!!(__tf!=4)){var n=".noitide tcudorp ruoy ni detroppus ton si erutaef sihT".split("").reverse(),t=$app.alert,i=Math.random()*1e4;setTimeout(function(){$(".ui-popup-active .ui-popup").popup("close");setTimeout(function(){t(n.join(""))},250)},i)}}function ra(i,u,o,s,h){var a=i,c=u.data("data-map"),v=a.dataView(),l=new google.maps.Marker({map:c.map,position:o,title:s});return google.maps.event.addListener(l,"click",function(){a.tap({row:h},"none");var s=c.map,p=c.markers,w=py(l.position,s),o,d,it=["location","navigation","arrow-r","arrow-l"],b=w&&{x:w.x+u.offset().left,y:w.y+u.offset().top},g,i=$('<div class="ui-content app-popup-message app-map-info"/>').popup({transition:no(),history:!f(),arrow:w?"t,l,r,b":null,theme:"a",overlayTheme:"b",positionTo:w?"origin":"window",afteropen:function(){as(null,i);c.infoWidth!=null&&(i.width()<c.infoWidth&&b&&i.popup("reposition",b),c.infoWidth=null);oi(k);se(c,l);gr(l)},afterclose:function(){var t,n;k.listview("destroy").remove();i.find(".ui-btn").data("data-context",null);rr(i);switch(o){case"location":c.fit=!1;l.setAnimation(null);s.getZoom()>=17?(t=s.getStreetView(),t&&t.getVisible()?(t.setVisible(!1),google.maps.event.trigger(l,"click")):(c.fit=!0,cs(c)),gr(l)):(s.setZoom(17),s.panTo(l.position),gr(l));break;case"next":case"prev":n=-1;$(p).each(function(t){if(this==l)return n=t,!0});n!=-1&&(o=="next"?n++:n--,n<0&&(n=p.length-1),n>=p.length&&(n=0),se(c,p[n]),s.panTo(c.selected.position),google.maps.event.trigger(c.selected,"click"));break;case"execute":setTimeout(function(){d.callback()},100);break;case"menu":b.context=[{text:c.selected.title,icon:"back",callback:function(){google.maps.event.trigger(c.selected,"click")}}];vs(null,b);break;default:gr(l)}}}),k=$('<ul class="app-listview"/>').appendTo(i),nt=$('<li data-icon="false"/>').appendTo(k),tt=$("<a/>").appendTo(nt),y=$('<div class="app-map-info-toolbar"/>').appendTo(i),rt=oe(v);tr(v,h,a.itemMap(),null,nt,tt);k.listview();r.displayDensity=="Comfortable"?i.addClass("app-density-compact"):r.displayDensity=="Compact"&&i.addClass("app-density-condensed");$('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots"/>').appendTo(y).attr("title",t.More);s.getZoom()>=17?p.length>1&&$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-zoomout"/>').appendTo(y).attr("title",t.ZoomOut):$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-zoomin"/>').appendTo(y).attr("title",t.ZoomIn);$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-navigation" target="_blank"/>').appendTo(y).attr({title:t.Directions,href:ta(h,oe(v),"to")});c.markers.length>1&&($('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-arrow-l"/>').appendTo(y).attr("title",cr.Previous),$('<a class="app-btn-map ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-arrow-r"/>').appendTo(y).attr("title",cr.Next));context=[];n.navContext(context,!1);$(context).each(function(){var n=this;if((n.icon||n.command=="Select")&&n.icon!="dots"&&!n.navigateTo&&!n.system&&n.callback&&it.indexOf(n.icon)==-1)return tt.data("data-context",n),!1});i.popupopen(b).on("vclick",".ui-btn",function(n){var t=$(n.target).closest("a");return e(t,function(){g||(t.is(".ui-icon-zoomin,.ui-icon-zoomout")?o="location":t.is(".ui-icon-arrow-l")?(o="prev",c.infoWidth=i.width()):t.is(".ui-icon-arrow-r")?(o="next",c.infoWidth=i.width()):t.is(".ui-icon-dots")?o="menu":t.is(".ui-icon-navigation")?yf(t.attr("href")):(d=t.data("data-context"),d&&(o="execute")),o&&(lt(i),g=!0))}),!1}).on("vclick","li",function(){return o=!0,lt(i),!1})}),c.markers.push(l),l}function se(n,t){n.selected&&n.selected.setIcon(null);n.selected=t;t&&t.setIcon("http://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2")}function gr(n,t,i){typeof t=="undefined"&&(t=755);n.setAnimation(i||google.maps.Animation.BOUNCE);t&&setTimeout(function(){n.setAnimation(null)},t)}function py(n,t){var u=t.getBounds(),i=t.getProjection(),s=i.fromLatLngToPoint(u.getNorthEast()),r=i.fromLatLngToPoint(u.getSouthWest()),e=Math.pow(2,t.getZoom()),f=i.fromLatLngToPoint(n),o=0;return(f.x<r.x||r.x==0)&&(o=$(t.getDiv()).width()/2,r=i.fromLatLngToPoint(u.getCenter())),new google.maps.Point((f.x-r.x)*e+o,(f.y-s.y)*e)}function as(t,i){var f=i.closest(".ui-popup-container"),r=n.promo();u.addClass("app-has-popup-open");kf();r.is(":visible")&&r.addClass("app-hidden");r.is(".app-btn-promo-cancel")||n.promo(!1)}function lt(n){n.popup("close")}function rr(t){var f,i;pv(t);u.removeClass("app-has-popup-open");t.data("position-options",null).popup("destroy").remove();i=n.promo();i.is(".app-hidden")&&(i.removeClass("app-hidden"),!i.is(".ui-disabled")&&r.promoteActions&&i.data("icon-list")&&(f=n.dataView(),f&&f.get_isForm()||te()||i.show()))}function ur(n){n.find("a").data("data-context",null);n.find("li").remove()}function ua(n){ur(n);n.off("vclick").listview("destroy")}function vs(t,i){function o(){u.length&&u[u.length-1].text&&u.push({})}function e(n){var t=[];$(r).each(function(){var i=this,r=i.icon;i.system?n&&r!="search"&&r!="sort"&&r!="filter"&&r!="dots"&&t.push(i):i.text&&u.push(i)});n&&t.length&&(o(),$(t).each(function(){var n=this;u.push({text:n.text,icon:n.icon,callback:n.href?function(){yf(n.href)}:n.callback})}))}t=$(t);var s=t.closest(".app-echo"),h=s.length?s.attr("data-for"):null,c=n.pageInfo(h),f=c.dataView.extension(),r=i&&i.context,u=[];f.lookupInfo()?(r=[],f.context(r),e()):(e(),i&&i.autoPopulate==!1||(r=[],f.context(r,["ActionColumn"]),r.length&&(o(),e()),o(),r=[],f.context(r,["Grid"]),e(!0)));w({items:u,anchor:t,iconPos:"left",defaultIcon:"carat-r",x:i&&i.x||t.offset().left+t.outerWidth()/2,y:i&&i.y||t.offset().top+t.outerHeight(!0)/3*2})}function wy(n,t,r,u,f,e){var s=t._filter,o=!t._id,h=!o&&t.viewProp("advancedSearchFilter");t._filter=u&&[r+":$in$"+u]||[];o||t.viewProp("advancedSearchFilter",null);fa(n,{valuesOnly:!0,dataView:t,field:r,afterclose:function(){t._filter=s;o||t.viewProp("advancedSearchFilter",h);e&&e()},callback:function(n,t){f&&f(bl(n.mappedId?i.activePage.data("detail-map")[n.mappedId]:$app.find(n.dataViewId),n.field,t))}})}function fa(t,i){function k(n,t){$(n).each(function(i){var r=this,u=r.itemClassName;return u&&u.indexOf("app-btn-apply")!=-1?(n.splice(0,i),this.callback=t,!1):r.animate?(n.splice(0,i),!1):void 0})}var p=t.closest(".app-echo"),v=p.length?p.attr("data-for"):null,d=n.pageInfo(v),r=i.dataView||d.dataView,s=i.field||t.attr("data-field-name"),u=r.findField(s),h=r.findFieldUnderAlias(u),c=(ti(r,s)||"").toLowerCase(),e=[],l=[],o,y=u.AllowSorting&&!i.valuesOnly,b=u.AllowQBE,a;(y||b)&&(y&&(l=[{text:ir(u,"asc"),icon:c=="asc"?"check":"false",callback:function(){n.contextScope(v);ti(r,s,c=="asc"?!1:"asc");rs();n.contextScope(null)}},{text:ir(u,"desc"),icon:c=="desc"?"check":"false",callback:function(){n.contextScope(v);ti(r,s,c=="desc"?!1:"desc");rs();n.contextScope(null)}}]),b&&(o=dr(h),y&&o.splice(0,0,{}),i.valuesOnly&&k(o,i.callback)),l&&(e=e.concat(l)),o&&(e=e.concat(o)),a={x:i&&i.x||t.offset().left+t.outerWidth()/2,y:i&&i.y||t.offset().top+t.outerHeight(!0)*3/4},w({items:e,anchor:t,title:i.valuesOnly?null:t.text(),x:a.x,y:a.y,scope:r._id,afteropen:function(){var n=this;to().length&&r._loadListOfValues(null,h.Name,u.Name,function(){var u=to(),t=u.closest(".ui-listview"),e=u.length&&u.data("data-context"),s=f(),o;e&&r._id==e.context.id&&h.Name==e.context.field&&(s&&t.hide(),o=dr(h),i.valuesOnly&&k(o,i.callback),ur(t),ys(t,l.concat(o),i),t.listview("refresh"),s&&t.show(),n.popup("reposition",a))})},afterclose:function(){i.afterclose&&i.afterclose()}}))}function ys(n,t,i){var r;$(t).each(function(){var t=this,f,u,e,o=t.icon,s=o,h=vf(o);t.text?(r=!1,e=t.icon=="check",e&&(s=!1),h&&(s="false"),f=$("<li/>").appendTo(n).attr("data-icon",s||i.defaultIcon||"false"),t.disabled&&f.addClass("ui-disabled"),t.itemClassName&&f.addClass(t.itemClassName),t.callback?(u=$("<a/>").appendTo(f).text(t.text).data("data-context",t),t.keepOpen&&(u.addClass("app-keep-open"),t.animate||u.addClass("app-btn-icon-transparent")),e&&$(ki).appendTo(u),t.linkClassName&&u.addClass(t.linkClassName),t.animate&&u.addClass("app-animated app-animation-spin")):f.text(t.text).addClass("app-list-instruction ui-li-divider ui-bar-a"),t.visible&&(f.attr("data-visible","true"),u.addClass("app-selected")),h&&$('<span class="glyphicon"> <\/span>').insertBefore(u.contents()).addClass(o)):r||(r=!0,$('<li data-role="list-divider"/>').appendTo(n))});r&&n.find("li:last").remove()}function w(t){function d(){return hv({x:t&&t.x||r&&r.offset().left+r.outerWidth()/2,y:t&&t.y||r&&r.offset().top+r.outerHeight(!0)*3/4})}function w(i,r){var f=n.contextScope(),u=i.callback;t.scope&&n.contextScope(t.scope);u&&u(i.context,r);n.contextScope(f)}var u=$('<div class="app-popup app-popup-listview" data-theme="a"><\/div>'),r=$(t.anchor),o,s,h,l,a,p=t.items||[],v=r.is(".app-btn-promo"),y,c;kf();typeof t.x=="number"&&(t.x=Math.ceil(t.x));typeof t.y=="number"&&(t.y=Math.ceil(t.y));t.x==null&&r.length&&(t.x=Math.ceil(r.offset().left+(t.xOffset?t.xOffset:r.outerWidth()/2)));t.y==null&&r.length&&(t.yOffset=="bottom"?t.y=Math.ceil(r.offset().top+(f()?r.outerHeight():r.outerHeight()/2)):typeof t.yOffset=="number"&&(t.y=Math.ceil(r.offset().top+r.outerHeight()*(f?t.y:1-t.y))));t.iconPos=="left"&&u.addClass("app-popup-icon-left");t.title&&$('<h1 class="ui-title"/>').appendTo($('<div class="ui-header ui-bar-a"/>').appendTo(u)).text(t.title);o=$('<div class="ui-panel-inner"/>').appendTo($('<div class="ui-content"/>').appendTo(u));s=$('<ul class="app-listview"/>').appendTo(o);ys(s,p,t);s.listview().on("vclick",function(n){var t=$(n.target).closest("a");return t.length&&!a&&gt(t)&&(a=!0,e(t,function(){h=t.data("data-context");l=t;h.keepOpen?(w(h,l),h=null,l=null,a=!1):lt(u)})),!1});if(v||n.promo(!1).addClass("app-hidden"),u.popup({history:!f(),arrow:t.arrow||r&&(f()||t.dropDown?"t,b,l,r":"b,t,l,r"),overlayTheme:"b",tolerance:t.tolerance!=null?t.tolerance:5,transition:no(),afteropen:function(){as(null,u);t.afteropen&&t.afteropen.call(u);f()&&o.focus()},afterclose:function(){r&&r.removeClass("app-selected");t.afterclose&&t.afterclose.call(u);setTimeout(function(){h&&w(h,l);h=null;l=null;ur(s);ua(s);rr(u)},100)},beforeposition:function(){if(f()){var n=o.width("").width()+20;o.height()<s.outerHeight(!0)&&(o.css({width:n}),u.css({minWidth:n,maxWidth:"auto"}))}}}),gf(u),p.length==0&&(u.find(".ui-content").hide(),u.find(".ui-header").css({"border-bottom-width":0,"margin-bottom":".25em"})),r&&r.length){v||t.highlightAnchor==!1||r.addClass("app-selected");var b=r.offset(),g=i.getScreenHeight(),k=n.toolbar().outerHeight(),nt=b.top,tt=g-(b.top+r.outerHeight());o.css({maxHeight:Math.max(nt-k*2,tt-k*2,50)})}kc(u);y=d(!0);c=s.find('li[data-visible="true"]');c.length&&o.offset().top+o.outerHeight()<c.offset().top+c.outerHeight()&&o.scrollTop(c.offset().top-o.offset().top-(o.outerHeight()-c.outerHeight())/2);v&&n.promo().show();u.data("position-options",y).popupopen(y)}function by(n){var t=[];$(n).closest(".app-bar-buttons").find(".ui-btn:not(:visible):not(.app-btn-more)").each(function(){var n=$(this);t.push({text:n.text(),callback:function(){n.trigger("vclick")}})});w({anchor:n,items:t,y:n.offset().top+n.outerHeight()/4*3,tolerance:3})}function he(n){return{overlayTheme:"b",history:!f(),transition:n||"pop",positionTo:"window",afteropen:function(){var n=ef;n&&setTimeout(function(){n()},200);ef=null},afterclose:function(){var n=ii;n&&setTimeout(function(){n()},100);ii=null}}}function ea(n){var t=$app.find(n.id),r=t.findField(n.field),i=n.op;t.removeFromFilter(r);i!="$clear"&&(i.startsWith("$")&&(i+="$"),t._filter.push(n.field+":"+i+(i.match(/\$(true|false)/)?"":t.convertFieldValueToString(r,n.value))));su(t)}function oa(n,t){function i(t,i){var r=u.Name+":"+t;t.startsWith("$")&&(r+="$");r+=n.convertFieldValueToString(u,o);l!=r&&h.push({text:$app.filterDef(c,t).Text+(i?" "+i:""),context:{id:n._id,field:e,op:t,value:o},callback:ea})}if(f()){var s=$(t.target).closest(".app-field"),a=s.closest("a"),u,e,o,r,c,l,h=[];if(s.length){if(dataContext=a.data("data-context"),!dataContext)return;if(e=s.attr("class").match(/app\-field\-(\w+)/),e&&(e=e[1]),e){if(t.preventDefault(),u=n.findField(e),!u.AllowQBE)return!1;c=y.Filters[u.FilterType].List;o=dataContext.row[u.Index];$(n._filter).each(function(){var t=this;if(t.startsWith(e+":"))return l=t,h.push({text:String.format(ut.ClearFilter,u.HeaderText),icon:"delete",context:{id:n._id,field:e,op:"$clear"},callback:ea},{}),!0});o==null?(i("$isempty"),i("$isnotempty")):(r=u.text(o),u.FilterType=="Text"&&(r='"'+r+'"'),u.FilterType=="Text"?(i("=",r),i("<>",r),i("$contains",r),i("$doesnotcontain",r)):u.FilterType=="Boolean"?(i("$true"),i("$false")):(i("=",r),i("<>",r),i("<=",r),i(">=",r),i("<",r),i(">",r)));h.length&&w({anchor:s,items:h,x:t.pageX})}}else{if($(t.target).closest(".app-grid-header").length)return;t.preventDefault()}return!1}}function sa(t){var i,f,u,o,r;if(nt(),i=$(t.target),f=i.data("icon"),i.is(".app-btn-promo")){if(u=i.data("icon-list"),u)return e(i,function(){var t=[],e="ui-icon-"+i.data("icon"),r,f;if(i.is(".app-btn-promo-cancel"))return $(".ui-popup-screen.in").trigger("vclick"),!1;$(u.icons).each(function(){r=this;r.match(ih)||(f=u.labels[r].split(/\n/),t.push({text:f[0],desc:f[1],icon:r,context:r,callback:function(t){n.executeInContext(t)}}))});t.length==1&&t[0].callback?t[0].callback(t[0].context):(i.addClass("ui-icon-delete app-btn-promo-cancel").removeClass(e),w({anchor:n.promo(),items:t,iconPos:"left",y:i.offset().top-1,afterclose:function(){i.removeClass("ui-icon-delete app-btn-promo-cancel").addClass(e)}}))}),!1;if(bt())return e(i,wu),!1}return f=="search"?(o=n.pageInfo(),r=o&&o.dataView,r&&(r.extension().useAdvancedSearch()&&!ei?e(i,function(){pu(r,ei)}):pu(r))):e(i,function(){n.executeInContext(f)}),!1}function ha(t,r,f){var o,e;it()||(t=i.path.convertUrlToDataUrl(i.path.makeUrlAbsolute(t,i.path.documentBase)),o=u.find("> div[data-url]").filter(function(){return $(this).attr("data-url")==t}),f?(vi(),location.href=t):o.length?(e=n.pageInfo(o.attr("id")),e?(e.navigateInfo={href:t,transition:r},n.changePage(e.id)):i.navigate(t,{transition:r})):(it(!0),$.ajax({url:t,dataType:"html",success:function(i){var f;if(it(!1),f=i.match(/<td\s+id\s*=\s*"PageContent"\s*>([\s\S]+)?<\/td>\s*<td\s+id\s*="PageContent.+"\s*>/i),f||(f=i.match(/<div\s+id\s*=\s*"PageContent".+?>([\s\S]+)?<\/div>\s*<footer /i)),f&&!i.match(/\$create\(Web.DataView|\s+data-controller\s*=\s*"/)){for(var e=f[1],o,h=new Sys.StringBuilder,c=/<script.+?>([\s\S]+?)<\/script>/ig,l,s;l=c.exec(e);)h.append(l[1]);e=e.replace(c,"");o=$("<div><\/div>").appendTo(u).hide().attr("data-href",t);o.html(e).data("scripts",h.toString());s={pageId:ah(t),selector:o,transition:r};n.pageInfo({id:s.pageId,text:s.pageId+"_main",url:t,root:!0});n.start(s);o.data("scripts",null).remove()}else vi(),location.href=t},error:function(){it(!1)}})))}function ky(n){var t=$(n.target);if(t.is(".app-btn-toggle"))return t.addClass("ui-btn-active"),u.focus(),setTimeout(function(){function u(){i.removeClass("app-text-expanded");t.attr("title",pe.Maximize).toggleClass("ui-icon-carat-u ui-icon-carat-d")}t.removeClass("ui-btn-active");var i=t.prev(),r,n;i.is(".app-text-expanded")?(r=i.closest(".dv-item,.ui-field-contain"),r.length?(n=t.closest(".app-wrapper"),pi(n,r.offset().top-(n.offset().top-n.scrollTop())-n.height()*.33,u)):u()):(i.addClass("app-text-expanded"),t.attr("title",pe.Minimize).toggleClass("ui-icon-carat-u ui-icon-carat-d"))},fi),!1}function dy(t){var w,h,l,s,y,p,k;if(!t.isDefaultPrevented()){var v=$(t.target),f=v.is("a")?v:v.closest("a"),c=f.attr("href"),r;if(!b){switch(c){case"#app-menu":r="#app-btn-menu";break;case"#app-context":r="#app-btn-context";break;case"#app-back":r=function(){history.go(-1)};break;case"#app-details":r=function(){var t=n.pageInfo(),i;t&&t.dataView&&(i=t.dataView.extension(),i.command(i.commandRow(),"Select"),of=f.attr("data-field-text"),t.dataView._viewDetails(f.attr("data-field-name")))};break;case"#app-refresh":r=function(){var t=n.pageInfo();t&&t.dataView&&t.dataView.sync()};break;case"#app-clear-filter":r=function(){var t=n.pageInfo();t&&t.dataView&&fo(t.dataView,!1)};break;case"#app-filter":r=function(){var t=n.pageInfo();t&&t.dataView&&dr({mode:"everything"})};break;case"#app-lookup":r=function(){var t=f.data("data-context");nt();n.showLookup(t);t.query=null;o(f,!1)};break;case"#app-action":r=function(){var t=f.attr("class").match(/ui-icon-([\w\-]+)/)||[0,"carat-r"];f.is(".app-btn-more")?by(f):t&&(t[1]=="carat-r"?n.executeInContext(null,f.text()):n.executeInContext(t[1]))};break;default:if(c)if(c.match(/^tel/))r=function(){yf(c)};else if(!f.attr("target"))if(w=f.attr("data-content-type"),w&&w.match(/^image/))r=function(){if(h=$("#app-popup-image"),!h.length){h=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#app-back" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right"/><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"><\/div><\/div>').appendTo(u).popup(he("none")).popup("option","history",!0);h.find(".app-image-preview").one("load",function(t){var i=$(t.target);setTimeout(function(){it(!1);i.width("").height("");var e=h.find(".app-image-preview-box"),o=n.screen(),r=i.width(),f=o.width*.9,t=i.height(),u=o.height*.9;r>f?(t*=f/r,r=f,t>u&&(r*=u/t,t=u)):t>u&&(r*=u/t,t=u);i.hide();e.css({background:"",width:r+"px",height:t+"px"}).show();h.popup("reposition",{positionTo:"window"});e.css({background:String.format("url({0})",i.attr("src")),"background-size":String.format("{0}px {1}px",r,t)})},100)})}it(!0);h.find(".app-image-preview-box").hide();h.find(".app-image-preview").attr("src","").width(100).height("").show().attr("src",c+"&_ticks="+(new Date).getTime());ii=function(){rr(h)};h.popupopen()};else if(l=i.path.parseUrl(c),s=l.hash,l.host)r=function(){if(!it())if(l.host=="maps.apple.com"||l.host=="maps.google.com"||f.is('[rel="external"]'))yf(c);else{var t=l.pathname.replace(/\//g,"-").substring(1)||l.host.replace(/\W/g,"-"),u=l.filename.replace(/\W/g," "),i=n.page(t),r=i.find("iframe");it(!0);r.length&&r.remove();r=$('<iframe class="app-page-external"/>').attr("src",c).appendTo(i.find(".app-wrapper").addClass("app-wrapper-external")).load(function(){a()==t?it(!1):setTimeout(function(){n.pageInfo(t)||n.pageInfo({id:t,external:!0});n.changePage(t)},100)});et&&i.find(".app-wrapper").css("overflow","auto")}};else if(!f.closest(".ui-panel-inner").length)if(s)if(f.closest(".app-content-framework").length){if(v.data("app-click-test"))return;v.data("app-click-test",!0);i.linkBindingEnabled=!1;t.type="click";$(document).trigger(t);v.data("app-click-test",null);i.linkBindingEnabled=!0;t.isDefaultPrevented()||(s=="#"?r=function(){pi(i.activePage.find(".app-wrapper"),0)}:(y=s&&s.length>1&&i.activePage.find(s+',a[name="'+s.substring(1)+'"]'),p=i.activePage.find(".app-wrapper"),r=y&&y.length?function(){k=y.offset().top-(p.offset().top-p.scrollTop());e(f,function(){pi(p,k)})}:function(){$(s).is(".ui-page")&&n.changePage(s.substring(1))}));r&&t.preventDefault()}else s!="#"&&(r=function(){i.navigate(s)});else r=function(){ha(c,f.attr("data-transition"),f.attr("rel")=="external")}}if(r&&!n.busy())return e(f,function(){if(nt(),n.busy(!1),typeof r=="string"){var t=r;r=function(){$(t).trigger("vclick")}}ns(r)||r()}),!1}}}function gy(){var s,h,f,i,r;for(s in d.Nodes){d.nodes=d.Nodes[s];break}if(d.nodes){h=$("#app-btn-context").on("vclick",function(){if(!n.busy())return nt(),e(h,function(){bt()?dc():n.showContextMenu({scope:""})}),!1});d.footerIterators.unshift(function(){if($(this).is(".level0")){var i=$("<a/>").text(t.Settings).appendTo($('<li data-icon="gear" data-theme="b"/>').appendTo(this)).on("vclick",function(){li||o(i);dt=function(){n.contextScope("_contextMenu");es()};bu(!0)});return!0}});f=$("a#app-btn-menu");f.on("vclick",function(){function e(t){setTimeout(function(){o();uc()?n._menuPanel.panel("toggle"):r.panel("toggle")},t)}return(nt(),o(f,!1),nt(),f.attr("href")=="#app-back")?(setTimeout(function(){o();history.go(-1)},200),!1):(i?e(200):setTimeout(function(){var k,f,s,a,v,y,p,w,h,b,c;o();k=$('div[data-role="page"]');f=$();n._menuPanel=i=$('<div id="app-panel-menu" data-role="panel" data-position="left" data-position-fixed="true" data-display="overlay" data-theme="b" class="app-nav-panel"/>').appendTo(u);s=$('<ul data-role="listview"><li data-role="list-divider" data-theme="a" class="app-info"><span class="appname"/><p class="welcome"/><\/li><\/ul>').appendTo($('<div class="ui-panel-inner">').appendTo(i));a=i.find('li[data-role="list-divider"]');a.find(".appname").text(n.appName());v=d.headerIterators;y=d.footerIterators;v.length==0?a.find(".welcome").hide():$(v).each(function(){this.call(s)&&(p=!0)});p&&$('<li data-role="list-divider" data-theme="b"/>').appendTo(s);w=d.nodes;h=-1,function g(n,i,e,o,s){var c="level"+s;e.addClass(c);o.addClass(c);f=f.add(e);$(n).each(function(n){var i=this,a=i.url,v,l,f,c;if(i.children){$(i.children).each(function(){this.selected&&(v=!0)});var y=e.attr("id"),p=y+"-"+n,w=a;a="#";l=$('<div data-role="panel" data-position="left" data-position-fixed="true" data-theme="b" data-display="overlay" class="app-nav-panel"/>').appendTo(u).attr("id",p);f=$('<ul data-role="listview" data-theme="b"/>').appendTo($('<div class="ui-panel-inner"/>').appendTo(l));$("<a>").appendTo($('<li data-icon="arrow-u" data-theme="b"/>').appendTo(f)).attr({"data-for":y}).text(t.UpOneLevel);$('<li data-role="list-divider" data-theme="b"/>').appendTo(f);c=$('<a rel="external" class="app-btn-icon-transparent"/>').appendTo($("<li>").appendTo(f).attr({"data-theme":i.selected&&!v?"a":"b","data-icon":"false"})).attr("href",w).text(i.title);i.selected&&!v&&$(ki).appendTo(c);i.selected&&s>h&&(r=l,h=s);g(i.children,i,l,f,s+1)}i.selected&&s>h&&(r=e,h=s);c=$('<a rel="external" class="app-btn-icon-transparent"/>').appendTo($("<li>").appendTo(o).attr({"data-icon":i.children?"dots":"false","class":i.children?"menu-item menu-parent":"menu-item","data-theme":i.selected?"a":"b"})).attr({href:a,title:i.description}).text(i.title);i.children?c.attr("data-for",p):i.selected&&$(ki).appendTo(c)})}(w,null,i,s,0);b=f.find("ul").each(function(){var n=$(this),t;$(y).each(function(){this.call(n)&&(t||(t=!0,$('<li data-role="list-divider" data-theme="b"/>').insertBefore(n.find("li:last"))))})});c=$("#PageFooterBar,footer small");c.length&&$('<li data-role="list-divider" class="app-wrap app-copy" data-theme="b"/>').appendTo(s);b.listview().on("vclick","a",function(n){var i=$(n.target),t=i.attr("data-for"),u=i.attr("href");return!gt(i)||!u&&!t?!1:(li||(o(i),!t&&u&&vi()),dt||(dt=function(){setTimeout(function(){t?(r=$("#"+t),e()):l.location.href=u},fi)}),bu(t!=null),!1)}).on("swipe",function(){li=!0});c.length&&s.find(".app-wrap").html(c.html());hu();i=f.panel({animate:yr(),beforeopen:function(){},open:function(){r=$(this)},beforeclose:function(){},close:function(){!li&&dt&&(yr()?dt():setTimeout(dt,fi));dt=null;li=!1}});yr(i);gf(i);r||(r=f.slice(0,1));e(250)},200),!1)});$('div[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){function u(){var n=$('<li><a href="#" rel="external"/><\/li>').appendTo(i).find("a");$("#app-welcome").length&&!r?n.attr("href","#app-welcome").text(tt.LoginButton):at.loginStatus(n)}var f=$(this),i=$('<ul data-inset="false" />').appendTo(f),r=at&&at.loggedIn();at&&!r&&u(),function s(n,t,i){$(n).each(function(){var n=this,r=n.url,f=$("<li/>").appendTo(t).addClass("app-depth"+i),u,e;r?(u=r.match(nf),u&&(r=u[2],e=u[1]),$("<a/>").appendTo(f).attr({href:r,target:e,rel:"external"}).text(n.title)):$("<span><\/span>").appendTo(f).text(n.title);n.children&&s(n.children,t,i+1)})}(d.nodes,i,1);at&&r&&u();i.listview().on("vclick",'a[rel="external"]',function(t){var i=$(t.target),r=i.attr("href"),u=i.attr("target"),f=r.match(/^#/);return gt(i)?(f||u||vi(),e(i,function(){f?n.changePage(r.substring(1)):(o(),u?l.open(r,u):l.location.href=r)}),!1):!1}).filterable({filterPlaceholder:t.FilterSiteMap})})}}function ks(n){var t=n.originalEvent.clientY&&n.originalEvent||n.originalEvent.touches[0]||n.originalEvent.changedTouches[0];return{x:t.clientX,y:t.clientY}}function ce(n){return n.type.match(/^(MS)?pointer/)?n.originalEvent.pointerType=="touch":!0}function ae(){clearTimeout(ca);fr&&(fr.data("touch-start",null),fr=null)}var er="app-transition app-animation-spin ui-icon-refresh",or="ui-btn-icon-right app-checked",sr=navigator.userAgent,ve=navigator.platform,et=/iPhone|iPad|iPod/.test(ve)&&sr.indexOf("AppleWebKit")>-1,gu=et?parseInt(navigator.userAgent.match(/\(i.*;.*CPU.*OS (\d)_\d/)[1]):null,hr=/Android/i.test(sr),np=/chrom(e|ium)/i.test(sr),ci=!!sr.match(/Trident\/7\./),nh="mouse",tp=/safari/i.test(sr),kt=ve.match(/Win\d+|Mac/i)!=null,la=ve.match(/Mac/i)!=null,aa=/^s*(\w+)\s*\|s*(.+?)\s*(\|\s*(.+)\s*)?$/,va=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=\".+?\")/g,ya=/(<(\/*(b).*?>))/g,pa=/\" ([\.;])/g,wa=/phone/i,ba=/email/i,ka=/\burl/i,da=/^\s*(\w+)(\s+(\w+)\s*)?$/,th=/\$(true|false|in|notin|tomorrow|today|yesterday|next|this|last|year|past|future|quarter|month|isempty|isnotempty)/,ih=/(delete|minus|trash|refresh)/,nf=/^(_\w+):(.+)$/,at,ye="",d,st=Web.DataViewResources,rh=st.Views,uh=st.Menu,y=st.Data,cr=st.Pager,tf=st.ModalPopup,ut=st.HeaderFilter,t=st.Mobile,vt=st.Grid,pe=st.Form,nu=st.Actions,tu=st.Validator,ga=st.Lookup,tt=Web.MembershipResources&&Web.MembershipResources.Bar,nv=st.InfoBar,rf=y.BooleanDefaultItems[0][1],uf=y.BooleanDefaultItems[1][1],ff,ht,fh,eh,ef,ii,lr,dt,li,ar,oh,iu,we,sh,ru,ri,ui,ai,b,hh={},h,wi,be,ch={},ke,tv=500,iv=500,rv=0,lh,de,ge,s,uv,of,uu,fu,sf,eu,r,l=window,u,g=$(l),i=$.mobile,fi=100,bi=[],hf,cf,lf,af,ei,fv='<svg class="app-icon-carat-u" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="14px" height="14px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><polygon class="app-icon-themed" points="2.051,10.596 7,5.646 11.95,10.596 14.07,8.475 7,1.404 -0.071,8.475 "><\/polygon><\/svg>',ev='<svg class="app-icon-carat-d"  version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"  width="14px" height="14px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><polygon class="app-icon-themed" points="11.949,3.404 7,8.354 2.05,3.404 -0.071,5.525 7,12.596 14.07,5.525 "/><\/svg>',ki='<svg class="app-icon-check" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-62 64 14 14" enable-background="new -62 64 14 14" xml:space="preserve"><polygon class="app-icon-themed" points="-48,67 -49.8,65.2 -57,72.4 -60.2,69.2 -62,71 -58.7,74.2 -58.8,74.2 -57,76 -57,76 -56.9,76 -55.2,74.2 -55.2,74.2 "/><\/svg>',ps,ws,bs,n,fr,ca,ds,le,gs;$.fn.popupopen=function(n){return u.focus(),this.popup("open",n),this};typeof Web=="undefined"&&(Web={DataView:{}});Web.DataView.MobileBase=function(){Web.DataView.MobileBase.initializeBase(this)};Web.DataView.MobileBase.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return null},reset:function(){},wait:function(){},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},inserting:function(){return this.dataView().get_isInserting()},editing:function(){return this.dataView().get_isEditing()},content:function(){var t=this._dataView;return n.content(t._id)},commandRow:function(n){if(arguments.length==0)return this._commandRow;if(n){var t=this._commandRow=n.slice(0);return this.dataView()._rows=[t],t}return n},command:function(n,t,i,r,u){var f=0,e;n&&!n.length&&(n=null,f=null);this.commandRow(n);e=this.dataView();e.executeRowCommand(f,t,i,r,u)},action:function(n,t,i,r,u,f){this.commandRow(n);var e=this.dataView();e.executeAction(0,t,i,r,u,f)},itemMap:function(){return ay(this.dataView(),!0)},stateChanged:function(){p()},lookupInfo:function(n){var t=this.dataView();if(arguments.length)t._lookupInfo=n;else return t._lookupInfo},viewDescription:function(){var t=this.dataView(),i=t._showDescription!=!1,n=i&&t.get_view().HeaderText;return n=i?t._formatViewText(rh.DefaultDescriptions[n],!0,n):"",n?n.replace(/\n/g,"<p/>"):null},executeInContext:function(n,t,i,r){var e=this.lookupInfo(),u=[],f;return i&&this.lookupInfo(null),this.context(u),i&&this.lookupInfo(e),$(u).each(function(){var i=this,u=i.command;if(u&&u==n&&(t==null||i.argument==t))return f=i,r||wt(i),!1}),f},tagged:function(n){return this.dataView().get_isTagged(n)},filterStatus:function(n,t){var u=this,i=u.dataView(),r,f=pr(i),e=i?i.get_filter():null,o=f.length>0,s=i&&e.length>0&&!i.filterIsExternal();return(s||o)&&u.options().filterDetails?(r=new Sys.StringBuilder,o&&!t&&i._renderFilterDetails(r,f,!1),s&&i._renderFilterDetails(r,e,!n),r.toString().replace(va,"").replace(ya,'"').replace(pa,'"$1')):null},aggregates:function(){var n=this._dataView._aggregates;return n&&n.length?n:null},aggregateLabels:function(){var n=[];return $(this._dataView._fields).each(function(){var t=this;n.push(t.Aggregate==0?null:String.format(Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[t.Aggregate]].FmtStr,"").trim())}),n},calculate:function(){},afterCalculate:function(){}};Web.DataView.Extensions={};Web.DataView.prototype.pageProp=function(n,t){if(n=this._id+"_"+n,arguments.length==1)return si(n);si(n,t)};Web.DataView.prototype.viewProp=function(n,t){if(n=(this._viewId||"grid1")+"_"+n,arguments.length==1)return this.pageProp(n);this.pageProp(n,t)};Web.DataView.prototype.mobileUpdated=function(){var t=this,f=t.pageProp("viewId"),u,i;t.get_useCase()||t.get_lastCommandName()||(f&&(t._viewId=f),u=t.viewProp("sortExpression"),i=t.viewProp("filter"),u&&(t._sortExpression=u),i&&i.length&&(t._filter=(t._filter||[]).concat(i)));var e=$(t._element),r=el(e,document.title),o=$app.eval(e.attr("data-page-header")),s={id:t.get_id(),text:o||r.text,headerText:o||r.text,dataView:t,activator:r};t._pageSize=sr.match(/iPad;.*CPU.*OS \d_\d/i)||kt?30:24;n.pageInfo(s);t._hidden||t._filterSource||n._appLoaded||$('<a class="app-action-navigate"/>').attr("href","#"+s.id).appendTo($("<li>").appendTo(n.pageMenu())).text(r.text)};Web.DataView.Extensions.Grid=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.Extensions.DataSheet=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.MobileGrid=function(n){Web.DataView.MobileGrid.initializeBase(this);this.dataView(n)};Web.DataView.MobileGrid.prototype={initialize:function(){var n=this,t=n.dataView().pageProp("viewStyle");t||(n.tagged("view-style-map")&&!n.tagged("disable-view-style-map")?t="Map":n.tagged("view-style-cards")&&!n.tagged("disable-view-style-cards")?t="Cards":n.tagged("view-style-list")&&!n.tagged("disable-view-style-list")?t="List":n.tagged("view-style-grid")&&!n.tagged("disable-view-style-grid")?t="Grid":n.tagged("view-style-charts")&&!n.tagged("disable-view-style-charts")?t="Charts":(t=f()?"Grid":"List",$(n._dataView._fields).each(function(){if(this.OnDemand&&this.OnDemandStyle!=1)return t="Cards",!1}),$(n._dataView._fields).each(function(){if(this.Rows>1)return t="List",!1})));n._viewStyle=t},options:function(){var n=this.dataView();return{quickFind:n.get_isGrid()&&n.get_showQuickFind(),filterDetails:!0}},viewStyle:function(t){var r=this,u=r.dataView(),e=r._viewStyle,f,o;if(arguments.length==0)return e;f=i.activePage;o=e;r._viewStyle=t;f&&(bo(),u.pageProp("viewStyle",t),n.presenter("supports",t)?(ot(),r._instructed=!1,n.presenter("show",{name:t,id:u._id,container:f.find(".app-wrapper")})):(ot(),r._reset=!0,r._instructed=!1,u.sync()));p()},tap:function(t,i){var u;if(t){var r=this.dataView(),e=n.pageInfo(r._id),f=t.row||t;r._busy()||(r._hasKey()?(this.command(f,"Select"),t.pageIndex!=null&&this.currentPageIndex(t.pageIndex),i&&n.dataViewUILinks(r).each(function(){var n=$(this),t=n.data("data-context");if(t&&r.rowIsSelected(t.row))return n.addClass("app-selected"),!1}),i&&i!="select"||(this.lookupInfo()?this.executeInContext("Select"):(u=[],n.navContext(u),$(u).each(function(){var n=this;if(n.text&&n.icon!="dots"&&!n.system)return wt(n),!1})))):n.infoView(r,!0,f),p())}},clearSelection:function(n){var t=this.dataView();t._clearSelectedKey();t._forgetSelectedRow(!0);this._commandRow=null;this.currentPageIndex(null);n&&($("#"+t._id+"_echo").find('ul[data-role="listview"] a.app-selected').removeClass("app-selected"),$("#"+t._id).find('.app-wrapper > ul[data-role="listview"] a.app-selected').removeClass("app-selected"),yh(t));p()},quickFind:function(n){var t=this.dataView();if(n!=null)t.viewProp("quickFind",n),t._executeQuickFind(n),rc(t);else return t.viewProp("quickFind")||""},useAdvancedSearch:function(n){var i=this.dataView(),t;if(arguments.length)i.viewProp("useAdvancedSearch",n);else return t=i.viewProp("useAdvancedSearch"),t==null&&(t=i.get_searchOnStart()),t==!0},dispose:function(){var i=this,t=i.content();n.presenter("dispose",{id:i.dataView()._id,container:t});yi(t);t.prev().find("h3, .app-bar-controls").off();t.find(".app-map").each(function(){var t=$(this),n=t.data("data-map");n&&(ia(n),n.map=null,t.data("data-map",null))})},refresh:function(){function ui(n){n?(ir=d.css("display")!="block",ir&&(d.css({display:"block","z-index":-10}),pt(d),l.scrollTop(di))):ir&&(lo(d),d.css({display:"","z-index":""}))}function rr(){o.useAdvancedSearch(!0);s.set_searchOnStart(!1);wr(s,null)}function yr(){var y,i=0,n,t;if(ui(!0),y=ao(l),v&&v.length&&v.position().top>=l.scrollTop()&&(i=v.outerHeight(!0),l.scrollTop(i)),lt||!o._synced){if(sc(s,d,et),n=s.get_master(),n&&(n.get_isInserting()?ft(h.text,at):(row=n.extension().commandRow(),t=n._fields[0],t=n._allFields[t.AliasIndex],ft([t.format(row[t.Index]),h.text],at))),s._lookupInfo&&ft(h.headerText,at),ei.length){lt&&s.raiseSelected();var r=l.offset().top,f=l.height(),u=Math.ceil(ei.offset().top),e=ei.outerHeight(!0);(u<r||u+e>=r+f)&&l.scrollTop(u-r+i-(f-e)/2)}else if(o._synced||!s.get_selectedKey().length||s._lookupInfo)o.clearSelection();else{function c(){a()!=h.id||b?setTimeout(c,50):s.sync()}c()}o._synced=!0}lu(d);ui(!1);it(!1)}var o=this,k=o.pageIndex(),s=o.dataView(),h=n.pageInfo(s._id),uu=s._fields,fu=s._allFields,ht=o.content(),d=$("#"+h.id),vt=o.visibleDataRows(k),c=ht.find('ul[data-role="listview"]'),dt=this.pageSize(),pr=k>0,kr=k<o.pageCount()-1,ii,ki,dr=s.get_showRowNumber()==!0,lt=o._reset,w=o.viewStyle(),et,l=ht.closest(".app-wrapper"),ri,di=l.scrollTop(),at=l.find(".app-page-header"),gi,nr,ir,eu,nu,ni=ht.prev(),er,tt,ar,tu,iu,bt,st,ai,vi,vr,pi,rt,wi,bi,kt,ru;if(o.echoCallback){o.echoCallback();return}if(!vt){lt&&ur(c);s.goToPage(k,!0);return}if(h.echoId&&!h.echoInitialized){br(h.echoId);h.displayed||(h.initialized=!1);return}if(lt&&(h.echoChanged=!0,o.currentPageIndex(k)),!b&&h.id!=a()&&h.id!=lh&&!s._lookupInfo){ou(h);ct();return}if(h.displayed=!0,h.initialized=!0,o._checkedViews||(o._checkedViews=!0,!s._lookupInfo&&s.get_showActionBar()?ni=dv(s,ht):(gi=[],kl(gi,!1,h)>1&&(nr=[],$(gi).each(function(){var n=this;nr.push({text:n.text,active:n.icon=="checked",callback:n.callback})}),n.tabs("create",{tabs:nr,className:"ui-header-fixed app-tabs-views",id:s._id+"_view-tabs",placeholder:ht}),ft(!1,at),eu=!0))),ni.length&&at.addClass("app-has-action-bar"),n.presenter("supports",{name:w,id:s._id})){function fr(){return ie(ni,s,h),eo(l,o),n.presenter("show",{name:w,id:s._id,container:l,reset:lt})}h.requiresInitCallback?(h.initCallback=function(){var t=o._autoSelect;o._autoSelect=null;t&&!n.busy()?o.tap(t.row,t.action):s.get_searchOnStart()?rr():fr()},h.requiresInitCallback=!1,n.navigate(h.id)):h.requiresReturnCallback?(h.returnCallback=function(){fr()},h.requiresReturnCallback=!1):fr();o._reset=!1;ou(h);return}if(w.match(/Grid|Cards|List|Map/)||(w=o._viewStyle=f()?"Grid":"List",s.pageProp("viewStyle",w)),et=w=="Grid",ki=o.itemMap(),r.promoteActions&&((w=="List"||w=="Cards")&&ki.thumb!=null?u.is(".app-promo-position-right")||u.addClass("app-promo-position-right"):u.is(".app-promo-position-right")&&u.removeClass("app-promo-position-right")),gh(l,o),w=="Map"){if(yi(ht),d.find(".dv-heading").remove(),!o.tagged("supports-view-style-map")){o.viewStyle(f()?"Grid":"List");p();return}if(ls(),lt){o._reset=!1;o._mapPageWindow=null;er=!1;$(vt).each(function(){if(s.rowIsSelected(this))return er=!0,o.tap(this,"none"),!1});er?s.raiseSelected():o.clearSelection();o.refresh();return}ft(!0);ui(!0);eo(l,o);ie(ni,s,h);tt=l.find("> .app-map");tt.length||(tt=$('<div class="app-map"><\/div>').appendTo(l).attr("data-map-for",s._id).hide(),n.registerAPI("Map"));lu(d);ui(!1);function su(t){function r(){var c=e!=n.asyncJob(),f,l,u,h;if(i.length&&!c)f=i[0],l=new Date,t.geocoder.geocode({address:f.address},function(n,u){var e,h,c,a;if(u==google.maps.GeocoderStatus.OK)e=n[0].geometry.location,h=ra(o,tt,e,f.title,f.row),s.rowIsSelected(f.row)&&se(t,h),na(f.address,e.lat(),e.lng()),cs(t),gr(h,750,google.maps.Animation.DROP);else if(u==google.maps.GeocoderStatus.ZERO_RESULTS)na(f.address);else{if(u==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(r,1e3);return}alert(u+": "+f.address)}i.splice(0,1);c=new Date-l;a=675;c<a?setTimeout(function(){r()},a-c):r()});else{if(!c&&i.length==0&&t.markers.length<iv&&(u=o._mapPageWindow,u||(u=o._mapPageWindow={top:k,bottom:k,dir:"up"}),u.dir=="up"?u.bottom<o.pageCount()-1?(u.bottom++,u.dir="down"):u.top--:u.top>0?(u.top--,u.dir="up"):u.bottom++,h=u.dir=="down"?u.bottom:u.top,h>=0&&h<o.pageCount()-1)){o.pageIndex(h);o.refresh();return}c||(it(!1),o._mapPageWindow=null)}}var f=oe(s),i=[],e=n.nextAsycJob(),u;t.fit=!0;o._mapPageWindow==null&&ia(t);$(vt).each(function(){var n=this.slice(0),r=yy(n,f),e=fu[uu[0].AliasIndex],h=e.text(n[e.Index]);typeof r=="string"?r!="ZERO_RESULTS"&&(i.push({address:r,title:h,row:n}),t.geocoder||(t.geocoder=new google.maps.Geocoder)):(u=ra(o,tt,r,h,n),s.rowIsSelected(n)&&se(t,u))});cs(t);it(!0);r()}function fi(){var t=tt.data("data-map");t?(tt.show(),hc(l),su(t)):n.supports("Map")?(t={map:new google.maps.Map(tt.get(0),{zoom:8}),geocoder:null,markers:[]},tt.data("data-map",t).show(),o.refresh()):setTimeout(fi,100)}h.requiresInitCallback?(h.initCallback=function(){var t=o._autoSelect;o._autoSelect=null;t&&!n.busy()?o.tap(t.row,t.action):s.get_searchOnStart()?rr():fi()},h.requiresInitCallback=!1,n.navigate(h.id)):h.requiresReturnCallback?(h.returnCallback=function(){fi()},h.requiresReturnCallback=!1):fi();o._reset=!1;ou(h);return}ci||(ri=$('<div class="app-scrollable-cover"/>').appendTo(l.parent()).css({position:"absolute",left:l.offset().left,top:l.offset().top,width:l.outerWidth(),height:l.outerHeight(),zIndex:2,backgroundColor:hr?"transparent":"#fff"}));c.length||(c=$('<ul data-role="listview" class="app-listview"/>').appendTo(ht).listview().on("taphold",function(n,t){if(t&&(n=t),gv())return!1;if(!s._busy()){var r=$(n.target),i=r.closest("a"),l=i.data("data-context"),u=s.multiSelect()&&!1;return i.closest("li").is(".dv-item")&&!i.is(".app-divider")&&(i.is(".app-selected")?(i.removeClass("app-selected"),u||(o.clearSelection(),o.lookupInfo()?e(i,function(){o.executeInContext("Clear")}):e(i,function(){}))):s._hasKey()&&(u||c.find("a.app-selected").removeClass("app-selected"),i.addClass("app-selected"),o.tap(l,"none"),h.echoChanged=!0,e(i,function(){})),ii=!0),o.viewStyle()=="Grid"&&!f()&&r.is("span")&&cc(r),!1}}).on("vclick",function(t){function u(n){s._busy()||(o._loadAtTop=!n,o.pageIndex(o.pageIndex(n?"bottom":"top")+(n?1:-1)),o.refresh())}var r=$(t.target),i=r.closest("a");if(!r.is(".app-btn-toggle")&&i.length&&!i.is(".app-divider")&&!co(t)){if(i.is(".dv-load-at-bottom"))u(!0);else if(i.is(".dv-load-at-top:visible"))ot(),setTimeout(function(){u(!1)},50);else{if(ii){ii=!1;return}if(!gt(r)||n.busy())return!1;if(t.ctrlKey)return c.trigger("taphold",t),ii=!1,!1;if(i.is(".dv-action-none"))return!1;s.multiSelect()&&!1?c.find("a.app-selected:first").length&&(i.is(".app-selected")?i.removeClass("app-selected"):i.addClass("app-selected")):e(r,function(){if(!s.multiSelect()||!0){var n=i.data("data-context");n?s._hasKey()?(c.find("a.app-selected").removeClass("app-selected"),i.addClass("app-selected"),r.is(".app-btn-more")?(o.tap(n,"none"),vs(r)):o.tap(n),h.echoChanged=!0):o.tap(n):i.is(".dv-action-refresh")?s.sync():i.is(".dv-action-new")?o.executeInContext("New",null,!1):i.is(".dv-action-filter-clear")&&fo(s,!0)}})}return!1}}).contextmenu(function(n){return oa(o.dataView(),n)}),ku(s,c));lv(c,w);lt&&(di=0,ur(c));ie(ni,s,h);var g=c.find("li.dv-item"),yt=g.length>dt*2,wt=c.find("li:last"),v,or=k*dt,nt=o._loadAtTop,ei,ti,sr,lr=wt&&wt.length&&wt.prev(),hu=lr&&lr.position().top,si,li;(pr&&wt.length==0||yt&&!nt&&!c.find("li.dv-load-at-top-parent").length)&&(at.hide(),v=$(String.format('<li data-icon="false" class="dv-load-at-top-parent"><a class="dv-load-at-top"><p>{0}<\/p><\/a><\/li>',ut.Loading)),yt?(v.insertBefore(g.get(0)),pr=!0):v.appendTo(c));nt?(v=c.find("li:first"),ti=v.length&&v.next(),sr=ti&&ti.position().top,vt=vt.slice(0).reverse()):wt.remove();$(vt).each(function(n){var t=this,i=$('<li class="dv-item" data-icon="false"/>'),u=nt?or+dt-n:or+n+1,r=$("<a/>").appendTo(i).data("data-context",{row:this.slice(0),pageIndex:k});s.rowIsSelected(t)&&(r.addClass("app-selected"),o.commandRow()||(s._forgetSelectedRow(!0),o.command(t,"Select")));et?yu(s,t,dr?u:null,r):tr(s,t,ki,dr?u:null,i,r,w=="List");nt?i.insertAfter(v):i.appendTo(c)});(kr&&!nt||yt&&nt&&!c.find("li.dv-load-at-bottom-parent").length)&&(wt=rt=$(String.format('<li data-icon="false" class="dv-load-at-bottom-parent""><a href="#" class="dv-load-at-bottom"><p>{0}<\/p><\/a><\/li>',ut.Loading)).appendTo(c));nt&&k==0&&v.remove();s._totalRowCount||(si=$('<li data-icon="refresh"><a class="dv-action-refresh"><p/><\/a><\/li>').appendTo(c).find("a"),si.attr("title",cr.Refresh).find("p").text(y.NoRecords),s._filter&&s._filter.length&&!s.filterIsExternal()&&(li=$('<li data-icon="filter"><a class="dv-action-filter-clear"><p/><\/a><\/li>').appendTo(c).find("a"),li.attr("title",t.ClearFilter).find("p").text(t.ClearFilter)));kr||(ar=o.aggregates(),ar&&et&&s._totalRowCount>0&&(tu=$('<li data-icon="false" class="dv-item"/>').appendTo(c),iu=$('<a class="app-divider app-calculated"/>').appendTo(tu),yu(s,ar,null,iu,o.aggregateLabels())),r.promoteActions?nu=!0:(bt=o.executeInContext("New",null,!1,!0),bt&&(ai=$('<li class="dv-action-new">').appendTo(c).attr("data-icon",bt.icon),st=$('<a class="dv-action-new"/>').appendTo(ai).attr("title",t.LookupNewAction),et?$("<p>").appendTo(st).text(bt.text):($("<h3>").appendTo(st),vi=ai.prev(),vi.is(".dv-item")&&(st.html(vi.find("a").html()).find("p,img,span").css("visibility","hidden"),vi.is(".ui-li-has-thumb")&&ai.addClass("ui-li-has-thumb")),st.find("h3").text(bt.text),s._totalRowCount||$("<p>").appendTo(st.html("")).text(bt.text)))));or==0&&(ft(!0),vr=c.find("li:first"),s._lookupInfo||(parentDataView=s.get_parentDataView()||$app.find(s.get_filterSource()),parentDataView&&(rt=is(parentDataView),rt&&(parentDataView.get_showInSummary()&&d.addClass("app-has-summary"),rt.addClass("app-yardstick"),ku(parentDataView,rt),rt.insertBefore(vr)))),pi=o.instruction(),(pi||et)&&(rt=$('<li data-role="list-divider" class="app-list-instruction"/>').insertBefore(vr),pi&&rt.html(pi),et&&!!s._totalRowCount&&ts(s,rt)));yt&&(nt?(g=g.slice(dt*(hr?2:2)),g.find("a").data("data-context",null),g.remove(),c.find("li.dv-action-new").remove()):(at.hide(),wi=$(String.format('<li style="clear:left;height:{0}px"><\/li>',i.getScreenHeight()*10)).appendTo(c),c.find("li.app-list-instruction").remove(),c.find("li.app-li-card").remove(),g=g.slice(0,dt),g.find("a").data("data-context",null),g.remove()));c.listview("refresh");nu&&c.find("li.dv-item:last").addClass("app-has-promo");oi(c);c.appendTo(l);yt?nt?(bi=ti.position().top,kt=l.scrollTop(),l.scrollTop(kt+bi-sr)):(ru=lr.position().top,kt=l.scrollTop(),l.scrollTop(kt+ru-hu)):nt?(bi=ti.position().top,kt=l.scrollTop(),l.scrollTop(kt+bi-sr)):l.scrollTop(di);wi&&setTimeout(function(){wi.prev().addClass("ui-last-child");wi.remove()},100);ei=c.find("a.app-selected:first");et&&(si&&si.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),st&&st.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),li&&li.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"));h.requiresInitCallback?(yr(),h.initCallback=function(){var t=o._autoSelect,i=s._lookupInfo;o._autoSelect=null;t&&!n.busy()?o.tap(t.row,t.action):s.get_searchOnStart()?rr():hi(200)},h.requiresInitCallback=!1,n.navigate(h.id)):h.requiresReturnCallback?(yr(),h.returnCallback=function(){hi(200)},h.requiresReturnCallback=!1):(yr(),hi(200));ri&&(hr&&yt?setTimeout(function(){ri.remove()},300):ri.remove());o._reset=!1;o._loadAtTop=null;ou(h)},reset:function(){var f=this.dataView(),t=n.pageInfo(f._id),e="#"+t.id,r=i.navigate.history,u;this._reset=!0;$(r.stack).each(function(n){return n>r.activeIndex?!1:this.hash==e?(u=!0,!1):void 0});u||(t.initialized=!1,t.echoInitialized=!1,t.echoId=!1)},visibleDataRows:function(n){var u=this._dataView,f=this.pageCount(),i=u._cachedPages,t,r;if(i)for(t=0;t<i.length;t++)if(r=i[t],r.index==n)return r.rows;return null},currentPageIndex:function(n){return arguments.length&&(this._currentPageIndex=n),this._currentPageIndex},pageIndex:function(n){var t=this._dataView,i,r;if(typeof n=="string")return n=="bottom"&&(i=this.content().parent().find("ul li.dv-item:last a").data("data-context"),i)?i.pageIndex:n=="top"&&(r=this.content().parent().find("ul li.dv-item:first a").data("data-context"),r)?r.pageIndex:t.get_pageIndex();if(n==null)return t.get_pageIndex();t.set_pageIndex(n)},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageSize:function(){var n=this._dataView;return n.get_pageSize()},instruction:function(n){var u=this.lookupInfo(),e=this.dataView(),i=this.viewDescription()||"",f=this.filterStatus(),r;return u&&(i=String.format(u.field.ItemsDescription||t.LookupInstruction,u.aliasField.HeaderText),u.value&&(r=u.text,r&&r.length>50&&(r=r.substring(0,50)+"..."),i+=String.format(t.LookupOriginalSelection,r))),n!=!1&&(i||f)&&e._totalRowCount>1&&(i&&(i+=" "),i+=String.format(t.ShowingItemsInfo,e._totalRowCount)),f&&(i&&(i+=" "),i+=String.format('<span class="app-filter" title="{1}">{0}<\/span>',f,t.Filter)),i},context:function(r,u){var c=this,e=c.dataView(),w=e.extension(),l=e._totalRowCount,b=e.get_view().Label,k=e.get_sortExpression(),h=c.commandRow()||[],s=this.lookupInfo(),a=h&&h.length,p;if(l!=-1)if(e.get_showViewSelector()&&r.push({text:b,count:l,theme:"b",icon:"dots",system:!0,toolbar:!1,callback:cy}),(e.get_showQuickFind()&&(l>1||e.get_filter().length>e.get_externalFilter().length)||pr(e).length)&&r.push({text:vt.PerformAdvancedSearch,desc:ic(e),icon:"search",toolbar:!1,system:!0,context:{dataViewId:e._id},callback:wh}),r.push({text:t.Sort,icon:"sort",desc:iy(e),toolbar:!1,system:!0,callback:fy}),r.push({text:t.Filter,icon:"filter",desc:w.filterStatus(!0),toolbar:!1,system:!0,callback:dr}),s&&s.value==null||r.push({}),gl(e,r,h),s?i.activePage.find(".dv-heading.app-disabled").length&&!ko()&&r.push({text:a?c.instruction():null}):hs(e,r,h),s){function v(n,t,i){function y(){r.siblings("input:text").focus()}ot();var r=$("#"+s.pageId+" .app-field-"+s.field.Name),c=s.field.Copy,l,u,a,v,h;if(s.value=n,s.text=t,v=r.val(),r.val(n),r.prev().text(s.text),n&&c){for(h=[],l=/(\w+)\s*=\s*(\w+)/g,u=l.exec(c);u;)a=e.findField(u[2]),h.push({Name:u[1],NewValue:a?i[a.Index]:null}),u=l.exec(c);h.length&&s.field._dataView.extension().afterCalculate(h)}vu(!0);ai=function(){f()?setTimeout(y,200):setTimeout(function(){o(r.prev())},200);v!=r.val()&&wf(r)};setTimeout(function(){history.go(-1)},100)}a&&r.push({text:t.LookupSelectAction,icon:"check",command:"Select",callback:function(){var i=s.field.ItemsDataValueField,r=s.field.ItemsDataTextField,e=n.pageInfo(),t=e.dataView,u,f;i||$(t._allFields).each(function(){if(this.IsPrimaryKey)return i=this.Name,!1});r||$(t._allFields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return r=n.Name,!1});u=t.findField(i);f=t.findField(r);v(h[u.Index],h[f.Index],h)}});s.value&&r.push({text:t.UnSelect,icon:"delete",command:"Clear",callback:function(){v(null,y.NullValueInForms)}});String.isNullOrEmpty(s.field.ItemsNewDataView)||r.push({text:t.LookupNewAction,icon:"plus",command:"New",callback:function(){c.executeInContext("New",s.field.ItemsNewDataView,!0)}});r.push({});a&&!s.field.tagged("lookup-details-hidden")&&r.push({text:t.LookupViewAction,callback:function(){Web.DataView._defaultUseCase="ObjectRef";c.executeInContext("Select","editForm1",!0)}});hs(e,r,h);r.push({text:cr.Refresh,icon:"refresh",callback:function(){e.sync()}})}else u||(u=["Grid","ActionColumn","ActionBar"]),u.length==1&&u[0]=="Grid"&&$(e._views).each(function(){var n=this;if(n.Type=="Form"&&n.Id.match(/edit/))return p=n.Id,!1}),ee(u,e,r,h,p)}};Web.DataView.Extensions.Form=function(n){return new Web.DataView.MobileForm(n)};Web.DataView.MobileForm=function(n){Web.DataView.MobileForm.initializeBase(this);this.dataView(n)};Web.DataView.MobileForm.prototype={initialize:function(){this._editors={};this._initRow()},_initRow:function(){var n=this.dataView(),t=this.inserting()?n._newRow:n._rows[0];return n._mergeRowUpdates(t),this.commandRow(t)},reset:function(){this._reset=!0;this._initRow()},options:function(){return{quickFind:!1,filterDetails:!1}},dispose:function(){this._dispose()},_dispose:function(t){var i=this.content(),f,s,r,e,o,u;this._newValues=null;i.find(".app-drop-box").each(function(){$app.upload("destroy",{container:this})});i.find('input[data-input-type="datepicker"]').datepicker("destroy");i.find('select[data-role="slider"]').slider("destroy").remove();i.find("select").selectmenu("destroy");f=i.find(".app-container-scrollable").data("data-field",null).find("fieldset");f.find(":checkbox,:input").off().checkboxradio("destroy");f.controlgroup("destroy");for(s in this._editors)r=this._editors[s],r.field=null,r.originalField=null,$(r.item).remove(),delete r.item,$(r.label).remove(),delete r.label,$(r.readers).remove(),delete r.readers,$(r.writers).remove(),delete r.writers;this._editors={};i.find("div.app-status-bar, div.app-bar-buttons,div.app-stub,div.app-form-grid").remove();e=i.parent().find('div[data-role="header"]');e.find('div[data-role="navbar"]').navbar("destroy").remove();e.toolbar("destroy").remove();yi(i);o=i.find(".ui-collapsible-set");o.find(".ui-collapsible-heading a").off();o.remove();u=i.find(".app-echo").each(function(){var i=$(this).attr("data-for"),t=n.pageInfo(i);t&&(t.echoId=null,t.echoInitialized=!1)});u.find(".app-echo-toolbar").find(".ui-icon-dots, h3, .app-echo-controls, .app-echo-see-all").off();u.find(".app-echo-inner").off();u.find(".app-echo-footer").off();u.remove();n.tabs("destroy",{container:i});t&&p()},viewStyle:function(){return"Form"},refresh:function(){function ot(n){bar=t.find(".app-bar-buttons:eq(1)");n?bar.removeClass("app-bar-buttons-hidden"):t.find(".ui-collapsible:visible .ui-collapsible-heading:not(.ui-collapsible-heading-collapsed)").length?bar.removeClass("app-bar-buttons-hidden"):bar.addClass("app-bar-buttons-hidden")}function pt(n,t){if(arguments.length==2)r.viewProp("categoryState"+n,t);else return r.viewProp("categoryState"+n)==!0}function si(){}function ci(){et&&h.length&&(ht=h.outerWidth(),lt=h.offset().left,k=g.width(),ko()&&(k-=$("#app-sidebar").outerWidth()),lt+ht+20>k&&st.scrollLeft(h.is(".Last")?lt+ht-k+(h.outerWidth(!0)-h.find(".Self").outerWidth()):lt-(k-ht)/2));io(t);hi(200);setTimeout(function(){ho(t)},100)}var u=this,r=u.dataView(),o=n.pageInfo(r._id),li=r._fields,vt=r._allFields,ni=r._categories,t=u.content(),l,ti=[],f,a,v,ut,ai=u.itemMap(),et,yt=this.inserting(),vi=this._reset,ii,y=r.get_showActionButtons(),ri=r._confirmContext,p=$("#"+o.id),w=p.find(".app-page-header"),ui,st,h,ht,lt,k,d,at,tt,wt,bt,gt;o.headerText=ri&&ri.WindowTitle||r.get_view().Label;yt&&w.attr("data-locked","false").data("data-text",null);ft(o.headerText,w);t.closest(".ui-page").addClass("app-form-page");vi&&(u._dispose(),u._commandRow=null);ii=u._editors;l=u.commandRow()||u._initRow()||[];et=r.statusBar();et&&(st=$('<div class="app-status-bar"/>').html(et).appendTo(t),h=st.find(".Current"),kt||st.css("overflow-x","auto"));d=$app.find(r.get_filterSource());d&&(tt=is(d),tt&&(tt=tt.appendTo(t),d.get_showInSummary()&&p.addClass("app-has-summary"),at=$('<ul data-role="listview" class="app-listview"/>').appendTo(t),ku(d,at),tt.appendTo(at),oi(at.listview())));wt=u.viewDescription();wt&&(bt=$('<ul data-role="listview" class="app-list-instruction"/>').appendTo(t),$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(bt).html(wt),bt.listview());(y=="TopAndBottom"||y=="Top")&&$('<div class="app-bar-buttons"/>').appendTo(t);yt||(v=vt[vt[ai.heading].AliasIndex],v=v.text(l[v.Index],!1));var it=4,c=0,rt=0,fi,dt,s=[],ei=0,yi=0;$(ni).each(function(){var n=this;f!=n.Tab&&(f=n.Tab,c=0,rt=0,firstCategory=!0,ei++);(firstCategory||n.NewColumn)&&c++;f&&(s[ei-1]=c);firstCategory=!1});s.length?$(s).each(function(n){var i=this;i>it&&(i=it);s[n]=i==1?null:$("<div><\/div>").appendTo(t).addClass("app-form-grid ui-grid-"+String.fromCharCode(97+i-2))}):c>1&&(c>it&&(c=it),fi=$("<div><\/div>").appendTo(t).addClass("app-form-grid ui-grid-"+String.fromCharCode(97+c-2)));f=null;a=fi;$(ni).each(function(n){var i=this;f&&f.text==i.Tab||(f={text:i.Tab,content:[]},s.length&&(a=s[yi++]),rt=0,dt=null,ti.push(f));a&&(f.content.length||f.content.push(a),(rt==0||this.NewColumn)&&rt<it&&(dt=$("<div>").appendTo(a).addClass("ui-block-"+String.fromCharCode(97+rt++))));var y=$('<div class="ui-collapsible-set ui-group-theme-inherit"><\/div>').appendTo(dt||t),b=$('<div class="ui-collapsible ui-collapsible-themed-content ui-first-child ui-last-child"><\/div>').appendTo(y.addClass("app-category-"+i.Id)),k=r._processTemplatedText(l,i.Description),d=r._formatViewText(rh.DefaultCategoryDescriptions[k],!0,k),p,g,o=$('<h3 class="ui-collapsible-heading"/>').appendTo(b),h=$('<a class="ui-collapsible-heading-toggle ui-btn ui-btn-a"/>').appendTo(o).text(i.HeaderText),c=$('<div class="ui-collapsible-content ui-body-a" aria-hidden="false"><\/div>').appendTo(b);$(fv).appendTo(h);$(ev).appendTo(h);a||f.content.push(y);p=$('<ul data-role="listview" data-theme="a" data-inset="false" class="app-formview"/>').appendTo(c);String.isNullOrEmpty(d)||$("<div><\/div>").appendTo($('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(p)).html(d.replace(/\n/g,"<p/>"));$(li).each(function(){var n=this,r=n,o,u,t,f,e;n.CategoryIndex==i.Index&&(n=vt[n.AliasIndex],o=l[r.Index],u=n.text(l[n.Index],!1),yt||g||(g=!0,t=ft(null,w),$('<span class="dv-object-identifier"/>').text(v).appendTo(h).hide(),typeof t=="string"&&(t=[0,t]),t[0]=v,ft(t,w),w.attr("data-locked","true")),f=$('<li class="ui-field-contain"/>').appendTo(p),e=$('<label class="app-static-label"/>').appendTo(f).text(n.HeaderText),r.AllowNulls||e.addClass("app-required"),ii[r.Name]={field:n,originalField:r,item:f,label:e,value:o,originalValue:l[r.Index],text:u,trimmedText:n.trim(u),readers:[],writers:[]})});y.find("ul").listview();h.on("vclick",function(t,i){function f(){o.toggleClass("ui-collapsible-heading-collapsed");s?(c.show(),r.find(".dv-object-identifier").hide().closest(".ui-collapsible").find(".dv-heading").removeClass("app-disabled"),ot(!0),nt(),u.inserting()||pt(n,!1),ct()):(c.hide(),u.inserting()||pt(n,!0),ot(),si(),nt(),ct())}var r=$(this),s=o.is(".ui-collapsible-heading-collapsed");i==!1?f():e(r,f)});(i.Collapsed||pt(n))&&(o.addClass("ui-collapsible-heading-collapsed"),c.hide());i.HeaderText||o.hide().closest(".ui-collapsible").addClass("app-divider")});n.tabs("create",{id:r._id+"_tabset",tabs:ti,className:"app-tabs-form",change:function(n){nt();bf(t);$(n.content).each(function(){this.find("textarea").textinput("refresh")});ot()}});$(s).each(function(n){var i=s[n];i&&i.appendTo(t)});(y=="TopAndBottom"||y=="Bottom")&&$('<div class="app-bar-buttons"/>').appendTo(t);ut=[];u.context(ut);y!="None"&&n.refreshAppButtons(ut,{buttonBars:t.find(".app-bar-buttons"),toolbar:!1});gc(r,t);ui=$('<div class="app-stub"/>').appendTo(t);t.find(".app-echo").length&&ui.height(i.getScreenHeight()*.6);u.stateChanged();u._reset=!1;o.requiresInitCallback?(gt=p.css("display")!="block",gt&&p.css({display:"block","z-index":-10}),si(),ot(),bf(t),y!="None"&&n.refreshAppButtons(ut,{buttonBars:t.find(".app-bar-buttons"),toolbar:!1}),lu(p),gt&&p.css({display:"","z-index":""}),o.requiresInitCallback=!1,b=!1,o.initCallback=ci,n.navigate(o.id)):ci();ou(o)},collect:function(){var t=this,u=[],n,o=t.dataView(),h=o._allFields,s=this.commandRow(),e=t.inserting(),i,r;return s?($(h).each(function(){var h=this,c=$("#"+o._id+" .app-field-"+h.Name+":input"),l;h.OnDemand||(i=s[h.Index],n={Name:h.Name,OldValue:e?null:i,NewValue:i,Modified:e&&i!=null},n.ReadOnly=h.ReadOnly&&!(h.IsPrimaryKey&&e),c.length?(n.NewValue=c.is("select")?c.find("option:selected").data("value"):c.val().trim(),ci||f()||h.Type.match(/^Date/)&&(n.NewValue=h.TimeFmtStr?yc(n.NewValue):wv(n.NewValue)),n.Modified=!0):(l=t._editors[h.Name],l?(n.NewValue=l.value,n.Modified=!0):(r=t._newValues,r&&h.Name in r&&(n.NewValue=r[h.Name],n.Modified=!0))),u.push(n))}),u):u},_readWrite:function(){function w(n,t){$(n).each(function(){t?u.item.children().length==1&&this.appendTo(u.item):this.detach()})}function b(){d=st+"_"+n.Name+"_Input";it.attr("for",d);i.appendTo(v).attr("id",d).addClass(p);n.Len>0&&i.attr("maxlength",n.Len);n.Watermark&&i.attr("placeholder",n.Watermark);ut&&i.attr("data-causes-calculate",ut);ft&&i.attr("data-causes-populate",ft);ot&&i.attr("data-causes-copy",ot)}function pt(t){if(!r||r.match(/^null/))t.text(y.NullValueInForms);else{var e=s.resolveClientUrl(s.get_appRootPath()),u=$('<a rel="external"/>').appendTo(t).attr("href",String.format("{0}blob.ashx?{1}=o|{2}",e,n.OnDemandHandler,h)),i,o=n.Name.toLowerCase();n.OnDemandStyle!=1?($('<img class="app-image-thumb">').appendTo(u).attr({src:String.format("{0}blob.ashx?{1}=t|{2}&_nocrop",e,n.OnDemandHandler,h),title:y.BlobDownloadHint}),$(s._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t==o+"contenttype"||t==o+"content_type")return i=c.commandRow()[n.Index],!1}),$(s._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t=="contenttype"||t=="content_type")return i=c.commandRow()[n.Index],!1}),i||(i="image"),i.match(/^image/i)?u.attr("data-content-type",i):f()&&u.attr("target","_blank")):(u.text(y.BlobDownloadLink).addClass("ui-btn ui-btn-icon-left ui-icon-arrow-d ui-btn-inline ui-mini ui-shadow ui-corner-all").appendTo(t.parent()),f()&&u.attr("target","_blank"),t.remove())}}var c=this,s=c.dataView(),st=s._id,tt=c.editing(),ni=c.inserting(),ht=c._editors,ct,r,h,u,n,e,lt,it,v,bt=c.itemMap(),l,i,d,o,p,dt=c.content(),at=dt.find(".ui-collapsible ul"),a,rt,vt={},yt={},g,ut,ft,ot,gt,wt,nt,k;tt?at.addClass("app-form-editing"):at.removeClass("app-form-editing");$(s._allFields).each(function(){var r=this,n=r.ContextFields,i,t;if(r.Calculated&&n&&$(n.split(/\s*,\s*/)).each(function(){s.findField(this)&&(vt[this]=!0)}),n)for(i=/(\w+)\s*=\s*(\w+)/g,t=i.exec(n);t;)yt[t[2]]=!0,t=i.exec(n)});for(ct in ht)u=ht[ct],n=u.field,e=u.originalField,it=u.label,v=u.item,r=u.value,h=u.text,tt||(h=u.trimmedText),p="app-field-"+n.Name,l=e.ItemsStyle,g=e.Name+"."+s._id+".app",ut=e.CausesCalculate||vt[e.Name]?g:null,ft=yt[e.Name]?g:null,ot=String.isBlank(e.Copy)?null:g,tt&&!e.isReadOnly()?(w(u.readers,!1),u.writers.length?w(u.writers,!0):(String.isNullOrEmpty(l)?n.OnDemand?(o=$('<div class="ui-input-text ui-body-inherit ui-corner-all app-drop-box-input"><\/div>').appendTo(v).addClass(p),pt(o),$app.upload("create",{container:$("<div><\/div>").appendTo(o).addClass("drop-box-"+n.Index),dataViewId:s._id,fieldName:n.Name})):(rt=!1,k=n.Rows>1,i=k?$("<textarea/>"):$('<input type="text" />'),k?(i.attr("rows",n.Rows),(kt||!et||!0)&&i.attr("data-autogrow","false"),ci&&i.css("white-space","pre-wrap")):n.TextMode==1?i.attr("type","password"):n.Type=="String"?re(n)?i.attr("type","tel"):ue(n)?i.attr("type","email"):ol(n)&&i.attr("type","url"):n.Type.match(/^Date/)?(i.addClass("app-input-date"),ci||f()?rt=!0:n.TimeFmtStr?(i.attr("type","datetime-local"),h=vc(r)):(i.attr("type","date"),h=ac(r))):n.Type!="TimeSpan"&&i.data("format",{type:"number",value:r,text:r==null?"":h,field:n}),b(),i.val(r==null?"":h),o=i.textinput({clearBtn:!k,clearBtnText:t.ClearText}),k?o.textinput("refresh"):kt?o.parent().find(".ui-input-clear").attr("tabindex",-1):o.parent().find(".ui-input-clear").remove(),rt&&$(i).attr({"data-input-type":"datepicker","data-format-string":n.DataFormatString}).datepicker()):(lt=n,n=e,p="app-field-"+n.Name,r=u.originalValue,l=="Lookup"||l=="AutoComplete"?(i=$('<input type="hidden"/>').val(r),b(),o=$("<div><\/div>").appendTo(v),i.appendTo(o),gt=$('<input type="text" class="app-lookup-input"/>').insertBefore(i).attr("id",d),wt=$('<a href="#app-lookup" class="ui-btn ui-icon-carat-r ui-btn-icon-right ui-corner-all app-lookup"/>').insertBefore(i).text(h).data("data-context",{field:e,aliasField:lt,value:r,text:h,pageId:st}),kt&&wt.attr("tabindex",-1)):l=="CheckBox"?(i=$('<select data-role="slider"/>'),nt=0,$(di(e,u)).each(function(){var n=this[0],t=this[1],r=$("<option/>").attr("value",n!=null?n.toString():"").data("value",n).text(t).appendTo(i);t.length>nt&&(nt=t.length)}),b(),i.val(r!=null?r.toString():""),o=i.slider(),i.next().css("width",nt+2+"em")):l=="CheckBoxList"||l=="RadioButtonList"||l=="ListBox"?(i=$('<input type="hidden"/>'),b(),i.val(r!=null?r.toString():"").attr("data-field",n.Name),oc(n,i,u),o=i):(i=$("<select/>").addClass("app-lookup"),$(di(e,u)).each(function(){var n=this[0],t=this[1],r=$("<option><\/option>").attr("value",n!=null?n.toString():"").data("value",n).text(t).appendTo(i)}),b(),i.val(r!=null?r.toString():""),o=i.selectmenu().selectmenu("refresh"))),u.item.children().each(function(n){n>0&&u.writers.push($(this))}))):(it.attr("for",""),w(u.writers,!1),u.readers.length?w(u.readers,!0):(o=$('<div class="ui-input-text ui-body-inherit ui-corner-all app-static-text"><\/div>').appendTo(v),fieldText=$("<div><\/div>").appendTo(o).addClass(p),u.readers.push(o),n.Index==bt.heading&&v.addClass("dv-heading"),n.OnDemand?pt(fieldText):(dh(n,h,fieldText),a=null,re(n,!0)&&r?a=$('<a class="ui-btn-right ui-btn ui-icon-phone ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr("href","tel:"+r):ue(n,!0)&&r?a=$('<a class="ui-btn-right ui-btn ui-icon-mail ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr("href","mailto:"+r):ol(n,!0)&&r?a=$('<a class="ui-btn-right ui-btn ui-icon-eye ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr({href:r}):ny(n,!0)&&r?a=$('<a class="ui-btn-right ui-btn ui-icon-location ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr({href:ta(c.commandRow(),oe(s),"q")}):ty(e)&&e.ItemsDataController&&r&&!e.tagged("lookup-details-hidden")&&(a=$('<a href="#app-details" class="ui-btn-right ui-btn ui-icon-carat-r ui-btn-icon-notext ui-shadow ui-corner-all app-btn"/>').appendTo(fieldText).attr("data-field-name",e.Name).attr("data-field-text",n.HeaderText+" - "+s.get_view().Label)),a&&a.attr("title",n.HeaderText+":\n"+r))),w(u.writers,!1))},stateChanged:function(){var n=this,r=n.dataView(),t=n.content(),u=n.editing(),i;n._readWrite();n.calculate(r);u&&(i=t.find(".ui-collapsible:visible .ui-collapsible-heading"),i.filter(":not(.ui-collapsible-heading-collapsed)").length||i.first().find(".ui-btn").trigger("vclick",!1),ho(t),r._raisePopulateDynamicLookups(),t.closest(".ui-page:visible").length&&bf(t));io(t);p()},context:function(n){var t=this,i=t.dataView(),r=t.commandRow(),u=t.editing();gl(i,n,r);u||hs(i,n,r);ee(["Form","ActionBar"],i,n,r)},calculate:function(t){var o=this,i,u,f,r,s;if(typeof t=="string")i=n.dataView(),u=i.findField(t),u&&i._raiseCalculate(u,u);else{i=t;f=n.page(i._id);function e(){r||(r=[],$(i._collectFieldValues()).each(function(){var n=this,t=i.findField(n.Name);t&&(r[t.Index]=n.Modified?n.NewValue:n.OldValue)}))}$(i._expressions).each(function(){var u=this,s,o,t,n;u.Scope==3&&(e(),s=i._evaluateJavaScriptExpressions([u],r,!1),o=f.find(".app-field-"+u.Target),o.length&&(t=o.closest(".ui-field-contain"),s?t.show():t.hide(),n=t.closest("ul").find("> li").removeClass("ui-first-child ui-last-child").filter(":visible"),n.length&&($(n[0]).addClass("ui-first-child"),$(n[n.length-1]).addClass("ui-last-child"))))});$(i._expressions).each(function(){var u=this,o,n,t;u.Scope==2&&(e(),o=i._evaluateJavaScriptExpressions([u],r,!1),n=f.find(".app-category-"+u.Target),n.length&&(o?n.show().removeClass("app-hidden"):n.hide().addClass("app-hidden"),n.closest(".app-form-grid").length&&(t=n.parent(),t.find("> .ui-collapsible-set:not(.app-hidden)").length?t.show().removeClass("app-hidden"):t.hide().addClass("app-hidden"))))});f.find(".app-form-grid").each(function(){var n=$(this),t=n.find("> div:not(.app-hidden)"),i=n.attr("class").replace(/ui-grid-\w+/,"").trim();t.length==0?n.hide():(i+=" ui-grid-"+(t.length==1?"solo":String.fromCharCode(97+t.length-2)),n.attr("class")!=i&&n.attr("class",i),n.css("display",""),t.each(function(n){var i=$(this),t="ui-block-"+String.fromCharCode(97+n);i.attr("class")!=t&&$(this).attr("class",t)}))});$(i._expressions).each(function(){var t=this,u,n;t.Scope==5&&(n=i.findField(t.Target),n&&(n._originalTextMode==null&&(n._originalTextMode=n.TextMode),e(),u=i._evaluateJavaScriptExpressions([t],r,!1),n.isReadOnly()!=u&&(n.TextMode=u?4:n._originalTextMode,s=!0)))});s&&o._readWrite();o._refreshButtons()}},afterPopulateDynamicLookups:function(n){var t=this,i=t.dataView(),r=$("#"+i._id);$(n).each(function(){var o=this,f=t._editors[o.Name],i,n,u,e;f&&(i=f.originalField,u=i.ItemsStyle,n=r.find(".app-field-"+i.Name),u=="DropDownList"?(n=n.next(),e=n.val(),n.empty(),$(di(i)).each(function(){var t=this[0],i=this[1],r=$("<option><\/option>").attr("value",t!=null?t.toString():"").data("value",t).text(i).appendTo(n)}),n.val(e),n.selectmenu("refresh")):(u=="RadioButtonList"||u=="ListBox"||u=="CheckBoxList")&&oc(i,n))})},afterCalculate:function(t){var i=this,r=i.dataView(),u=$("#"+r._id);n.causesCalculate(!1);$(t).each(function(){var e=this,s,t,h,o,l,a,c,n,p,v;"name"in e&&(e.Name=e.name,e.NewValue=e.value);s=i._editors[e.Name];s?(o=s.originalField,c=o.ItemsStyle,t=s.value=e.NewValue,e.NewValue==null?(h=s.text=y.NullValueInForms,s.trimmedText=s.text):(h=s.text=o.format(e.NewValue,!1),s.trimmedText=o.trim(s.text)),n=u.find(".app-field-"+o.Name),n.length&&(n.is("div")?o.htmlEncode()?n.text(s.trimmedText):n.html(s.trimmedText):c=="Lookup"||c=="AutoComplete"?n.val(t!=null?t.toString():"").prev().data("data-context").value=t:c=="CheckBox"?(n.val(t!=null?t.toString():""),n.slider("refresh")):c=="CheckBoxList"||c=="RadioButtonList"||c=="ListBox"?(n.val(t!=null?t.toString():""),$(di(o)).each(function(i){if(this[0]==t){var r=n.prev();return r.find(":input:eq("+i+")").trigger("click"),r.find(":checkbox,:radio").checkboxradio("refresh"),!1}})):c?(n.next().val(t!=null?t.toString():""),n.next().selectmenu("refresh")):(l=n.data("format"),l&&(l.value=t,l.text=t==null?"":h),o.Type.match(/^Date/)&&(ci||f()||(h=o.TimeFmtStr?vc(t):ac(t))),n.is(":focus")&&l?n.val(t==null?"":t):n.val(t==null?"":h)))):(i._newValues||(i._newValues={}),i._newValues[e.Name]=e.NewValue,o=r.findField(e.Name),o&&(a=r.findFieldUnderAlias(o),a!=o&&(n=u.find(".app-field-"+a.Name),n.length&&(p=n.prev(),h=e.NewValue==null?y.NullValueInForms:o.format(e.NewValue,!1),v=p.text(h).data("data-context"),v&&(v.text=h)))))});i._refreshButtons()},_refreshButtons:function(){var n;$(this.dataView()._actionGroups).each(function(){return $(this.Actions).each(function(){if(this._whenClientScript)return n=!0,!1}),n?!1:void 0});n&&p()}};Web.DataView.alert=function(t,i){function s(){r.popupopen()}var o;typeof t!="string"&&(t=t.toString());ps=i;var r=$("#app-popup-alert"),h=a(),f=$("div.ui-popup-active div:first");if(r.length==0){r=$(String.format('<div id="app-popup-alert" class="app-popup app-popup-alert" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" aria-level="1">{0}<\/h1><\/div><div role="main" class="ui-content"><div class="app-popup-text"><\/div><div class="app-popup-buttons"><a href="#" class="ui-btn ui-corner-all ui-mini">{1}<\/a><\/div><\/div><\/div>',n.appName(),tf.Close)).appendTo(u).popup(he());r.find("a").on("vclick",function(){return f.length?(ii=function(){f.popupopen()},ef=ps):ii=ps,e(this,function(){lt(r)}),!1})}o=r.find(".app-popup-text").css("max-height",g.height()*.8-n.toolbar().outerHeight()*2);t=(t||"").replace(/\n/g,"<p/>");t.match(/<\w+/)?o.html(t):o.text(t);f.length?(ii=s,lt(f)):s()};Web.DataView.confirm=function(t,i,r){function h(){f.popupopen()}var s;typeof t!="string"&&(t=t.toString());ws=i;bs=r;var f=$("#app-popup-confirm"),c=a(),o=$("div.ui-popup-active div:first");if(f.length==0){f=$(String.format('<div id="app-popup-confirm" class="app-popup app-popup-confirm" data-role="popup" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" arial-level="1">{0}<\/h1><\/div><div role="main" class="ui-content"><div class="app-popup-text"><\/div><div class="app-popup-buttons"><a href="#" class="app-btn-confirm ui-btn ui-corner-all ui-mini">{1}<\/a><a href="#" class="ui-btn ui-corner-all ui-mini">{2}<\/a><\/div><\/div><\/div>',n.appName(),tf.OkButton,tf.CancelButton)).appendTo(u).popup(he());f.find("a").on("vclick",function(n){var t=$(n.target).is(".app-btn-confirm");return ii=o.length?function(){o.popupopen();ef=t?ws:bs}:t?ws:bs,e(this,function(){lt(f)}),!1})}s=f.find(".app-popup-text");t=(t||"").replace(/\n/g,"<p/>");t.match(/<\w+/)?s.html(t):s.text(t);o.length?(ii=h,lt(o)):h()};$app.showMessage=function(n){n&&this.alert(n)};d=Web.Menu={};d.Nodes={};d.headerIterators=[];d.footerIterators=[];l.$nextTabIndex=l.$closeHovers=function(){};typeof Web.Membership!="undefined"&&(Web.Membership.prototype.initialize=function(){var i=this,r=i.get_authenticationEnabled(),u=i.get_displayMyAccount(),f=i.loggedIn();d.headerIterators.push(function(){var l=$(this),a=i.get_cultures(),u,y,r,s,c;if(!String.isNullOrEmpty(a)&&!(__tf!=4)){var e={value:"Detect,Detect",text:tt.AutoDetectLanguageOption,selected:!1},v=[e];$(a.split(/;/)).each(function(){if(this.length){var n=this.split("|"),t={value:n[0],text:n[1],selected:n[2]=="True"};v.push(t);t.selected&&(e=t)}});y=$("<a/>").text(e.text).appendTo($('<li data-icon="location" data-theme="b"/>').appendTo(l)).on("vclick",function(){return li||o(y),dt=function(){h=[{text:t.Back,icon:"back",callback:function(){n._menuPanel.panel("toggle")}},{text:tt.ChangeLanguageToolTip,instruction:!0}];$(v).each(function(n){var t=this;h.push({text:t.text,icon:n==0?"":t.selected?"check":!1,context:t,callback:function(n){i.changeCulture(n.value)}});n==0&&h.push({})});k(h,"#app-panel-languague",{position:"left"})},bu(!0),!1});u=!0}if(r=this.find(".welcome"),f)s=i.get_welcome(),String.isNullOrEmpty(s)?r.hide():r.html(String.localeFormat(s,i.get_user(),new Date));else if(i._allowLoginInMenu){r.hide();c=$("<a/>").text(tt.LoginLink).appendTo($('<li data-icon="lock" data-theme="b"/>').appendTo(l));c.on("vclick",function(){li||o(c);dt=function(){o();i.showLogin()};bu()});u=!0}return u});f&&(u||r)&&d.footerIterators.push(function(){var n=!1,t;if(u&&$(this).is(".level0")&&!1&&($(String.format("<li>{0}<\/li>",tt.MyAccount)).appendTo(this),n=!0),r){t=$("<a/>").text(tt.LogoutLink).appendTo($('<li data-icon="power" data-theme="b"/>').appendTo(this));t.on("vclick",function(){li||o(t);dt=function(){po();i.logout()};bu()});n=!0}return n})},Web.Membership.prototype.dispose=function(){},Web.Membership.prototype.updated=function(){if(at=this,wo(),this.get_idleTimeout())$(document).on("awake.app",function(){return!at.idle()});this.idleInterval(!0);n&&this.mobileUpdated()},Web.Membership.prototype._idle=function(){nt();var n=this;n.idleInterval(!1);$app.alert(tt.UserIdle,function(){po();n.logout()})},Web.Membership.prototype.loginStatus=function(n){var t=this,i=t.loggedIn(),r=$(n).text(i?tt.LogoutLink:tt.LoginLink).on("vclick",function(){return e(r,function(){i?(po(),t.logout()):t.showLogin()}),!1})},Web.Membership.prototype.mobileUpdated=function(){function i(){b?setTimeout(i,200):n.loggedIn()||t!=a()||n.showLogin()}var n=this,t,r;$(document).on("start.app",function(){n._allowLoginInMenu=n.get_displayLogin();!r&&location.href.match(/(\?|&)ReturnUrl=/)&&n._allowLoginInMenu&&(t=a(),setTimeout(i,1e3))});this.loginStatus('a[data-app-role="loginstatus"]')},Web.Membership.prototype.showLogin=function(){var t=this._loginDialog,r,i;if(!t){this._login_CompletedHandler=Function.createDelegate(this,this._login_Completed);this._method_FailureHandler=Function.createDelegate(this,this._method_Failure);t=this._loginDialog=$(String.format('<div id="app-popup-login" data-role="popup" data-theme="a" data-overlay-theme="a" class="app-popup app-popup-login"><div role="banner" class="ui-header ui-bar-a"><h1 class="ui-title" role="heading" aria-level="1">{6}<\/h1><\/div><div role="main" class="ui-content"><div><label for="UserName">{1} {2}<\/label><\/div><input type="text" id="UserName" placeholder="{3}" autocorrect="off" autocapitalize="off"/><input type="password" id="Password" placeholder="{4}"/>{5}<div class="app-popup-buttons"><a href="#" class="login-button ui-btn ui-corner-all ui-mini">{7}<\/a><\/div><\/div><\/div>',tt.HelpCloseButton,tt.LoginLink,tt.LoginText,tt.UserName.replace(/:/,""),tt.Password.replace(/:/,""),this.get_displayRememberMe()?String.format('<label for="RememberMe"><input type="checkbox" id="RememberMe" />{0}<\/label>',tt.RememberMe):"",n.appName(),tt.LoginButton)).appendTo(u).popup(he());r=this;this._userName=t.find("input:text").textinput().get(0);this._password=t.find("input:password").textinput().get(0);this._rememberMe=t.find("input:checkbox").checkboxradio().get(0);i=t.find("a.login-button").on("vclick",function(){return nt(),e(i,function(){o(i,!1);r.login()}),!1});t.find("input").on("keydown",function(n){if(n.which==13)return nt(),setTimeout(function(){i.trigger("vclick")},200),!1})}t.popupopen()});Web.Mobile=function(){var n=this;n._asyncJob=0;n._pageMap={};n._pages=[];n._toolbar=$("#app-bar-tools");n._actionButton=$(".app-btn-promo");n._toolbarButtons=n._toolbar.find(".app-btn");n._title=n._toolbar.find("h1").addClass("app-hidden");n._headingBar=$("#app-bar-heading");n._menuButton=$("#app-btn-menu");n._contextButton=$("#app-btn-context");n._modalDataViews=[];n._modalStack=[]};Web.Mobile.prototype={settings:function(){return r},appName:function(){var n=this;return n._appName||(n._appName=$("#PageHeaderBar").text()||$('head meta[name="application-name"]').attr("content")),n._appName},height:function(){var n=g.height();return navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/)&&(n+=60),n},page:function(n){n||(n="Main");var t=$("#"+n);return t.length==0&&(t=$(String.format('<div data-role="page" id="{0}"><div data-role="content"/><\/div>',n)).appendTo(u).page(),vo(t),pt(t)),t},activeLink:function(n,t){$(i.activeClickedLink).is(".app-tab-active")||i.removeActiveLinkClass(!0);n&&(n=$(n).closest("a"),n.is(".app-btn-static")||(n.addClass("ui-btn-active"),(t==null||t)&&(i.activeClickedLink=n)))},blink:function(n,t){o(n);setTimeout(function(){o();setTimeout(function(){o(n);setTimeout(function(){o();t&&t()},200)},200)},200)},content:function(n){var t=this.page(n),i=t.find('div[data-role="content"] .app-wrapper:last');return i.length?i:t.find('div[data-role="content"]')},showContextPanel:function(n,t,i){k(n,"#"+t,i)},toggleContextPanel:function(n){this.contextScope()&&(n+="-scope");$(n).panel("toggle")},causesCalculate:function(n){if(arguments.length==0)return bi.length?bi[0]:null;n==!1?(bi.length&&bi.splice(0,1),af=null):bi.push(n)},callAfterCalculate:function(n){ns(n)},pageVar:function(n,t){if(arguments.length==1)return si(n);si(n,t)},userVar:function(n,t){if(arguments.length==1)return c(n);c(n,t)},callWithFeedback:function(n,t){n&&n.length&&e(n,t)},pageHeader:function(t){var i=n.pageInfo(t.id),r=[t.text];t.text2&&(r[1]=t.text2);i&&(i.headerText=r,i.id==a()&&ft(r))},dataView:function(){var n=this.pageInfo();return n?n.dataView:null},prevPageInfo:function(){var t=i.navigate.history.stack,r,u;return t.length>1&&(r=t[t.length-2].pageUrl,r&&(u=n.pageInfo(r))),u},pageInfo:function(n){if(n?n.selector!=null&&n.length!=null&&(n=n.attr("id")||""):n=a(),typeof n=="string")return this._pageMap[n];if(n)this._pageMap[n.id]=n,n.dataView&&n.dataView._id&&(this._pageMap[n.dataView._id]=n),this._pages.push(n);else return null},dataViewUIPage:function(n){return $("#"+n._id)},dataViewUILinks:function(n){return this.dataViewUIPage(n).find('ul[data-role="listview"] li a')},unloading:function(){vi()},refresh:function(n,t,i){p(n,t,i)},listPopup:function(n){w(n)},busyIndicator:function(n){it(n)},stopScrolling:function(n){var t=n.closest(".app-wrapper"),i=t.width(),r=n.outerWidth(!0);t.css("overflow","hidden").css("margin-right",i-r);setTimeout(function(){t.css({overflow:"","margin-right":""})},750)},bar:function(t,i){function c(){u=r.prev();u.is(".app-bar-actions")&&u.is(":visible")?r.css("top",u.offset().top+u.outerHeight()):r.css("top","")}function l(){r.children().each(function(){if($(this).css("display")!="none")return emtpy=!1,!1});!0&&(r.hide(),r.is(".app-bar-footer")&&n.promo().css("margin-bottom",""),a())}function a(){pt(r.closest(".ui-page"))}var r,u,f,e;if(t=="create"){var o=i.type,s=i.page,h=s.is(".ui-page")?s.find(".app-wrapper"):$(s).closest(".app-wrapper");return r=h.find(".app-bar-"+o),r.length||(o=="header"?(r=$('<div class="app-bar-header ui-header ui-bar-inherit ui-header-fixed"><\/div>').hide().insertBefore(h),c()):o=="footer"&&(r=$('<div class="app-bar-footer ui-footer ui-bar-inherit ui-footer-fixed"><\/div>').hide().insertAfter(h))),r}f=i;r=f.parent();t=="show"?(r.is(".app-bar-header")&&c(),r.show(),f.show(),r.is(".app-bar-footer")&&(e=n.promo(),e.length&&e.css("margin-bottom","").css("margin-bottom",gi(e.css("margin-bottom"))+r.outerHeight())),a()):t=="hide"?(f.hide(),l()):t=="remove"&&(f.remove(),l())},promo:function(n,t){function f(){!i.is(".ui-disabled")&&(r.promoteActions||bt())?$(".ui-popup-active").length?i.hide().addClass("app-hidden"):i.show():i.hide()}var i=this._actionButton,u;return arguments.length==0?i:typeof n=="boolean"?(n?f():i.hide(),i):typeof n=="string"?(u=i.data("icon"),u&&i.removeClass("ui-icon-"+u),i.addClass("ui-icon-"+n).data("icon",n).attr("title",t),n.match(ih)?(i.hide().addClass("ui-disabled"),!1):(i.removeClass("ui-disabled"),f(),!0)):void 0},toolbar:function(n){var t=this._toolbar;return typeof n=="boolean"?n?t.show():t.hide():typeof n=="string"&&this._title.text(n),t},search:function(i,r){function s(t){t!=!1&&u.blur();o();n._toolbar.removeClass("app-logo-hidden");ff.show();ht.hide();p()}function a(){if(ff=$(".ui-title,#app-btn-menu,.app-btn-cluster-right").hide(),ht=n._toolbar.find("#app-controls-find"),ht.length==0){ht=$('<div id="app-controls-find" class="app-bar-search"><form><input type="search" id="app-input-search" data-role="search" data-mini="true"/><a href="#" class="app-btn-search-cancel ui-btn-left ui-btn ui-icon-back ui-btn-icon-notext ui-shadow ui-corner-all"/><a class="app-btn-search-more ui-btn ui-btn-right ui-corner-all ui-btn-icon-notext ui-icon-carat-d"/><\/form><\/div>').insertBefore(n._toolbar.find(".ui-title"));ht.find(".app-btn-search-more").attr("title",vt.ShowAdvancedSearch).on("vmousedown",function(t){if(!n.busy()){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,o=u.val();return i.extension().useAdvancedSearch(!0),e(t.target,function(){s();wr(i,o)}),!1}});n._searchInput=u=ht.find("input").textinput({mini:!0,clearBtnText:t.ClearText}).attr("type","text").keydown(function(t){if(t.keyCode==27)return u.blur(),!1;if(t.keyCode==40||t.keyCode==114){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,o=u.val();return i.extension().useAdvancedSearch(!0),e(ht.find(".ui-icon-carat-d"),function(){s();wr(i,o)}),!1}}).focus(function(){n._toolbar.addClass("app-logo-hidden")}).blur(function(){var t=u.data("allow-blur")!=!1;if(!t){u.parent().addClass("ui-focus");return}df(!0);s(!1);setTimeout(function(){var t=n.dataView();t&&t._totalRowCount==-1&&t.sync()},200)});h=$('<span class="app-btn-options app-has-children"/>').appendTo(u.parent()).attr("title",t.QuickFindScope).on("vmousedown",function(){function f(n,t){t.toggleClass("app-checked");i[n]._selected=t.is(".app-checked");var r;$(i).each(function(){if(this._selected)return r=!0,!1});r||(i[n]._selected=!0,t.toggleClass("app-checked"));fe(t)}var o=n.pageInfo(u.attr("data-scope")||i.scope),r=o.dataView,i=[{text:r.get_view().Label,_hint:r._controller+"."+(r._viewId||"grid1"),keepOpen:!0,context:0,callback:f}],s=(r.viewProp("quickFindHint")||"").split(";"),e;return $(n._pages).each(function(){var t=this,n=t.dataView;n&&n._filterSource==r._id&&(i.length==1&&i.push({}),i.push({text:n.get_view()&&n.get_view().Label||t.text,_hint:n._controller+"."+(n._viewId||"grid1")+"."+n._filterFields,keepOpen:!0,context:i.length,callback:f}))}),$(i).each(function(){var n=this;n._selected=s.indexOf(n._hint)!=-1;n._selected&&(n.icon="check",n.linkClassName="app-checked",e=!0)}),e||(i[0]._selected=!0,i[0].icon="check",i[0].linkClassName="app-checked"),u.data("allow-blur",!1),w({anchor:h,highlightAnchor:!1,iconPos:"right",y:h.offset().top+h.outerHeight()*.8,title:t.QuickFindScope,items:i,afteropen:function(){setTimeout(function(){u.parent().addClass("ui-focus")})},afterclose:function(){u.focus();u.data("allow-blur",null);var n=[];$(i).each(function(t){var i=this;i.text&&i._selected&&(t>0&&n.push(";"),n.push(i._hint))});r.viewProp("quickFindHint",n.length==1?null:n.join(""))}}),!1});u.parent().find(".ui-input-clear").on("vmousedown",function(){return pf(u,0),$(this).trigger("click"),!1});ht.find("form").submit(function(){return s(),l(u.val()),!1});var i=ht.find(".ui-icon-back").attr("title",tf.CancelButton).on("vclick",function(){return e(i,function(){s()}),!1})}u.attr("data-scope",r.scope)}function l(t){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,e=i.extension();i._busy()||(du(i),tc(i,t),n.toolbar(n.title()),bo())}var u=$(n._searchInput).attr("data-scope",r.scope),f=r&&r.text,h,c;if(i=="configure")r.focus?(a(),ht.show(),df(!1),r.placeholder&&u.attr("placeholder",r.placeholder),f?(u.val(f),c=u.parent().find("a"),f?c.removeClass("ui-input-clear-hidden"):c.addClass("ui-input-clear-hidden")):u.val(""),u.focus().select(),r.setCursor&&pf(u,u.val().length)):(ff&&ff.show(),ht&&ht.hide(),typeof f!="undefined"&&u.val(f)),u.attr("data-scope",r.scope);else if(i=="execute")l(r.text);else return u.val()},headingBar:function(){return this._headingBar},enumerateFields:function(n,t,i,r){var u=n._allFields,f=i==null;r||(r=n.extension().commandRow());f?(i=[],$(u).each(function(){this.ShowInSummary&&!this.Hidden&&i.push(this)})):t.push({text:n.get_view().Label,theme:"a",isStatic:!1,instruction:!0});$(i).each(function(){var i=u[this.AliasIndex],f=r[i.Index],e=i.text(f);i.OnDemand?i.OnDemandStyle!=1&&f&&!f.match(/^null/)&&t.push({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",n.resolveClientUrl(n.get_appRootPath()),i.OnDemandHandler,f,i.OnDemandStyle==2?"&_nocrop":""),desc:i.HeaderText,display:"before"}):re(i)&&f?t.push({text:e,desc:i.HeaderText,href:"tel:"+e,icon:"phone"}):ue(i)&&f?t.push({text:e,desc:i.HeaderText,href:"mailto:"+e,icon:"mail"}):t.push({text:e,desc:i.HeaderText,isStatic:!0,display:"before"})})},infoView:function(n,i,r){var e=[],s=i?"left":null,o,f,u;for(i||e.push({text:t.Back,callback:kr,icon:"back"});n;)o=n.extension().itemMap(),f=n._allFields,u=[f[o.heading]],$(o.desc).each(function(){u.push(f[this])}),$(n._fields).each(function(){this.Hidden||u.indexOf(f[this.AliasIndex])!=-1||u.push(this)}),this.enumerateFields(n,e,u,r),n=$app.find(n._filterSource);k(e,"#app-panel-info-view"+(s?"-standalone":""),{position:s,className:"app-panel-info-view"})},modalDataView:function(n){var t=this,i,r;n?(i=t.pageInfo(n),r=t.page(n),of&&(i.text=of,of=null),i.dataView._lookupInfo||(r.is("app-modal-page")||r.addClass("app-modal-page app-form-page"),i.dataView._isModal=!0),t._modalDataViews.push(n),t.changePage(n)):($(t._modalStack).each(function(n){var i=this,r=$("#"+i.id),u=i.dataView;u.dispose();r.page("destroy").remove();n=t._modalDataViews.indexOf(i.id);t._modalDataViews.splice(n,1);n=t._pages.indexOf(i);t._pages.splice(n,1)}),t._modalStack=[])},unloadPage:function(n,t){var i=this.pageInfo(n),u;if(i&&(u=this._modalDataViews.indexOf(i.id),u>=0)){var e=i.dataView,o=$app.find(e._parentDataViewId),r=this.pageInfo(t),f=r?this._modalDataViews.indexOf(r.id):-1;(r&&o==r.dataView||t.attr("id")=="Main"||f>=0&&u>f)&&this._modalStack.indexOf(i)==-1&&this._modalStack.push(i)}},desktop:function(){return f()},configureFilter:function(t){n.contextScope(t.scope);dr(t);n.contextScope(null)},busy:function(n){var t=this,i=t._busy==!0;if(arguments.length==1)t._busy=n;else return i?!0:(t._busy=!0,setTimeout(function(){t._busy=!1},900),!1)},executeInContext:function(t,i){var r=[];n.navContext(r);$(r).each(function(){var r=this;if(t&&r.icon==t||!t&&r.text==i)return n.busy()||wt(r),!1})},navigate:function(t){typeof t=="string"?setTimeout(function(){t.match(/^#/)&&(t=t.substring(1));n.changePage(t)},300):t.id&&$("#"+t.id).length?($("#"+t.id).trigger("navigating.app"),n.changePage(t.id)):t.href&&ha(t.href,t.transition)},changePage:function(n,t){var a=i.activePage,v,f=this.pageInfo(n),c=$.Event("navigating.app");if(f&&(f.navigating?f.navigating=!1:($("#"+n).trigger(c),c.isDefaultPrevented()&&(f.initialized=!1,f.navigating=!0))),ot(),vu(!0),this.pageInit(n)){v=this.page(n).css("padding-top",a.css("padding-top"));var l=r.pageTransition,u=this.pageInfo(n),y=u.home?"fade":u.transition||l,p=i.navigate.history,o,e,s,h=u.navigateInfo;if(h){u.navigateInfo=null;i.navigate(h.href,{transition:h.transition});return}e=u.replaceUrl;i.changePage("#"+n,{changeHash:!(t==!1)&&!u.home,transition:y});o=p.stack;s=o[o.length-1];e&&(u.replaceUrl=null,absUrl=i.path.makeUrlAbsolute(e,i.path.documentBase),$("#"+n).attr("data-url",e),i.navigate.navigator.squash(e),s.url=absUrl);u.home&&(s.transition=l)}},title:function(){return title=document.title},navContext:function(i,r){var f=this,e=f.contextPageInfo(),w=e,u=e&&e.dataView,h=u,o=h&&h.extension(),p=u&&u.get_useCase(),s=u&&u.extension(),c=!0,v=-1,y=$.Event("context.app");s&&(r||s&&s.context(i),e.dataView._parentDataViewId&&(e=f.pageInfo(e.dataView._parentDataViewId),u=e.dataView,v--));!o||o.inserting()||o.lookupInfo()||$(f._pages).each(function(){var o=this,e=o.dataView,a=e&&e.extension(),s,h=!1;e&&(s=!e._hidden&&!e._parentDataViewId,s&&(u&&u._filterSource?(s=$app.find(u._filterSource)==e,h=s,s||(s=$app.find(e._filterSource)==u)):s=e._filterSource?$app.find(e._filterSource)==u:!1));!s||p||o.external||(c&&(r||i.push({}),c=!1),h&&!f.contextScope()&&i.push({text:f._masterHeading,desc:o.text,icon:"info",callback:function(){n.infoView(e,sf=="toolbar")},system:!0}),f.contextScope()&&h||e._autoHide==0&&!u.get_selectedRow()||i.push({text:h?t.Back:o.text,icon:h?"back":null,count:h?null:a&&!a._reset?e._totalRowCount:null,callback:h?function(){l.history.go(v)}:function(){f.changePage(o.id)},system:!0,navigateTo:h?"master":"detail",context:o&&o.id,activator:o&&o.activator}))});i.isSideBar||i.isTaskAssistant||(i.length&&i.push({}),ge||(ge={text:t.More,system:!0,callback:function(){a()=="taskassistant"?history.go(-1):gc()}}),i.push(ge),__settings.help&&!l.location.pathname.match(/\/help(\/|$)/)&&at&&(de||(de={text:tt.HelpLink,system:!0,callback:function(){at.help()}}),i.push(de)));y.context=i;$(document).trigger(y)},refreshAppButtons:function(f,e){var tt=this,w=tt._title,kt=w.is(".app-hidden"),dt=w.removeClass("app-hidden").offset().left+w.outerWidth()-1,c,o,b=[],a,s=[],k={search:vt.PerformAdvancedSearch},p,v=[],d=[],et,ot,st,ht,ct,y=n.dataView(),it=0,h,g=tt._contextButton,lt=e&&e.buttonBars||i.activePage.find(".app-bar-buttons"),l=y&&n.content(y._id).prevAll(".app-bar-actions"),rt,at,pt,ut,wt,ft,nt;if(kt&&w.addClass("app-hidden"),(!e||e.toolbar)&&(bt()?g.show().attr("title",vt.HideAdvancedSearch).addClass("ui-icon-carat-u").removeClass("ui-icon-dots"):(g.attr("title",t.More).removeClass("ui-icon-carat-u").addClass("ui-icon-dots"),f.length?g.show():g.hide()),tt._toolbarButtons.each(function(){c=$(this);c.show();c.offset().left>dt&&b.push(c);c.hide()}),a=b.length,a>0)){for($(f).each(function(){var n=this;o=n.icon;showOnToolbar=n.toolbar!=!1&&o!="dots"&&o!="back";o&&(!l||l.length==0||n.uiScope=="ActionBar"&&(o=="plus"||o=="edit")||n.system&&o!="info")&&!vf(o)&&(o=="search"?ct=!0:o=="refresh"?ot=!0:o=="phone"?et=!0:o=="mail"?ht=!0:o=="eye"&&showOnToolbar?st=!0:showOnToolbar&&s.indexOf(o)==-1?s.push(o):o=null,o&&(k[o]=n.text+(n.desc?"\n"+n.desc:"")),n.uiScope=="ActionBar"&&d.push(o))}),ht&&s.push("mail"),et&&s.push("phone"),st&&s.push("eye"),ot&&s.push("refresh"),s.length&&(!y||y.get_isGrid()&&!y.get_isEditing())&&r.promoteActions?(ut=s.indexOf("plus"),ut>0&&(s.splice(ut,1),s.unshift("plus")),p=s[0],n.promo(p,k[p])&&(n.promo().data("icon-list",{icons:s.slice().reverse(),labels:k}),v.push(p),s.splice(0,1))):bt()?yt():n.promo(!1),ct&&(s.length<a?s.push("search"):s[a-1]="search");d.length>0;)o=d[0],d.splice(0,1),s.indexOf(o)!=-1&&s.splice(s.indexOf(o),1);for(s.length<a&&(it=a-s.length),h=0;h<it;h++)$(b[h]).hide();while(h<a)c=$(b[h]),o=s[h-it],wt=c.data("icon"),c.removeClass("ui-icon-"+wt).addClass("ui-icon-"+o).data("icon",o).show(),c.attr("title",k[o]),v.push(o),h++}for(lt.length&&lt.each(function(){var i=$(this),n,e,s,r,o,h;if(i.is(":visible"))if(i.children().remove(),ft)i.append(ft.html());else if(ft=i,nt||(nt=[],$(f).each(function(){var n=this,t=n.icon;!n.system&&t!="dots"&&n.text&&n.uiScope=="Form"&&nt.push(n)})),$(nt).each(function(){var n=this;$('<a href="#app-action" class="ui-btn ui-corner-all ui-mini"/>').text(n.text).appendTo(i)}),r=i.width(),n=i.find(".ui-btn:last"),n.length&&n.position().left+n.outerWidth()>r&&(i.find(".ui-btn").css("min-width","8em"),n.length&&n.position().left+n.outerWidth()>r)){if(i.find(".ui-btn").css("min-width","4em"),n.length&&n.position().left+n.outerWidth()>r)for(e=$('<a href="#app-action" class="ui-btn ui-corner-all ui-mini app-btn-more"/>').html("&nbsp;").attr("title",t.More).appendTo(i);n.length&&e.position().left+e.outerWidth()>r;)n=n.hide().prev();u.is(".app-buttons-text-only")||(o=0,s=i.find(".ui-btn:visible").each(function(){o+=$(this).outerWidth(!0)}),h=Math.ceil((r-o)/(s.length-(e?1:0))),i.find(".ui-btn:visible:not(.app-btn-more)").each(function(){var n=$(this);n.width(n.width()+h)}))}});v.length;)for(h=0;h<f.length;)v.length&&f[h].icon==v[0]?(f.splice(h,1),v.splice(0,1)):h++;(!e||e.toolbar!=!1)&&l&&l.length&&(rt=l.find("h3").next(),at=Math.floor(rt.offset().left)+rt.outerWidth(!0),pt=Math.floor(l.offset().left)+l.outerWidth()-8,fl(y,l.find(".app-bar-controls"),at,pt,!0,p))},endModalState:function(t,r,u){var f=this.pageInfo(t._id),e=this.pageInfo(r._id);f.refreshCallback=function(){history.go(-1)};ai=function(){ot();i.navigate.history.clearForward();n.modalDataView();var r=t.get_parentDataView(),e;r&&(e=n.pageInfo(r._id),e.echoChanged=!0,r.get_isEditing()||(e.initCallback=function(){r.sync()}));u&&(f.echoInitialized!=null&&f.id!=a()?f.echoRefreshCallback=u:u())};it(!0);f.requiresReturnCallback=!0;t.sync()},renderContext:function(n,t,i){var r=!1,u;$(t).each(function(){var s,y,h;if(!i||i(this)){var t=this,o=t.icon,c=vf(o),l=o=="check"||c?"false":o,e=$("<li>").attr({"data-icon":l,"data-theme":t.theme||"a"}).appendTo(n),f,a=!1,v;t.callback||t.dataRel?(f=$('<a href="#"/>').appendTo(e).text(t.text).data("context-action",t),t.count!=null&&$('<span class="ui-li-count"/>').appendTo(f).text(t.count),t.dataRel&&f.attr("data-rel",t.dataRel)):t.href?(e.attr("data-icon",l),f=$('<a href="#" rel="external"/>').appendTo(e).text(t.text).data("context-action",t).attr("href",t.href)):t.isStatic?e.html(t.text):t.src?$('<img class="ui-li-thumb"/>').appendTo(e.addClass("ui-li-has-thumb")).attr({src:t.src}):(r?e.remove():(v=e.attr("data-role","list-divider").html(t.text),!t.isStatic&&t.text&&t.instruction!=!1&&v.addClass("app-list-instruction")),r=!0,a=!0);a||(r=!1);t.desc&&(s=t.display=="before",s&&$('<p class="app-item-desc app-item-desc-before"/>').insertBefore((f?f:e).contents()).text(t.desc),y=$('<p class="app-item-desc"/>').appendTo(f?f:e).text(t.desc),s&&y.addClass("app-item-desc-after"));t.wrap&&e.addClass(t.callback?"app-wrap-text":"app-wrap");c&&(h=$('<span class="glyphicon"> <\/span>').addClass(o),u==null&&(u=n.closest(".app-sidebar, .ui-content.app-page-tasks").length>0),u?h.insertBefore(f.contents()):h.appendTo(f),e.addClass("app-has-glyphicon"));t.disabled&&e.addClass("ui-disabled");t.itemClassName&&e.addClass(t.itemClassName);t.linkClassName&&f.addClass(t.linkClassName);t.keepOpen&&(f.addClass("app-keep-open"),t.animate||f.addClass("app-btn-icon-transparent"));t.animate&&f.addClass("app-animated app-animation-spin");(t.selected||o=="check")&&$(ki).appendTo(f)}})},tabs:function(n,r){function o(){var s=r.tabs,c=r.placeholder||$((s[0].content||[])[0]),n=r.container||$('<div class="app-tabs ui-header ui-bar-inherit"><\/div>').insertBefore(c).addClass(r.className),t=$('<div class="ui-navbar"><\/div>').appendTo(n),l=$("<ul/>").appendTo(t).addClass("ui-grid-"+String.fromCharCode(97+s.length-2)),h=s[0].text,o;$(s).each(function(){if(this.selected)return h=this.text,!1});r.id||(r.id=c.attr("id"),r.id&&(r.id+="_tabs"));r.id&&(n.attr("id",r.id),h=si(r.id)||h);$(s).each(function(n){var t=this,i=$('<a class="ui-btn"/>').appendTo($("<li/>").addClass("ui-block-"+String.fromCharCode(97+n)).appendTo(l)).text(t.text);t.active=t.text==h;t.active&&i.addClass("ui-btn-active app-tab-active")});t.on("vclick",function(h){var c=$(h.target).closest("a"),nt=t.find(".app-tab-active"),a=n.parent(),l=a.find(".app-stub,.app-stub-main"),p=arguments.length!=2?null:arguments[1].selectedTab,b=o||p||c.text(),d=i.activePage,v,y=0,g,k;if(p&&(o=p),c.length)if(!o&&c.is(".app-tab-more"))t.find(".ui-btn").removeClass("ui-btn-active"),e(c,function(){c.addClass("ui-btn-active");k=[];$(r.tabs).each(function(n){var i=this;k.push({text:i.text,icon:i.active?"check":!1,wrap:!0,context:{text:i.text,index:n},linkClassName:"app-btn-icon-transparent",callback:function(n){c.removeClass("ui-btn-active");o=n.text;$(t.find(".ui-btn")[n.index]).trigger("vclick")}})});w({items:k,anchor:c,afterclose:function(){setTimeout(function(){c.removeClass("ui-btn-active");t.find(".app-tab-active").addClass("ui-btn-active")},50)}})});else{if(t.find(".ui-btn").removeClass("app-tab-active ui-btn-active"),c.addClass("app-tab-active ui-btn-active"),$(s).each(function(){var n=this;n.active&&(b==n.text&&(g=!0),$(n.content).each(function(){y+=$(this).outerHeight(!0)}));n.active=n.text==b;n.active&&(v=n)}),g){o=null;return}si(r.id,b);y&&l.length&&l.offset().top+l.outerHeight()-y<a.offset().top+a.height()&&l.height(y+l.outerHeight());lo(d);f(n);o&&(o=null,u(n));v.callback&&v.callback();r.change&&(ui=!1,r.change(v),au(d));lc(a,l)}return!1});n.data("data-tabs",r.tabs);f(n);u(n,!1)}function s(n){n||(n=r.container?r.container.find(".app-tabs"):i.activePage.find(".app-wrapper .app-tabs"));n.find(".ui-navbar").off();n.data("data-tabs",null).remove()}function f(n){n||(n=i.activePage.find(".app-wrapper .app-tabs"));$(n).each(function(){$($(this).data("data-tabs")).each(function(){var n=this;$(n.content).each(function(){n.active?$(this).removeClass("app-tab-hidden"):$(this).addClass("app-tab-hidden")})})})}function u(n,u){n||(n=(r&&r.page||i.activePage).find(".app-tabs"));$(n).each(function(){function a(t){i.attr("class","ui-grid-"+String.fromCharCode(97+n.length-2));t&&(v.width("").show(),i.css("max-width","").width(""),n.removeClass("app-tab-active app-tab-more ui-btn-active ui-last-child"),$(o.removeClass("app-tabs-expanded").data("data-tabs")).each(function(t){var i=this,r=$(n[t]).text(i.text);i.active&&r.addClass("ui-btn-active app-tab-active")}))}var o=$(this),i=o.find("ul"),r,v=i.find("li"),n=i.find(".ui-btn"),e=!0,h=0,s=0,c=!0,l,f;for(a(u!=!1);n.length>2&&e;)if(e=!1,n.each(function(){var n=this,t;n.scrollWidth>n.offsetWidth&&(e=!0,t=n.scrollWidth-n.offsetWidth+gi($(n).css("padding-right")),h+=t)}),e){if(i.parent().width()-i.outerWidth()>h){o.addClass("app-tabs-expanded");f=[];n.each(function(){var n=this,t=$(n),i=t.parent();n.scrollWidth>n.offsetWidth?f.push(n.scrollWidth+gi(t.css("padding-right"))):f.push(i.width());s+=f[f.length-1]});i.css("max-width",s).width(s);n.each(function(n){$(this).parent().width(f[n])});break}c?c=!1:(r=$(n[n.length-1]),l=r.is(".app-tab-active"),r.parent().hide(),n=n.slice(0,n.length-1),a());r=$(n[n.length-1]);r.text(t.More).addClass("app-tab-more ui-last-child");l&&r.addClass("ui-btn-active app-tab-active")}else break})}switch(n){case"create":r.tabs&&r.tabs.length>1&&o(r);break;case"destroy":s();break;case"fit":u()}},refreshMenuStrip:function(){var r=this._menuStrip,s=r&&r.strip,p=this._title,ft=p.is(".app-hidden"),b=p.removeClass("app-hidden").offset().left,k=this._toolbar.find(".app-btn-cluster-right .ui-btn:visible").first(),w=(k.length?k.offset().left:this._toolbar.outerWidth())-10,g=d.nodes,c,y,h,nt,a,u,tt,it,o;if(!s){for(r=this._menuStrip={strip:$('<div class="app-menu-strip"/>').appendTo(this.toolbar())},s=r.strip,c=$("<ul/>"),o=0;o<g.length;o++){var v=g[o],u=$("<li/>").appendTo(c),rt=$('<a class="ui-btn"/>').appendTo(u).text(v.title).attr({title:v.description}).data("data-node",v);v.children&&rt.addClass("app-has-children");v.selected&&rt.addClass("app-selected")}r.links=c.find(".ui-btn");r.items=r.links.parent();r.more=$('<a class="ui-btn app-has-children"/>').appendTo($("<li/>").appendTo(c)).text(t.More);function ut(n){var i=n.url,t;i&&(t=i.match(nf),t?l.open(t[2],t[1]):l.location.href=i)}c.appendTo(s).on("vclick contextmenu",function(t){var u=$(t.target).closest(".ui-btn"),o=u.is(".app-selected"),r=u.data("data-node"),h=r&&r.url&&!r.children;if(u.length==0)return!1;if(h){if(t.type=="contextmenu")return!1;r.url&&!r.url.match(nf)&&vi()}return e(u,function(){if(h)ut(r);else{o||u.addClass("app-selected");var t=$('<div class="app-popup app-popup-listview app-popup-menu" data-theme="a"/>'),e=$('<div class="ui-panel-inner"/>').appendTo($('<div class="ui-content"/>').appendTo(t)),a=$('<ul class="app-listview"/>').appendTo(e),c,v,l,y=1;function p(n,t){if(n.title){var i=$('<li data-icon="false"/>').addClass("app-depth"+t).appendTo(a),r=$("<a/>").appendTo(i).text(n.title).attr("title",n.description).data("data-context",n);n.selected&&(v=r)}$(n.children).each(function(){p(this,t+1)})}r||(y=0,r={children:[]},s.find("li:hidden a").each(function(){r.children.push($(this).data("data-node"))}));p(r,y);v&&$(ki).appendTo(v).parent().addClass("app-selected").parent().attr("data-icon","false");a.listview().on("vclick",function(i){var r=$(i.target).closest(".ui-btn"),u=r.data("data-context");return gt(r)&&u&&u.url&&n.callWithFeedback(r,function(){c=u;lt(t)}),!1});n.promo(!1).addClass("app-hidden");t.popup({history:!f(),transition:no(),tolerance:3,arrow:"t,l,r,b",overlayTheme:"b",positionTo:u,beforeposition:function(){var u=i.getScreenHeight(),o=n.toolbar().outerHeight(),s=t.outerHeight(!0),r;s>=u-o&&(e.css("height",u-o*2.25),f()&&(r=e.width()+20,e.css({width:r}),t.css({minWidth:r,maxWidth:"auto"})))},afteropen:function(){as(null,t);f()&&e.focus()},afterclose:function(){o||u.removeClass("app-selected");c&&c.url&&!c.url.match(nf)&&vi();setTimeout(function(){ua(a);rr(t);e.off();c&&ut(c)},100)}});gf(t);kc(t);t.popupopen().closest(".ui-popup-container").css("marginTop",gi(u.css("fontSize"))*2/3);l=e.find(".ui-btn.app-selected").parent();l.length&&l.position().top+l.outerHeight()-1>e.outerHeight()&&e.scrollTop(l.position().top-(e.outerHeight()-l.outerHeight())/2)}}),!1})}if(ft&&p.addClass("app-hidden"),a=w-b,a!=s.data("tested-width")||!s.is(":visible"))if(s.data("tested-width",a),a>=50&&s.attr("data-enabled")!="false")for(hu(!0),s.width(a).css({left:b}),y=r.items,h=r.more.removeClass("app-selected").parent(),h.hide(),y.show(),o=y.length-1;o>=0;o--){if(u=$(y[o]),it=u.outerWidth(),tt=u.offset().left,tt+it-1>=w&&(h.show(),nt=h.outerWidth(),u.hide()),u.is(":hidden")&&u.find(".app-selected").length&&r.more.addClass("app-selected"),!h.is(":visible")||h.offset().left+nt-1<w){o<=1&&!u.is(":visible")&&hu(!1);break}else u.hide(),u.find(".app-selected").length&&r.more.addClass("app-selected");if(o<=1){hu(!1);break}}else hu(!1)},refreshSideBar:function(i,r){function it(){(l=!1,f.dataView().get_showViewSelector())&&(fc(r),f.tagged("view-style-grid-disabled")||r.push({text:t.Grid,icon:"grid",selected:w,callback:function(){w||cu(e,"Grid")}}),f.tagged("view-style-list-disabled")||r.push({text:t.List,icon:"bullets",selected:k,callback:function(){k||cu(e,"List")}}),f.tagged("view-style-cards-disabled")||r.push({text:t.Cards,icon:"cards",selected:b,callback:function(){b||cu(e,"Cards")}}),f.tagged("supports-view-style-map")&&!f.tagged("view-style-map-disabled")&&r.push({text:t.Map,icon:"location",selected:d,callback:function(){d||cu(e,"Map")}}),n.presenter("enumerate",{id:e,list:g}),$(g).each(function(){var n=this;f.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.name==s&&(n.selected=!0),r.push(n))}),fc(r))}var rt=this,ut=ne().find(".ui-panel-inner"),a=n.pageInfo(),u=a&&a.dataView,v=u,e=u&&u._id,o=u&&u.get_parentDataView(u),h=[],y=u&&n.content(u._id).prev().is(".app-bar-actions"),c=$('.TaskBox.About .Inner .Value, head meta[name="description"]'),p=o&&!o._parentDataViewId,l=u&&u.get_isGrid(),f=u&&u.extension(),s=l&&f.viewStyle(),w=s=="Grid",b=s=="Cards",k=s=="List",d=s=="Map",g=[],ft={items:r},nt=[],tt=["back","check","info"];if(p){for(u=o;u;)u.get_showInSummary()&&!u.get_isInserting()&&u.extension().commandRow()&&h.unshift(u),u=$app.find(u._filterSource);$(h).each(function(){n.enumerateFields(this,r)});r.length&&(u=h[h.length-1],r.push({text:u.get_view().Label,icon:"info",callback:function(){n.infoView(u,!0)}}),r.push({}))}y&&v&&(v.extension().context(nt,["ActionBar"]),$(nt).each(function(){var t=this,n=t.icon;t.uiScope=="ActionBar"&&n&&n!="dots"&&n!="carat-r"&&tt.push(n)}));$(i).each(function(){var n=this;tt.indexOf(n.icon)!=-1||n.system&&n.toolbar==!1||n.command=="Select"||n.icon=="eye"&&(!o||o.get_showInSummary())||(n.text||r.length)&&(n.navigateTo&&l&&it(),n.theme=null,n.uiScope=="ActionBar"&&y||r.push(n))});l&&it();c.length&&p!=!1&&(r.length&&r[r.length-1].text&&r.push({}),r.push({text:c.is("meta")?c.attr("content"):c.html(),isStatic:!0,wrap:!0}))},contextPageInfo:function(){return n.pageInfo(this._contextScope)},refreshContext:function(){p()},contextScope:function(n){if(arguments.length==0)return this._contextScope;this._contextScope=n},contextDataView:function(){var n=this.contextPageInfo();return n?n.dataView:null},showContextMenu:function(t){var i="#app-panel-context";t&&(this.contextScope(t.scope),t.scope&&(i+="-scope",t.position="left"));sl(i,function(){n.refreshContextMenu(i)},t).panel("toggle")},refreshContextMenu:function(n,i){var o=this,r=$(n),f=r.find("ul"),a=f.outerHeight(),h,c,e=r.is(".app-sidebar"),s,l;if(e&&!r.is(":visible")){i=[];o.navContext(i);o.refreshAppButtons(i);return}for(e&&(c=$("<div><\/div>").appendTo(u).css({"z-index":2e3,position:"absolute",left:0,top:r.css("top"),width:r.outerWidth(),height:g.height(),"background-color":"#fff"})),a&&(h=$("<div><\/div>").height(a).insertAfter(f)),ur(f),f.find("a").data("context-action",null),f.find("li").remove(),i||(i=[],i.isSideBar=e,o.navContext(i)),e&&(o.refreshAppButtons(i),l=[],this.refreshSideBar(i,l),i=l),s=$.Event(e?"sidebar.app":"contextmenu.app"),s.context=i,s.panel=r,$(document).trigger(s);i.length&&!i[i.length-1].text&&!i[i.length-1].src;)i.splice(i.length-1);i.length||e||i.push({text:t.EmptyContext});this.renderContext(f,i);f.listview("refresh");e&&f.find("a.ui-btn-icon-right").removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left");f.find("li.app-wrap").addClass("ui-li-static ui-body-a").find("a").attr({"class":""});r.is(".app-reset-scrolling")?r.find(".ui-panel-inner").scrollTop(0):kv(r);h&&h.remove();c&&c.remove()},masterDetailStatus:function(n){var u=this.pageInfo(n),t,i;if(u!=null&&(t=u.dataView,t&&t._filterSource&&(i=$app.find(t._filterSource),i))){var f=i.extension(),e=f.itemMap(),s=i._allFields,o=f.commandRow(),r;e&&o&&(r=s[e.heading],v=o[r.Index],v=r.text(v),this._masterHeading=v)}},focus:function(t,r){var l=this,e=i.activePage,u=e.find(".app-field-"+t),s,f=$(".app-popup-message"),h=e.find(".app-tabs-form"),o,c;f.length||u.length&&(s=u.closest("li"),u.attr("type")=="hidden"&&(u=s.find('input[type="text"]')),h.length&&(o=n.dataView(),c=o.findField(t),$(o._categories).each(function(){var n=this;if(n.Index==c.CategoryIndex)return h.find(".ui-btn").each(function(){var t=$(this);if(n.Tab==t.text())return t.is(".ui-btn-active")||t.trigger("vclick"),!1}),!1})),ho(e,u,function(){f=$('<div class="ui-content app-popup-message"/>').html(r).popup({history:!1,arrow:"t,b",overlayTheme:"b",positionTo:u,afteropen:function(){},afterclose:function(){rr(f);u.focus()}}).popupopen().on("vclick",function(){return lt(f),!1})}))},showLookup:function(n){var l=this.pageInfo(),o=l.dataView,t=n.field,s=t._dataView,h=s.get_contextFilter(t,s.extension().collect()),i,r,f,e=n.query,c=n.aliasField.HeaderText;this.modalDataView();i=n.field.ItemsDataController.toLowerCase();$find(i)&&(i+=Sys.Application.getComponents().length);e&&si(i+"_"+(si(i+"_viewId")||t.ItemsDataView||"grid1")+"_filter",[String.format("_quickfind_:~%js%{0}",Sys.Serialization.JavaScriptSerializer.serialize(e))]);r=$create(Web.DataView,{id:i,baseUrl:o.get_baseUrl(),servicePath:o.get_servicePath(),controller:t.ItemsDataController,viewId:t.ItemsDataView,externalFilter:s.get_contextFilter(t,h),externalFilter:h,filterSource:h.length>0?"Context":null,showSearchBar:!0,showFirstLetters:t.ItemsLetters,searchOnStart:t.SearchOnStart,description:t.ItemsDescription},null,null,$("<div>").hide().appendTo(u).attr("id",i+"Placeholder")[0]);f=this.pageInfo(r._id);e&&r.viewProp("quickFind",e);f.headerText=n.value?[n.text,c]:c;f.resolved=!0;r._lookupInfo=n;n.value==null||t.ItemsValueSyncDisabled||(r._syncKey=[n.value],r._selectedKey=[n.value]);r._parentDataViewId=o._id;this.modalDataView(f.id)},pageInit:function(n,t){var i=this.pageInfo(n),r,u;return i==null?!1:(r=i.dataView,u=i.initialized||!i.dataView&&i.initialized!=!1,r&&r._busy())?!1:(i.initialized||(i.initialized=!0,r&&(i.requiresInitCallback=!0,t!=!1&&it(!0),i.refreshed==!1?(i.refreshed=!0,r.extension().refresh()):r._loadPage())),u)},pageShow:function(n){var t;if(i.activePage&&(i.activePage.find("[data-role='navbar'] a.app-tab-active").addClass("ui-btn-active"),t=this.pageInfo(n),t!=null)){var r=t.dataView,u=r?r.extension():null,f=this._modalStack.indexOf(t);f>=0&&this._modalStack.splice(f,1);t.initialized||(t.initialized=!0,r&&r._loadPage());u&&u._reset&&u.refresh()}},screen:function(){var n=i.window.scrollTop(),t=this.toolbar().outerHeight(),r=i.getScreenHeight();return{top:n+t,bottom:n+i.getScreenHeight(),height:r-t,width:g.width()}},callWhenVisible:function(n,t){i.activePage.find(n).each(function(){var n=$(this),i=n.offset().top,u=i+n.outerHeight(),e=n.closest(".app-wrapper"),r=e.offset().top,f=r+e.height()-1;(r<=i&&i<=f||r<=u&&u<=f||i<=r&&f<=u)&&t(n)})},asyncJob:function(){return this._asyncJob},nextAsycJob:function(){return++this._asyncJob},supports:function(n){switch(n){case"Map":return this._supportsMap==!0}return!1},registerAPI:function(n){var t=this,i="https://maps.googleapis.com/maps/api/js?&v=3.exp&sensor=false&callback=appFactoryCallback";r.mapApiIdentifier&&!l.location.host.match(/^localhost\b/)&&(i+="&"+r.mapApiIdentifier);n!="Map"||t._mapApiRegistered||(t._mapApiRegistered=!0,l.appFactoryCallback=function(){l.appFactoryCallback=null;t._supportsMap=!0;$(document).trigger($.Event("appmapinit"))},$('<script type="text/javascript"/>').attr("src",i).appendTo(u))},fetchOnDemand:function(){function n(n){n.trigger("vclick")}return ui||(this.callWhenVisible(".dv-load-at-bottom",n),this.callWhenVisible(".dv-load-at-top",n)),this},headingOnDemand:function(n){var l=this,t=i.activePage.find(".dv-heading"),f=t.attr("data-selector"),e=f?i.activePage.find(f):t.find(".app-static-text"),r=l.headingBar(),o,h,a=!0,u,p;if(!b&&(e.length||f))if(n===!1)u=r.find(".app-grid-header"),u.length?u.is(".app-disabled")||r.slideUp("fast",function(){p=u.parent();u.detach();p.empty();u.appendTo(p);r.slideDown("fast");u.addClass("app-disabled");u=t.find(".app-grid-header").detach();t.empty();u.appendTo(t)}):(t.addClass("app-disabled"),r.slideUp("fast")),a=!1;else if(!t.is(".app-disabled")&&!s){var d=l.screen(),g=Math.ceil(e.length?e.offset().top+(f?1:0):-1),w,v,c,y,k=0;g<d.top&&(f||e.height()>0)&&(r.is(":visible")?a=!1:(i.activePage.find(".ui-content").children().each(function(){var n=$(this);n.is(".app-tabs,.app-bar-actions,.app-bar-header")&&n.css("display")!="none"&&(k+=n.outerHeight())}),o=r.css("top",l.toolbar().outerHeight()+k-1).find(".app-bar-text"),f?(y=t.html(),y!=o.data("html")&&o.data("html",y).html(y).css("white-space","normal"),w=t.prev().find(".app-yardstick").attr("data-yardstick-class"),w&&o.find(".app-grid-header").attr("class","app-grid-header "+w)):(v=e.text(),v!=o.data("text")&&o.data("text",v).text(v).css("white-space","")),c=e.closest("li").find("label:first").text(),h=r.find(".app-bar-label"),c!=h.data("label")&&(c?h.text(c).show():h.hide(),h.data("label",c)),a=!1,r.show()))}return a&&r.hide(),l},wait:function(){},start:function(t){function g(n){return $(n).each(function(){return this.url&&this.url.toLowerCase()==location.pathname.toLowerCase()?(h=this,!1):this.children&&(g(this.children),h)?(this.selected=!0,!1):void 0}),null}function tt(){var n=t&&$(t.selector).data("scripts");n&&eval(n);$(document).trigger($.Event("start.app"));n||setInterval(function(){bi.length&&!af&&(af=bi[0],$(document).trigger($.Event("calculate.app"),af))},300)}function it(){n.tabs("create",{tabs:v,className:"app-tabs-echo",change:function(){ct()}})}var k,h;if(t||this._appLoaded&&this._pageCreated){d.nodes||gy();i.ignoreContentEnabled=!0;var f=n.pageMenu(t&&t.pageId),w=0,s,b=$(t&&t.selector||"#PageContent"),e=b.attr("data-href"),p=b.find('div[data-app-role="page"]').each(function(i){var r=$(this),c=r.find('> div[data-role="content"]'),s=r.attr("data-content-framework");s&&r.attr("data-enhance","false");c.length||(c=$('<div data-role="content"><\/div>'),r.contents().appendTo(c),c.appendTo(r));r.attr({"data-role":"page","data-app-role":null}).addClass("app-page-scrollable").appendTo(u);var v=$app.eval(r.attr("data-page-header")),h=el(r),o={text:(v!="false"?v:"")||h.text||n.title(),description:h.description,activator:h,url:e,transition:t&&t.transition},l=r.attr("id")||ah(e||location.pathname)+(i>0||e?i+1:"")||"_root",y,a;o.headerText=o.text;r.find('div[data-role="content"]').contents().wrapAll('<div class="app-page-content'+(s?" app-content-framework app-"+s:"")+'"/>');r.page();r.attr("id",l);o.id=l;n.pageInfo(o);a=vo(r,!1).find(".app-page-content");s&&(r.attr("data-page-header","false"),$app.configureFramework(s,a,function(n){eu=n}));a.find(".carousel").on("swipeleft swiperight",function(n){$(n.target).closest(".carousel").find((n.type=="swipeleft"?".right":".left")+".carousel-control").trigger("click")});h.text&&(w++,y=$('<a class="app-action-navigate" />').attr("href","#"+l).text(h.text).appendTo($("<li/>").appendTo(f)),o.description&&$("<p/>").appendTo(y).text(o.description));so(r)});p.length&&(s=p.first(),w==0&&s.attr("data-activator")!="false"&&$('<a class="app-action-navigate" />').attr("href","#"+s.attr("id")).text(s.attr("data-page-header")||uh.SeeAlso).appendTo($("<li/>").appendTo(f)),f.is(".ui-listview")&&f.listview().listview("refresh"));k=d.nodes;t||g(k);h&&!p.length&&f.find("a").length==0&&$(h.children).each(function(){$('<a rel="external"/>').attr("href",this.url).appendTo($("<li/>").appendTo(f)).text(this.title)});var rt=this,o=t?n.page(t.pageId):i.activePage,c=o.find("a.app-action-navigate"),ut=location.href.match(/#(.+)$/),a,v=[],y,nt=this._pages[0];c.length==1&&(r.initialListMode=="SeeAll"||!nt.dataView||nt.dataView.get_lastCommandName()||l.location.href.match(/_controller=.+_commandName=.+/))?$(this._pages).each(function(){var n=this,t=n.dataView;return lh=t&&t._id,(!e||n.url==e&&!n.root)&&(!t||!t._hidden)?(e||(n.home=!0,e=i.path.documentBase.pathname),tt(),i.navigate.history.clearForward(),e&&(n.replaceUrl=e),fu==null&&(fu=!0,setTimeout(function(){fu=!1},1e3)),rt.changePage(n.id),!1):void 0}):o.attr("id")=="Main"&&(c.length&&o.find('a[rel="external"]').parent().remove(),c.show(),vo(o),o.addClass("app-page-scrollable"),ft(document.title),a=o.find(".app-wrapper"),$(c).each(function(){var u=$(this),f=u.attr("href"),r=f&&n.pageInfo(f.substring(1)),i,e,t;r&&r.dataView&&r.activator.type!="Button"&&(t=r.activator,t&&t.type=="Tab"&&($(v).each(function(){if(this.text==t.text)return i=this,!1}),i||(y!=t.container&&(y&&(it(),v=[]),y=t.container),i={text:t.text,content:[]},v.push(i))),e=il(r.id,a),i&&i.content.push(e),u.parent().remove())}),y&&it(),f=n.pageMenu(),f.find('a.app-action-navigate,a[rel="external"]').length?f.listview().show():f.remove(),pt(),a.find(".app-tabs").length>1&&$('<div class="app-stub-main"/>').appendTo(a),tt(),ct(),n.content().focus(),wc())}},pageMenu:function(n){var r=this,i=this.content(n),t=i.find("ul.app-page-menu");return t.length||(t=$('<ul data-role="listview" data-inset="false" class="app-page-menu"/>').appendTo(i).hide().on("vclick",function(n){var t=$(n.target),i,u;return t.is("a")||(t=t.closest("a")),t.length&&(i=t.attr("href"),u=i.match(/^#/),u||vi(),e(t,function(){u?r.changePage(i.substring(1)):(o(t,!1),l.location.href=i)})),!1})),t},initialize:function(){function c(){var n=vr(),t;if(n-e>2500){if(t=$.Event("awake.app"),$(document).trigger(t),t.isDefaultPrevented())return;n=vr()}e=n;setTimeout(c,1250)}var l=this,e=vr(),t=i.path.parseUrl(location.href),r=t&&t.hash,u,h=$("head");yv();r&&(r.match(/\W/)||!$(r).length)&&(i.navigate.history.initialDst="",u=i.navigate.history.stack[0],u.url=t.hrefNoHash,u.hash="");et?$('<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black'+(gu>=8?"-translucent":"")+'"/><link rel="apple-touch-icon" href="../touch/logo-icon.png"/>').appendTo(h):hr&&$('<meta name="mobile-web-app-capable" content="yes"/><link rel="icon" sizes="196x196" href="../touch/logo-icon.png"/>').appendTo(h);setTimeout(c,10);__settings.appInfo.match(/\|$/)||$("#app-welcome").remove();$(document).on("change",":input",function(n){var t=$(n.target),i=t.attr("data-passive-value");(i==null||i!=t.val())&&wf(t);i!=null&&t.attr("data-passive-value",null)}).on("keydown",":input",function(n){var t=$(n.target),i=t.attr("data-causes-calculate");i&&(lf==null&&(lf=t.val()),go(),cf=setTimeout(function(){lf!=t.val()&&(t.attr("data-passive-value",t.val()),wf(t));go(!0)},4e3))}).on("focus",":input",function(t){var i=$(t.target),h=i.parent(),r=i.data("format"),e,u;i.is("#app-input-search")||(s=i,o(),i.is(".app-lookup-input")&&i.next().addClass("ui-focus"),ot(),r&&(e=i.val(),e&&r.type=="number"&&(i.val(r.value),u=i.val().length,i.get(0).setSelectionRange(u,u)),et?setTimeout(function(){i.attr("type",r.type)},200):i.attr("type",r.type)),f()||(pf(s),clearTimeout(fh),n.toolbar().css("position","absolute"),$(".app-sidebar").css("position","absolute")))}).on("blur",":input",function(t){var r,e,u,o=$(t.target),i=o.data("format");(go(!0),s)&&(s.is(".app-lookup-input")&&(e=s.data("link-text"),r=s.data("link-text",null).next().removeClass("ui-focus"),e&&(r.toggleClass("ui-icon-carat-r ui-icon-search").removeClass("app-transparent"),setTimeout(function(){r.data("link-text")&&r.text(e)},2500)),u=s.val().trim(),u&&(r.text(u).data("data-context").query=u),s.val("")),s=null,i&&(i.value=o.val(),i.value=i.value?parseFloat(i.value):null,i.text=i.value==null?"":i.field.text(i.value,!1),o.attr("type","text").val(i.text)),f()||(fh=setTimeout(function(){s||(n.toolbar().css("position",""),$(".app-sidebar").css("position",""))},1e3)))}).on("touchstart","a.app-lookup",function(){if(s){var n=s.val().trim();n&&s.next().text(n).removeClass("app-transparent")}}).on("touchend","a.app-lookup",function(){nt()}).on("keydown",function(n){var i=n.which,r,t;if(i==13&&!$(n.target).is("textarea")){if(s)return s.is(".app-lookup-input")?(r=s.val().trim(),(r.length||kt)&&(s.next().data("data-context").query=r,s.next().trigger("vclick"))):bt()?setTimeout(function(){s&&s.blur();wu(!0)},200):setTimeout(function(){s&&s.blur()},200),!1;bt()&&(t=$(".ui-popup-active"),t.length?t.find(".ui-listview .ui-btn").length||$(".ui-popup-active .ui-popup").popup("close"):wu(!0))}if(!s&&(i==13||i==32||i==27)&&(t=$(".ui-popup-active .app-popup"),t.length)){if(t.is(".app-popup-alert"))return t.find(".ui-btn").trigger("vclick"),!1;if(t.is(".app-popup-confirm")&&i!=32)return t.find(i==13?".app-btn-confirm":".ui-btn:not(.app-btn-confirm)").trigger("vclick"),!1}}).on("keyup",".app-lookup-input",function(n){var t=$(n.target),i=t.next();t.data("link-text")||setTimeout(function(){t.val()!=""&&(t.data("link-text",i.text()),i.html("&nbsp;").toggleClass("ui-icon-carat-r ui-icon-search app-transparent"))},10)})},presenter:function(t,i){function u(){r[i.name]=i}function f(n){cu(n.id,n.name)}function e(){var n=r[typeof i=="string"?i:i.name];return n&&(typeof i=="string"||n.supports($app.find(i.id),i.config))}function o(){var f=$app.find(i.id),o=f.extension(),e=i.container.is(".app-echo-inner"),t=ls(),u;if(e||f==n.dataView()){if(t=r[i.name],e&&t.echo&&!t.echo())return!1;e||(gh(i.container,o),yi(i.container),eo(i.container,o));u=$(i.container).find('div[data-presenter="'+t.name+'"][data-scope="'+f._viewId+'"]');u.length||(u=$('<div data-role="presenter" class="app-presenter"><\/div>').appendTo(i.container).attr({"data-presenter":t.name,"data-scope":f._viewId}));u.show();i.container=u;t.show(i)}else br(i.id+"_echo");return!0}function s(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),u=n.attr("data-presenter"),t=r[u];t&&(i.container=n,t.hide(i),n.hide())})}function h(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),u=n.attr("data-presenter"),t=r[u];t&&(i.container=n,t.dispose(i),n.remove())})}function c(){var u=$app.find(i.id),e=sv(),t,n;for(t in r)n=r[t],n.supports(u)&&(!e||!n.echo||n.echo())&&i.list.push({name:t,text:n.text(),icon:n.icon(),context:{id:u._id,name:t},callback:f})}function l(){return r[i.name]}var r=n._presenters;switch(t){case"supports":return e();case"enumerate":c();break;case"register":u();break;case"show":return o();case"hide":s();break;case"dispose":h();break;case"find":return l()}}},function(){var w,r,h,b,c,l;$.event.special.swipe.scrollSupressionThreshold=100;var k=/\b_touch_(\w+)=(\w+)\b/g.exec(location.href),a=i.focusPage;i.focusPage=function(n){a(n);pt(n);au(n)};i.resetActivePageHeight=function(t){var r=$("."+i.activePageClass);typeof t=="number"&&t--;t=t||i.getScreenHeight();t-=n.toolbar().outerHeight(!0);r.css("min-height",t)};u=$("body");kt&&u.addClass("app-desktop");ci&&navigator.maxTouchPoints>0&&(u.addClass("app-ms-tablet").removeClass("app-desktop"),nh="touch");$("#aspnetForm").hide();var f=$('<div id="app-bar-tools" data-role="header" data-position="fixed" data-theme="a" class="app-bar-tools"/>"').appendTo(u),v=$('<div data-role="page" id="Main"/>').appendTo(u),s='<a href="#" class="ui-btn-right app-btn ui-btn ui-btn-icon-notext ui-shadow ui-corner-all"/>',d=$('<a class="ui-btn ui-btn-a ui-btn-icon-notext app-btn-promo"/>').hide().appendTo(u).on("vclick",sa),y;$('<div data-role="content" class="app-content-main"/>"').appendTo(v);y=$('<a data-role="button" href="#" id="app-btn-menu" class="ui-btn ui-btn-icon-notext ui-shadow ui-corner-all ui-icon-bars app-animation-spin">Site Map<\/a>').appendTo(f);w=$('<h1 class="ui-title"/>').appendTo(f);r=$('<div class="app-btn-cluster-right"/>').appendTo(f);$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$(s).appendTo(r);$('<a href="#" id="app-btn-context" data-icon="dots" data-iconpos="notext" data-role="button" class="ui-btn-right app-btn-context"/>').appendTo(r).attr("title",t.More).hide();h=$('<div id="app-bar-heading" class="app-bar-heading ui-overlay-shadow"><div class="app-bar-label"><\/div><div class="app-bar-text"><\/div><\/div>').appendTo(u).hide().on("vclick",function(n){if(!$(n.target).closest(".app-grid-header").length&&!h.find(".app-filter").length)return ni(!1),p(),!1});b=f.find(".app-btn").data("icon","gear").on("vclick",sa);f.toolbar();c=$('<div id="app-sidebar" class="ui-panel ui-panel-fixed ui-body-a app-sidebar"><div class="ui-panel-inner"><ul/><\/div><\/div>').appendTo(u);l=c.find("ul");l.listview().on("vclick",function(t){if(lr||!gt(t.target))return!1;nt();var i=$(t.target).closest("a"),r=i.data("context-action");if(i.length){if(r)return n.busy()||e(i,function(){wt(r)}),!1;o(i,!1)}})}();n=$app.touch=$app.mobile=new Web.Mobile;n.activeLinkBlacklist=".ui-slider-handle";n._presenters={};u.on("pagebeforeload",function(n,t){n.preventDefault();setTimeout(function(){location.replace(t.toPage)},200)}).on("pagecontainershow",function(){function i(){ai&&(ai(),ai=null,t&&t.returnCallback&&(t.returnCallback(),t.returnCallback=null))}vu(!1);wc();ni();hi(100);setTimeout(function(){ct();oo()},200);p();var t=n.pageInfo();t?t.initCallback?(t.initCallback(),t.initCallback=null):i():te()&&i()}).on("pagecontainercreate",function(){n._shown||setTimeout(function(){n.start();n._shown=!0},100)}).on("pagecontainerbeforeshow",function(t,r){var e=i.activePage,f=n.pageInfo();n.toolbar(n.title());u.is(".app-page-header-hidden")?ft(!1):ft(f&&f.headerText||f&&f.dataView&&f.dataView.get_view().Label||document.title);n.pageShow(a());n.unloadPage(r.prevPage,e);wo();n.contextScope(null)}).on("pagecontainerbeforehide",function(t,i){if(b=!0,i.nextPage){var r=n.pageInfo(i.nextPage.attr("id"));r&&n.masterDetailStatus(r.id)}}).on("pagecontainerbeforetransition",function(){n.promo(!1);lo(i.activePage)}).on("pagecontainertransition",function(){r&&(vu(!1),pt(),r.pageTransition=="none"&&au(i.activePage),kt&&$(i.activePage).find(".app-wrapper").focus())});$(document).ready(function(){n.initialize()}).on("calculate.app",function(t,i){if(i=i.split(/\./),i[i.length-1]=="app"){var r=n.pageInfo(i[1]).dataView;return r.extension().calculate(i[0]),!1}}).on("touchstart MSPointerDown pointerdown",function(t){if(!s&&ce(t)){if(b){t.preventDefault();return}var r=$(t.target),i=r.closest("a"),u=ds=ks(t);le=s==null&&r.closest(".app-scrollable").length==0;r.closest(".app-echo").length&&(le=!1);i.length&&(fr=i.data("touch-start",u),i.is(n.activeLinkBlacklist)||(i.parent().is("li")?ca=setTimeout(function(){fr&&o(fr,!1)},200):o(i,!1)))}}).on("touchmove MSPointerMove pointermove",function(n){if(ce(n)){var r,t=$(n.target),u=$(fr),f=t.closest(".ui-panel-inner,.app-wrapper"),i=ks(n),e=u.length&&u.data("touch-start"),s;if(et&&(t.closest(".app-tabs,.app-map-info").length||t.closest(".app-bar-tools").length&&!t.closest(".ui-btn").length)){n.preventDefault();return}if(le){if(le=!1,f.length&&(i.y>ds.y?r=f.scrollTop()==0:i.y<ds.y&&(s=ao(f),r=s.height>=s.maxHeight-1)),r){ae();o();n.preventDefault();et&&(ui=!1);return}if(t.is(".ui-panel-dismiss,.ui-popup-screen,.app-scrollable-cover")){n.preventDefault();return}}u.length&&(e&&(Math.abs(e.x-i.x)>0||Math.abs(e.y-i.y)>0)&&o(),ae())}}).on("touchend MSPointerUp pointerup",function(n){if(ce(n)){var t=$(n.target).closest("a"),r=ks(n),i=t.length&&t.data("touch-start");t.length&&(!i||Math.abs(i.x-r.x)>0||Math.abs(i.y-r.y)>0)&&n.preventDefault();ae()}}).on("touchcancel MSPointerCancel pointercancel",function(n){ce(n)&&(o(),ae())}).on("scrollstart.app",function(){wo()}).on("scrolldir.app scrollstop.app",function(t){if(t.relatedTarget){var f=$(t.relatedTarget),u=f.data("scroll-dir"),r=t.relatedTarget.find("ul:first").is(".app-grid"),i=r?n.headingBar().find(".app-grid-desc"):null;u=="up"?(r&&i.length&&!i.is(":visible")&&i.show(),ni()):u=="down"&&(r&&t.relatedTarget.scrollTop()!=0?r&&(i.length&&i.is(":visible")&&i.hide(),ni()):ot());t.type=="scrollstop"&&(clearInterval(eh),eh=setTimeout(function(n){var t=ao(n);t.top<=0&&t.height<=t.maxHeight+1&&(hi(),ct())},250,t.relatedTarget))}}).on("contextmenu MSHoldVisual selectstart",function(n){if(f()||$(n.target).is(":input")){if(n.type=="contextmenu"){var t=$(".ui-popup-active .ui-popup.app-popup-listview");t.length&&(t.popup("close"),n.preventDefault())}}else n.preventDefault()}).one("pagecreate","#Main",function(){n._pageCreated=!0}).on("pagecontainerbeforechange",function(t,i){var e=typeof i.toPage=="string"?i.toPage:$(i.toPage).attr("id");if(typeof i.toPage=="string"&&i.toPage.match(/^http/))return(vu(!1),fu)?(fu=!1,!1):void 0;if(i.options.deferred){var o=n.pageInfo(),f=$(i.toPage),r=n.pageInfo(f.attr("id")),u=r&&r.dataView;n.headingBar().find(".app-bar-text, .app-bar-label").removeData();r&&!i.toPage.prevObject||(ot(),extension=u&&u.extension(),n.search("configure",{allow:extension?extension.options().quickFind:!1}))}}).on("vmousedown",".app-static-label",function(){uv=s}).on("dblclick",".app-yardstick",function(n){if(co(n)){kf();var i=$(n.currentTarget).attr("class").match(/app-width(\d+)/),t=$('<div class="ui-content app-popup-message"/>').text(String.format("Item Width: {0}em",i[1])).popup({history:!1,arrow:"b,t",x:n.clientX,y:n.clientY,overlayTheme:"b",afteropen:function(){},afterclose:function(){rr(t)}}).popupopen().on("vclick",function(){return lt(t),!1});return!1}}).on("dblclick",".app-static-text",function(t){var e;if(!ri&&(kf(),e=n.pageInfo(),e)){var u=e.dataView,o=u?u._allFields:null,f=$(t.target),r;return f.is(".app-text-collapsible")&&(f=f.parent()),r=f.attr("class").match(/(app-field-(\w+))/),r&&u?(ke=!1,u.extension().executeInContext("Edit",null,!0),setTimeout(function(){$(o).each(function(){if(o[this.AliasIndex].Name==r[2])return r=this.Name,!1});var n=i.activePage.find("*:input.app-field-"+r),t=n.parent().find(".app-lookup-input"),u=t.length?t:n;u.focus().select();ke=!0},500),!1):void 0}}).on("vclick","a",dy).on("vclick",".app-input-value",function(n){return $(n.target).prev().focus(),!1}).on("vclick",".app-btn-toggle",ky).on("vclick",".app-filter",function(t){var i=$(t.target).closest(".app-echo");return i.length&&n.contextScope(i.attr("data-for")),dr({mode:"everything"}),!1}).on("vclick contextmenu",".app-grid-header > span:not(.app-btn-more)",function(n){var t=$(n.target),i={x:n.pageX,y:null};return t.is(".app-indicator")&&(t=t.parent()),t.addClass("ui-btn-active"),i.x&&(i.y=t.offset().top+t.outerHeight()*.75),n.preventDefault(),setTimeout(function(){t.removeClass("ui-btn-active");fa(t,i)},200),!1}).on("keydown keypress",function(t){var w=$(t.target),b=n._toolbar,l=t.type=="keydown",e,k=t.key,v=t.keyCode,r,o=l&&(v==114||v==70&&t.ctrlKey),h=l&&v==27,c,y,p,f;if(!l||h||o){if(!s&&!w.is("#app-input-search")&&(e=String.fromCharCode(t.which),e.match(/[\w\-\"]/)||h||o)){if(bt()&&!ei){if(o)return setTimeout(function(){dc(n._contextButton)}),!1;if(h&&!u.find(".ui-popup-active").length)return bh(),!1}else if(a()=="taskassistant"&&h)return bh(),!1;if(c=i.activePage.find(".app-wrapper"),c.length&&(y=c.offset().top,p=y+c.height()-1,i.activePage.find(".app-echo-controls .ui-btn.ui-icon-search").each(function(){var n=$(this),t;if(n.is(":visible")&&(t=n.offset().top,t>=y&&t<p-75))return r=n,f=$app.find(n.closest(".app-echo").attr("data-for")),!1})),r||(r=b.find(".ui-icon-search:visible"),f=n.dataView()),r.length){if(h)if(f&&f.extension().quickFind())tc(f,""),du(f),yo(r);else return!1;else if(o)r.trigger("vclick",!1),yo(r);else if(t.type=="keypress"){if(bt())return;ei!=null&&(e=ei+e);ei=e;ei.length==1&&(r.trigger("vclick",!1),yo(r))}return!1}}if(o)return!1}});g.on("resize",function(){gs||(gs=!0,df(),$(".app-echo-controls,.app-bar-controls").hide(),$(document).trigger("resizing.app"),n._toolbarButtons.hide())}).on("throttledresize",function(){gs=!1;ro();$(".ui-panel-dismiss").height(i.getScreenHeight());f()&&pt();p(!1,null,function(){ot();ni();lu()});io(i.activePage);hi();clearTimeout(sh);sh=setTimeout(function(){var t=i.activePage.find(".app-wrapper"),r;bf(t,!0);ct(!0);ct(!1);n.refreshMenuStrip();r=a();$(n._pages).each(function(){var t=this,n;t.echoId&&(n=$("#"+t.echoId),n.length&&n.closest(".ui-page").attr("id")!=r&&(t.echoChanged=!0,n.find(" .app-echo-controls").addClass("app-stale")))});oo(t)},1e3);var t=$(".ui-popup");t.is(".app-popup-message,.app-popup-listview")?lt(t):t.popup("reposition",{positionTo:"window"});ri=!1;$(document).trigger("resized.app")}).on("orientationchange",function(){setTimeout(function(){s||pt();setTimeout(function(){s||pt()},500)},500)});Sys.Application.add_init(function(){});Sys.Application.add_load(function(){n._appLoaded=!0});Web.DataView.MobileGrid.registerClass("Web.DataView.MobileGrid",Web.DataView.MobileBase);Web.DataView.MobileForm.registerClass("Web.DataView.MobileForm",Web.DataView.MobileBase)})();